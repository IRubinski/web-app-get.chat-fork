[{"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\index.js":"1","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\reportWebVitals.js":"2","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\App.js":"3","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Login.js":"4","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\AppTheme.js":"5","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Constants.js":"6","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\AvatarStyles.js":"7","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\ChatMessageClass.js":"8","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\AttachmentTypesMenu.js":"9","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\TemplateMessageClass.js":"10","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\SearchMessage.js":"11","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\SearchBar.js":"12","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\CreateTemplate.js":"13","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\SearchMessageResult.js":"14","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\ChatClass.js":"15","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\FileInput.js":"16","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\ChosenFileClass.js":"17","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\hooks\\useForceUpdate.js":"18","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\VoiceRecorder.js":"19","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\recorder\\worker.js":"20","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\NewMessageClass.js":"21","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Contacts.js":"22","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Contact.js":"23","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\PersonClass.js":"24","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\ContactClass.js":"25","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\ContactProviderHeader.js":"26","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Person.js":"27","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\ChatAssignmentEvent.js":"28","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\DownloadUnsupportedFile.js":"29","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\UnsupportedFileClass.js":"30","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\SavedResponseClass.js":"31","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\Helpers.js":"32","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\StorageHelper.js":"33","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\SidebarHelper.js":"34","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\FileHelper.js":"35","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\DateHelper.js":"36","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\ChatHelper.js":"37","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\UserClass.js":"38","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Main.js":"39","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\ContactDetails.js":"40","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\ChatAssignment.js":"41","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\LoadingScreen.js":"42","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\ChatTags.js":"43","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\PreviewMedia.js":"44","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\ChatTagsList.js":"45","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\Helpers.js":"46","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\StorageHelper.js":"47","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\SidebarHelper.js":"48","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\ChatHelper.js":"49","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\FileHelper.js":"50","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\DateHelper.js":"51","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\api\\ApiCalls.js":"52","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\ApiHelper.js":"53","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\BulkMessageTaskElementClass.js":"54","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\BulkMessageTaskClass.js":"55","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\Sidebar.js":"56","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\Chat.js":"57","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\SidebarChat.js":"58","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\SidebarContactResult.js":"59","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\BusinessProfile.js":"60","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\ChangePasswordDialog.js":"61","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\SelectableChatTag.js":"62","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\BulkSendIndicator.js":"63","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\BulkSendActions.js":"64","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\MessageDateIndicator.js":"65","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\SavedResponses.js":"66","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\PreviewSendMedia.js":"67","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatHeader.js":"68","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessage.js":"69","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\Notifications\\Notifications.js":"70","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageOptionsMenu.js":"71","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\TemplateMessages\\TemplateMessages.js":"72","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatFooter\\ChatFooter.js":"73","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageTypeIcon.js":"74","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageShortContent.js":"75","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\TemplateMessages\\SendTemplateMessage.js":"76","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatFooter\\VoiceRecord.js":"77","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageTypeLabel.js":"78","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\Notifications\\FailedBulkMessageNotification.js":"79","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageTemplate.js":"80","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageVoice.js":"81","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageDocument.js":"82","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageImage.js":"83","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageVideo.js":"84","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ContextChatMessage.js":"85","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatTaggingEvent.js":"86","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\AvatarHelper.js":"87","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\TemplateMessageHelper.js":"88","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\ObjectHelper.js":"89","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\EmojiHelper.js":"90","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\URLHelper.js":"91","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\MessageHelper.js":"92"},{"size":493,"mtime":1611658611905,"results":"93","hashOfConfig":"94"},{"size":362,"mtime":499162500000,"results":"95","hashOfConfig":"94"},{"size":799,"mtime":1623918900167,"results":"96","hashOfConfig":"94"},{"size":5822,"mtime":1624019500664,"results":"97","hashOfConfig":"94"},{"size":470,"mtime":1614783203762,"results":"98","hashOfConfig":"94"},{"size":2665,"mtime":1626955340468,"results":"99","hashOfConfig":"94"},{"size":3242,"mtime":1627650154955,"results":"100","hashOfConfig":"94"},{"size":8060,"mtime":1627652055234,"results":"101","hashOfConfig":"94"},{"size":1144,"mtime":1613394017720,"results":"102","hashOfConfig":"94"},{"size":385,"mtime":1621949173114,"results":"103","hashOfConfig":"94"},{"size":3260,"mtime":1624268485765,"results":"104","hashOfConfig":"94"},{"size":832,"mtime":1617352969214,"results":"105","hashOfConfig":"94"},{"size":2139,"mtime":1612957974714,"results":"106","hashOfConfig":"94"},{"size":2059,"mtime":1627914120889,"results":"107","hashOfConfig":"94"},{"size":3228,"mtime":1627653072451,"results":"108","hashOfConfig":"94"},{"size":547,"mtime":1614936205165,"results":"109","hashOfConfig":"94"},{"size":939,"mtime":1623923231567,"results":"110","hashOfConfig":"94"},{"size":203,"mtime":1614162338987,"results":"111","hashOfConfig":"94"},{"size":2494,"mtime":1614684068270,"results":"112","hashOfConfig":"94"},{"size":118,"mtime":1614680945459,"results":"113","hashOfConfig":"94"},{"size":178,"mtime":1616405971376,"results":"114","hashOfConfig":"94"},{"size":9081,"mtime":1627913910823,"results":"115","hashOfConfig":"94"},{"size":3037,"mtime":1618566407233,"results":"116","hashOfConfig":"94"},{"size":998,"mtime":1627652055251,"results":"117","hashOfConfig":"94"},{"size":353,"mtime":1620644199040,"results":"118","hashOfConfig":"94"},{"size":714,"mtime":1618400027911,"results":"119","hashOfConfig":"94"},{"size":1495,"mtime":1627909634164,"results":"120","hashOfConfig":"94"},{"size":1788,"mtime":1621585829369,"results":"121","hashOfConfig":"94"},{"size":1037,"mtime":1621949418528,"results":"122","hashOfConfig":"94"},{"size":169,"mtime":1621949069241,"results":"123","hashOfConfig":"94"},{"size":317,"mtime":1627644302442,"results":"124","hashOfConfig":"94"},{"size":9518,"mtime":1623658694752,"results":"125","hashOfConfig":"94"},{"size":1764,"mtime":1623755701643,"results":"126","hashOfConfig":"94"},{"size":1333,"mtime":1623658694577,"results":"127","hashOfConfig":"94"},{"size":6381,"mtime":1623658694456,"results":"128","hashOfConfig":"94"},{"size":256,"mtime":1612860915449,"results":"129","hashOfConfig":"94"},{"size":422,"mtime":1623667265404,"results":"130","hashOfConfig":"94"},{"size":1133,"mtime":1623921355994,"results":"131","hashOfConfig":"94"},{"size":33179,"mtime":1628511389019,"results":"132","hashOfConfig":"94"},{"size":8196,"mtime":1627914120905,"results":"133","hashOfConfig":"94"},{"size":6229,"mtime":1626358276767,"results":"134","hashOfConfig":"94"},{"size":1420,"mtime":1624004491977,"results":"135","hashOfConfig":"94"},{"size":5973,"mtime":1628081342194,"results":"136","hashOfConfig":"94"},{"size":1990,"mtime":1627909634285,"results":"137","hashOfConfig":"94"},{"size":2385,"mtime":1628081342142,"results":"138","hashOfConfig":"94"},{"size":4804,"mtime":1628081342100,"results":"139","hashOfConfig":"94"},{"size":1764,"mtime":1623755701643,"results":"140","hashOfConfig":"94"},{"size":1477,"mtime":1626358362230,"results":"141","hashOfConfig":"94"},{"size":422,"mtime":1623667265404,"results":"142","hashOfConfig":"94"},{"size":6381,"mtime":1623658694456,"results":"143","hashOfConfig":"94"},{"size":256,"mtime":1612860915449,"results":"144","hashOfConfig":"94"},{"size":14807,"mtime":1628511389038,"results":"145","hashOfConfig":"94"},{"size":639,"mtime":1625053846320,"results":"146","hashOfConfig":"94"},{"size":427,"mtime":1625823298182,"results":"147","hashOfConfig":"94"},{"size":391,"mtime":1625753159569,"results":"148","hashOfConfig":"94"},{"size":24976,"mtime":1628081342127,"results":"149","hashOfConfig":"94"},{"size":49683,"mtime":1628078705175,"results":"150","hashOfConfig":"94"},{"size":10829,"mtime":1627914120865,"results":"151","hashOfConfig":"94"},{"size":899,"mtime":1627909634229,"results":"152","hashOfConfig":"94"},{"size":10487,"mtime":1627909634253,"results":"153","hashOfConfig":"94"},{"size":4274,"mtime":1626167446619,"results":"154","hashOfConfig":"94"},{"size":1405,"mtime":1626167446633,"results":"155","hashOfConfig":"94"},{"size":3963,"mtime":1628078705137,"results":"156","hashOfConfig":"94"},{"size":756,"mtime":1626167446738,"results":"157","hashOfConfig":"94"},{"size":668,"mtime":1626169339231,"results":"158","hashOfConfig":"94"},{"size":2728,"mtime":1627913910864,"results":"159","hashOfConfig":"94"},{"size":11770,"mtime":1627913910946,"results":"160","hashOfConfig":"94"},{"size":4204,"mtime":1627914120913,"results":"161","hashOfConfig":"94"},{"size":7005,"mtime":1628078705122,"results":"162","hashOfConfig":"94"},{"size":3672,"mtime":1627913910847,"results":"163","hashOfConfig":"94"},{"size":1171,"mtime":1625229562713,"results":"164","hashOfConfig":"94"},{"size":6658,"mtime":1627913910979,"results":"165","hashOfConfig":"94"},{"size":14303,"mtime":1627914120897,"results":"166","hashOfConfig":"94"},{"size":1373,"mtime":1626169339332,"results":"167","hashOfConfig":"94"},{"size":1248,"mtime":1627914120837,"results":"168","hashOfConfig":"94"},{"size":8542,"mtime":1627912058950,"results":"169","hashOfConfig":"94"},{"size":5803,"mtime":1626169339411,"results":"170","hashOfConfig":"94"},{"size":1037,"mtime":1626169339193,"results":"171","hashOfConfig":"94"},{"size":1790,"mtime":1628078705195,"results":"172","hashOfConfig":"94"},{"size":3357,"mtime":1627912058965,"results":"173","hashOfConfig":"94"},{"size":5331,"mtime":1627909634181,"results":"174","hashOfConfig":"94"},{"size":539,"mtime":1615454217344,"results":"175","hashOfConfig":"94"},{"size":253,"mtime":1615385937537,"results":"176","hashOfConfig":"94"},{"size":549,"mtime":1615383360076,"results":"177","hashOfConfig":"94"},{"size":1455,"mtime":1626172266696,"results":"178","hashOfConfig":"94"},{"size":1170,"mtime":1626261410973,"results":"179","hashOfConfig":"94"},{"size":1184,"mtime":1627909634186,"results":"180","hashOfConfig":"94"},{"size":1017,"mtime":1627912058970,"results":"181","hashOfConfig":"94"},{"size":571,"mtime":1627913910871,"results":"182","hashOfConfig":"94"},{"size":1318,"mtime":1627914120873,"results":"183","hashOfConfig":"94"},{"size":937,"mtime":1628081342177,"results":"184","hashOfConfig":"94"},{"size":1773,"mtime":1628078705180,"results":"185","hashOfConfig":"94"},{"filePath":"186","messages":"187","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},"qxyosp",{"filePath":"189","messages":"190","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"191","messages":"192","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"193","messages":"194","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"195","usedDeprecatedRules":"188"},{"filePath":"196","messages":"197","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"198","messages":"199","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"200","messages":"201","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"202","usedDeprecatedRules":"188"},{"filePath":"203","messages":"204","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"205","messages":"206","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"207","messages":"208","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"209","messages":"210","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"211","messages":"212","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"213","messages":"214","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"215","messages":"216","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"217","messages":"218","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"219","messages":"220","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"221","usedDeprecatedRules":"188"},{"filePath":"222","messages":"223","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"224","messages":"225","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"226","messages":"227","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"228","messages":"229","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"230","messages":"231","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"232","messages":"233","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"234","usedDeprecatedRules":"188"},{"filePath":"235","messages":"236","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"237","messages":"238","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"239","messages":"240","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"241","messages":"242","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"243","usedDeprecatedRules":"188"},{"filePath":"244","messages":"245","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"246","messages":"247","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"248","messages":"249","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"250","messages":"251","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"252","messages":"253","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"254","messages":"255","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"256","usedDeprecatedRules":"257"},{"filePath":"258","messages":"259","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"257"},{"filePath":"260","messages":"261","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"257"},{"filePath":"262","messages":"263","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"257"},{"filePath":"264","messages":"265","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"257"},{"filePath":"266","messages":"267","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"257"},{"filePath":"268","messages":"269","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"270","messages":"271","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"272","messages":"273","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"274","usedDeprecatedRules":"188"},{"filePath":"275","messages":"276","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"277","usedDeprecatedRules":"188"},{"filePath":"278","messages":"279","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"280","messages":"281","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"282","usedDeprecatedRules":"188"},{"filePath":"283","messages":"284","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"285","messages":"286","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"287","usedDeprecatedRules":"188"},{"filePath":"288","messages":"289","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"290","messages":"291","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"292","messages":"293","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"294","messages":"295","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"296","messages":"297","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"298","messages":"299","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"300","messages":"301","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"302","messages":"303","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"304","messages":"305","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"306","messages":"307","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"308","messages":"309","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"310","usedDeprecatedRules":"188"},{"filePath":"311","messages":"312","errorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"313","usedDeprecatedRules":"188"},{"filePath":"314","messages":"315","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"316","usedDeprecatedRules":"188"},{"filePath":"317","messages":"318","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"319","messages":"320","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"321","usedDeprecatedRules":"188"},{"filePath":"322","messages":"323","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"324","messages":"325","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"326","usedDeprecatedRules":"188"},{"filePath":"327","messages":"328","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"329","usedDeprecatedRules":"188"},{"filePath":"330","messages":"331","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"332","messages":"333","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"334","messages":"335","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"336","messages":"337","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"338","usedDeprecatedRules":"188"},{"filePath":"339","messages":"340","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"341","usedDeprecatedRules":"188"},{"filePath":"342","messages":"343","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"344","messages":"345","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"346","usedDeprecatedRules":"188"},{"filePath":"347","messages":"348","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"349","messages":"350","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"351","messages":"352","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"353","messages":"354","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"355","messages":"356","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"357","messages":"358","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"359","usedDeprecatedRules":"188"},{"filePath":"360","messages":"361","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"362","usedDeprecatedRules":"188"},{"filePath":"363","messages":"364","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"365","messages":"366","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"367","messages":"368","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"369","messages":"370","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"371","usedDeprecatedRules":"188"},{"filePath":"372","messages":"373","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"374","usedDeprecatedRules":"188"},{"filePath":"375","messages":"376","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"377","messages":"378","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"379","messages":"380","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"381","messages":"382","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"383","messages":"384","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"385","messages":"386","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"387","usedDeprecatedRules":"188"},{"filePath":"388","messages":"389","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"390","messages":"391","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"392","usedDeprecatedRules":"188"},{"filePath":"393","messages":"394","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},{"filePath":"395","messages":"396","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"188"},"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\index.js",[],["397","398"],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\reportWebVitals.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\App.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Login.js",["399"],"import React, {useEffect, useState} from 'react';\r\nimport '../styles/Login.css';\r\nimport {Backdrop, CircularProgress, Fade, TextField} from '@material-ui/core';\r\nimport Button from '@material-ui/core/Button';\r\nimport {useHistory, useLocation, useParams} from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {getConfig} from \"../Helpers/Helpers\";\r\nimport {Alert} from \"@material-ui/lab\";\r\nimport {BASE_URL, VERSION} from \"../Constants\";\r\nimport {clearToken, getToken, storeToken} from \"../Helpers/StorageHelper\";\r\nimport logo from '../assets/images/logo.png';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    backdrop: {\r\n        zIndex: theme.zIndex.drawer + 1,\r\n        color: '#fff',\r\n    },\r\n}));\r\n\r\nexport default function Login(props) {\r\n\r\n    const {errorCase} = useParams();\r\n\r\n    const errorMessages = {\r\n        \"incorrectRole\": \"Only admins and users can access to our web app.\",\r\n        \"notLoggedIn\": \"You are not logged in.\",\r\n        \"invalidToken\": \"Invalid token.\"\r\n    };\r\n\r\n    const classes = useStyles();\r\n\r\n    const [username, setUsername] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [isLoggingIn, setLoggingIn] = useState(false);\r\n    const [isValidatingToken, setValidatingToken] = useState(false);\r\n    const [loginError, setLoginError] = useState();\r\n\r\n    const history = useHistory();\r\n    const location = useLocation();\r\n\r\n    useEffect(() => {\r\n        if (errorCase) {\r\n            setLoginError(errorMessages[errorCase]);\r\n\r\n            if (errorCase === \"invalidToken\") {\r\n                logoutToClearSession();\r\n            }\r\n        }\r\n\r\n        const token = getToken();\r\n        if (token) {\r\n            setValidatingToken(true);\r\n            axios.get(BASE_URL, getConfig())\r\n                .then((response) => {\r\n                    // Redirect to main route\r\n                    history.push(\"/main\");\r\n                })\r\n                .catch((error) => {\r\n                    setValidatingToken(false);\r\n\r\n                    // TODO: Make sure the response is Unauthorized\r\n                    clearToken();\r\n                });\r\n        }\r\n    }, []);\r\n\r\n    const doLogin = async e => {\r\n        e.preventDefault();\r\n\r\n        // Check if username or password is empty\r\n        if (username.trim() === '' || password.trim() === '') {\r\n            // TODO: Display error on UI\r\n            console.log(\"Empty credentials\");\r\n            return false;\r\n        }\r\n\r\n        // Display the loading animation\r\n        setLoggingIn(true);\r\n\r\n        axios.post(`${BASE_URL}auth/token/`, {\r\n            username : username,\r\n            password : password\r\n        }).then((response) => {\r\n            // Store token in local storage\r\n            storeToken(response.data.token);\r\n\r\n            // Android web interface\r\n            if (window.AndroidWebInterface) {\r\n                window.AndroidWebInterface.registerUserToken(response.data.token ?? \"\");\r\n            }\r\n\r\n            // Redirect to main route\r\n            history.push((location.nextPath ?? \"/main\") + (location.search ?? \"\"));\r\n        }).catch((error) => {\r\n\r\n            // Hide the loading animation\r\n            setLoggingIn(false);\r\n            setLoginError(undefined);\r\n\r\n            // Handle the error\r\n            if (error.response) {\r\n                // Request made and server responded\r\n                console.log(error.response.data);\r\n                console.log(error.response.status);\r\n                console.log(error.response.headers);\r\n\r\n                setLoginError(\"Incorrect username or password.\");\r\n            } else if (error.request) {\r\n                // The request was made but no response was received\r\n                console.log(error.request);\r\n\r\n                setLoginError(\"An error has occurred.\");\r\n            } else {\r\n                // Something happened in setting up the request that triggered an Error\r\n                console.log('Error', error.message);\r\n\r\n                setLoginError(\"An error has occurred.\");\r\n            }\r\n        })\r\n    }\r\n\r\n    const logoutToClearSession = () => {\r\n        axios.get( `${BASE_URL}auth/logout/`, getConfig())\r\n            .then((response) => {\r\n                console.log(\"Logout: \", response.data);\r\n\r\n            })\r\n            .catch((error) => {\r\n                console.error(error);\r\n            });\r\n    }\r\n\r\n    return (\r\n        <div className=\"login\">\r\n\r\n            <Fade in={true}>\r\n                <div className=\"login__body\">\r\n                    <div className=\"login__body__logoWrapper\">\r\n                        <img className=\"login__body__logo\" src={logo} alt=\"Logo\" />\r\n                    </div>\r\n\r\n                    <h2>Welcome</h2>\r\n                    <p>Please login to start</p>\r\n\r\n                    <form onSubmit={doLogin}>\r\n                        <TextField value={username} onChange={e => setUsername(e.target.value)} label=\"Username\" size=\"medium\" fullWidth={true} />\r\n                        <TextField value={password} onChange={e => setPassword(e.target.value)} type=\"password\" label=\"Password\" size=\"medium\" fullWidth={true} />\r\n                        <Button type=\"submit\" color=\"primary\" fullWidth={true} disableElevation>Login</Button>\r\n                    </form>\r\n\r\n                    {isValidatingToken &&\r\n                    <div className=\"login__validatingToken\">\r\n                        <h2>Welcome</h2>\r\n                        <p>We are validating your session, please wait.</p>\r\n                    </div>\r\n                    }\r\n\r\n                    {loginError &&\r\n                    <Alert severity=\"error\">{loginError}</Alert>\r\n                    }\r\n\r\n                    <div className=\"login__body__versionWrapper\">\r\n                        <span className=\"login__body__version\">Version: { VERSION }</span>\r\n                    </div>\r\n                </div>\r\n            </Fade>\r\n\r\n            <Backdrop className={classes.backdrop} open={isLoggingIn}>\r\n                <CircularProgress color=\"inherit\" />\r\n            </Backdrop>\r\n\r\n        </div>\r\n    )\r\n}","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\AppTheme.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Constants.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\AvatarStyles.js",["400"],"import {makeStyles} from \"@material-ui/core/styles\";\r\n\r\nfunction hashCode(str) {\r\n    let hash = 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n        hash = str.charCodeAt(i) + ((hash << 5) - hash);\r\n    }\r\n    return hash;\r\n}\r\n\r\nfunction intToRGB(i) {\r\n    const c = (i & 0x00FFFFFF)\r\n        .toString(16)\r\n        .toUpperCase();\r\n\r\n    return \"00000\".substring(0, 6 - c.length) + c;\r\n}\r\n\r\nconst prepareStylesObject = () => {\r\n    let obj = {};\r\n    for (let i = 65; i <= 90; i++) {\r\n        const curLetter = String.fromCharCode(i);\r\n        obj[curLetter] = {\r\n            color: '#fff',\r\n            backgroundColor: '#' + intToRGB(hashCode(curLetter.repeat(6)))\r\n        };\r\n    }\r\n    obj[\"orange\"] = {\"color\": \"#fff\", \"backgroundColor\": \"#ff9a10\"};\r\n\r\n    return obj;\r\n}\r\n\r\n// In case generating colors is needed again, this can be enabled\r\n//const avatarStyles = makeStyles((theme) => (prepareStylesObject()));\r\n\r\nconst avatarStyles = makeStyles((theme) => ({\r\n    \"A\": {\"color\": \"#fff\", \"backgroundColor\": \"#9D8060\"},\r\n    \"B\": {\"color\": \"#fff\", \"backgroundColor\": \"#60E8C0\"},\r\n    \"C\": {\"color\": \"#fff\", \"backgroundColor\": \"#245120\"},\r\n    \"D\": {\"color\": \"#fff\", \"backgroundColor\": \"#E7B980\"},\r\n    \"E\": {\"color\": \"#fff\", \"backgroundColor\": \"#AB21E0\"},\r\n    \"F\": {\"color\": \"#fff\", \"backgroundColor\": \"#6E8A40\"},\r\n    \"G\": {\"color\": \"#fff\", \"backgroundColor\": \"#31d5f2\"},\r\n    \"H\": {\"color\": \"#fff\", \"backgroundColor\": \"#f55600\"},\r\n    \"I\": {\"color\": \"#fff\", \"backgroundColor\": \"#B8C360\"},\r\n    \"J\": {\"color\": \"#fff\", \"backgroundColor\": \"#7C2BC0\"},\r\n    \"K\": {\"color\": \"#fff\", \"backgroundColor\": \"#bc942e\"},\r\n    \"L\": {\"color\": \"#fff\", \"backgroundColor\": \"#02FC80\"},\r\n    \"M\": {\"color\": \"#fff\", \"backgroundColor\": \"#C664E0\"},\r\n    \"N\": {\"color\": \"#fff\", \"backgroundColor\": \"#89CD40\"},\r\n    \"O\": {\"color\": \"#fff\", \"backgroundColor\": \"#4e2a88\"},\r\n    \"P\": {\"color\": \"#fff\", \"backgroundColor\": \"#109E00\"},\r\n    \"Q\": {\"color\": \"#fff\", \"backgroundColor\": \"#ee2a81\"},\r\n    \"R\": {\"color\": \"#fff\", \"backgroundColor\": \"#976EC0\"},\r\n    \"S\": {\"color\": \"#fff\", \"backgroundColor\": \"#5AD720\"},\r\n    \"T\": {\"color\": \"#fff\", \"backgroundColor\": \"#1E3F80\"},\r\n    \"U\": {\"color\": \"#fff\", \"backgroundColor\": \"#E1A7E0\"},\r\n    \"V\": {\"color\": \"#fff\", \"backgroundColor\": \"#A51040\"},\r\n    \"W\": {\"color\": \"#fff\", \"backgroundColor\": \"#6878A0\"},\r\n    \"X\": {\"color\": \"#fff\", \"backgroundColor\": \"#2BE100\"},\r\n    \"Y\": {\"color\": \"#fff\", \"backgroundColor\": \"#EF4960\"},\r\n    \"Z\": {\"color\": \"#fff\", \"backgroundColor\": \"#B2B1C0\"},\r\n    \"orange\": {\"color\": \"#fff\", \"backgroundColor\": \"#ff9a10\"}\r\n}));\r\n\r\nexport {avatarStyles}","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\ChatMessageClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\AttachmentTypesMenu.js",["401","402"],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\TemplateMessageClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\SearchMessage.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\SearchBar.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\CreateTemplate.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\SearchMessageResult.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\ChatClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\FileInput.js",["403"],"import React, {useState} from \"react\";\r\n\r\nfunction FileInput(props) {\r\n\r\n    return (\r\n        <input\r\n            ref={props.innerRef}\r\n            type=\"file\"\r\n            onChange={(e) => props.handleSelectedFiles(e.target.files)}\r\n            multiple={true}\r\n            onClick={(event)=> {\r\n                event.target.value = null\r\n            }}\r\n            accept={props.accept}\r\n        />\r\n    )\r\n}\r\n\r\nexport default FileInput;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\ChosenFileClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\hooks\\useForceUpdate.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\VoiceRecorder.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\recorder\\worker.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\NewMessageClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Contacts.js",["404","405"],"import React, {useEffect, useRef, useState} from \"react\";\r\nimport '../styles/Contacts.css';\r\nimport axios from \"axios\";\r\nimport {BASE_URL} from \"../Constants\";\r\nimport {addPlus, getConfig, getObjLength, preparePhoneNumber} from \"../helpers/Helpers\";\r\nimport SearchBar from \"./SearchBar\";\r\nimport {Button, CircularProgress, Collapse, IconButton, InputAdornment, ListItem, TextField} from \"@material-ui/core\";\r\nimport {ArrowBack, ExpandLess, ExpandMore} from \"@material-ui/icons\";\r\nimport DialpadIcon from '@material-ui/icons/Dialpad';\r\nimport Contact from \"./Contact\";\r\nimport ContactClass from \"../ContactClass\";\r\nimport {isMobileOnly} from \"react-device-detect\";\r\nimport {useHistory} from \"react-router-dom\";\r\nimport PersonClass from \"../PersonClass\";\r\nimport Person from \"./Person\";\r\nimport {listContactsCall, listPersonsCall} from \"../api/ApiCalls\";\r\n\r\nfunction Contacts(props) {\r\n\r\n    const [keyword, setKeyword] = useState(\"\");\r\n    const [contacts, setContacts] = useState({});\r\n    const [persons, setPersons] = useState({});\r\n    const [isLoading, setLoading] = useState(false);\r\n    const [isVerifying, setVerifying] = useState(false);\r\n    const [isPhoneNumberFormVisible, setPhoneNumberFormVisible] = useState(false);\r\n    const [phoneNumber, setPhoneNumber] = useState(\"\");\r\n    const [isPersonsVisible, setPersonsVisible] = useState(true)\r\n    const [isContactsVisible, setContactsVisible] = useState(true);\r\n\r\n    let cancelTokenSourceRef = useRef();\r\n    let verifyPhoneNumberCancelTokenSourceRef = useRef();\r\n\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        const handleKey = (event) => {\r\n            if (event.keyCode === 27) { // Escape\r\n                props.onHide();\r\n            }\r\n        }\r\n\r\n        document.addEventListener('keydown', handleKey);\r\n\r\n        verifyPhoneNumberCancelTokenSourceRef.current = axios.CancelToken.source();\r\n\r\n        return () => {\r\n            document.removeEventListener('keydown', handleKey);\r\n            cancelTokenSourceRef.current.cancel();\r\n            verifyPhoneNumberCancelTokenSourceRef.current.cancel();\r\n        }\r\n    }, []);\r\n\r\n    let timeout = useRef();\r\n\r\n    useEffect(() => {\r\n        // Generate a token\r\n        cancelTokenSourceRef.current = axios.CancelToken.source();\r\n\r\n        setLoading(true);\r\n\r\n        timeout.current = setTimeout(function () {\r\n            listPersons();\r\n        }, 500);\r\n\r\n        return () => {\r\n            cancelTokenSourceRef.current.cancel();\r\n            clearTimeout(timeout.current);\r\n            setLoading(false);\r\n        }\r\n    }, [keyword]);\r\n\r\n    const listPersons = () => {\r\n        listPersonsCall(keyword?.trim(), cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                const preparedPersons = {};\r\n                response.data.results.forEach((person, personIndex) => {\r\n                    preparedPersons[personIndex] = new PersonClass(person);\r\n                });\r\n                setPersons(preparedPersons);\r\n                listContacts();\r\n            },\r\n            (error) => {\r\n                setLoading(false);\r\n            });\r\n    }\r\n\r\n    const listContacts = () => {\r\n        listContactsCall(keyword?.trim(), 0, cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                const preparedContacts = {};\r\n                response.data.results.forEach((contact, contactIndex) => {\r\n                    preparedContacts[contactIndex] = new ContactClass(contact);\r\n                });\r\n                setContacts(preparedContacts);\r\n                setLoading(false);\r\n            }, (error) => {\r\n                setLoading(false);\r\n            });\r\n    }\r\n\r\n    const verifyPhoneNumber = (data, waId) => {\r\n        waId = preparePhoneNumber(waId);\r\n\r\n        setVerifying(true);\r\n\r\n        axios.post( `${BASE_URL}contacts/verify/`, {\r\n            blocking: \"wait\",\r\n            contacts: [addPlus(waId)],\r\n            force_check: true\r\n        }, getConfig(undefined, verifyPhoneNumberCancelTokenSourceRef.current.token))\r\n            .then((response) => {\r\n                console.log(\"Verify\", response.data);\r\n\r\n                if (response.data.contacts && response.data.contacts.length > 0 && response.data.contacts[0].status === \"valid\") {\r\n                    history.push({\r\n                        pathname: `/main/chat/${waId}`,\r\n                        person: {\r\n                            name: data?.name,\r\n                            initials: data?.initials,\r\n                            avatar: data?.avatar,\r\n                            waId: waId\r\n                        }\r\n                    });\r\n\r\n                    // Hide contacts on mobile\r\n                    if (isMobileOnly) {\r\n                        props.onHide();\r\n                    }\r\n\r\n                } else {\r\n                    window.displayCustomError(\"There is no WhatsApp account connected to this phone number.\");\r\n                }\r\n\r\n                setVerifying(false);\r\n\r\n            })\r\n            .catch((error) => {\r\n                console.log(error);\r\n                window.displayError(error);\r\n\r\n                setVerifying(false);\r\n            });\r\n    }\r\n\r\n    return (\r\n        <div className=\"contacts\">\r\n            <div className=\"contacts__header\">\r\n                <IconButton onClick={props.onHide}>\r\n                    <ArrowBack />\r\n                </IconButton>\r\n\r\n                <h3>New chat</h3>\r\n            </div>\r\n\r\n            <div className=\"contacts__startByPhoneNumberWrapper\">\r\n                <div className=\"contacts__startByPhoneNumber\" onClick={() => setPhoneNumberFormVisible(prevState => !prevState)}>\r\n                    <ListItem button>\r\n                        <div className=\"contacts__startByPhoneNumber__inner\">\r\n                            <DialpadIcon />\r\n                            <span>Start a chat with a phone number</span>\r\n                        </div>\r\n                    </ListItem>\r\n                </div>\r\n\r\n                {isPhoneNumberFormVisible &&\r\n                <div className=\"contacts__startByPhoneNumberWrapper__formWrapper\">\r\n                    <TextField\r\n                        label=\"Phone number\"\r\n                        InputProps={{\r\n                            startAdornment: <InputAdornment position=\"start\">+</InputAdornment>,\r\n                        }}\r\n                        onChange={event => setPhoneNumber(event.target.value)} />\r\n                    <Button color=\"primary\" onClick={() => verifyPhoneNumber(undefined, phoneNumber)}>Start</Button>\r\n                </div>\r\n                }\r\n            </div>\r\n\r\n            <SearchBar\r\n                placeholder=\"Search for contacts\"\r\n                onChange={setKeyword}\r\n                isLoading={isLoading} />\r\n\r\n            <div className=\"contacts__body\">\r\n                {getObjLength(persons) > 0 &&\r\n                <div className=\"contacts__body__headerWrapper\">\r\n                    <h3>Persons</h3>\r\n                    <IconButton onClick={() => setPersonsVisible(prevState => !prevState)}>\r\n                        {isPersonsVisible\r\n                            ?\r\n                            <ExpandLess />\r\n                            :\r\n                            <ExpandMore />\r\n                        }\r\n                    </IconButton>\r\n                </div>\r\n                }\r\n\r\n                <Collapse in={isPersonsVisible}>\r\n                    { Object.entries(persons).map((person, index) =>\r\n                        <Person\r\n                            key={index}\r\n                            data={person[1]}\r\n                            verifyPhoneNumber={verifyPhoneNumber}\r\n                            onHide={props.onHide}\r\n                            contactProvidersData={props.contactProvidersData} />\r\n                    )}\r\n                </Collapse>\r\n\r\n                {getObjLength(contacts) > 0 &&\r\n                <div className=\"contacts__body__headerWrapper\">\r\n                    <h3>Contacts</h3>\r\n                    <IconButton onClick={() => setContactsVisible(prevState => !prevState)}>\r\n                        {isContactsVisible\r\n                            ?\r\n                            <ExpandLess />\r\n                            :\r\n                            <ExpandMore />\r\n                        }\r\n                    </IconButton>\r\n                </div>\r\n                }\r\n\r\n                <Collapse in={isContactsVisible}>\r\n                    { Object.entries(contacts).map((contact, index) =>\r\n                        <Contact\r\n                            key={index}\r\n                            data={contact[1]}\r\n                            verifyPhoneNumber={verifyPhoneNumber}\r\n                            onHide={props.onHide} />\r\n                    )}\r\n                </Collapse>\r\n\r\n                {isVerifying &&\r\n                <div className=\"contacts__body__loading\">\r\n                    <CircularProgress color=\"inherit\" />\r\n                </div>\r\n                }\r\n\r\n                {(!isLoading && keyword?.length > 0 && getObjLength(persons) === 0 && getObjLength(contacts) === 0) &&\r\n                <span className=\"contacts__body__hint\">No persons or contacts found for <span\r\n                    className=\"searchOccurrence\">{keyword}</span></span>\r\n                }\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Contacts;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Contact.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\PersonClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\ContactClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\ContactProviderHeader.js",["406","407","408"],"import React from \"react\";\r\nimport '../styles/ContactProviderHeader.css';\r\nimport googleLogo from '../assets/images/ic-google.png';\r\nimport whatsappLogo from '../assets/images/ic-whatsapp.png';\r\nimport hubspotLogo from '../assets/images/ic-hubspot.png';\r\n\r\nfunction ContactProviderHeader(props) {\r\n    return (\r\n        <div className=\"contactProviderHeader\">\r\n            {props.type === \"whatsapp\" &&\r\n            <img src={whatsappLogo} />\r\n            }\r\n            {props.type === \"google\" &&\r\n            <img src={googleLogo} />\r\n            }\r\n            {props.type === \"hubspot\" &&\r\n            <img src={hubspotLogo} />\r\n            }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ContactProviderHeader;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Person.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\ChatAssignmentEvent.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\DownloadUnsupportedFile.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\UnsupportedFileClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\SavedResponseClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\Helpers.js",["409","410","411","412"],"import {Emoji, getEmojiDataFromNative} from \"emoji-mart\";\r\nimport data from '../EmojiData.json'; //from 'emoji-mart/data/all.json'\r\nimport {BASE_URL, EMOJI_SET, EMOJI_SHEET_SIZE} from \"../Constants\";\r\nimport {getToken} from \"./StorageHelper\";\r\n\r\nconst { htmlToText } = require('html-to-text');\r\nconst emojiRegex = require('emoji-regex/RGI_Emoji.js');\r\n\r\nexport const getConfig = (params, cancelToken, responseType) => {\r\n    const config = {\r\n        withCredentials: false,\r\n        params,\r\n        headers: {\r\n            'Authorization': 'Token ' + getToken(),\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json'\r\n        },\r\n        cancelToken: cancelToken\r\n    }\r\n\r\n    if (responseType !== undefined) {\r\n        config.responseType = responseType;\r\n    }\r\n\r\n    return config;\r\n}\r\n\r\nexport const getObjLength = (obj) => {\r\n    return obj ? Object.keys(obj).length : 0;\r\n}\r\n\r\nfunction linkify(inputText) {\r\n    let replacedText, replacePattern1, replacePattern2, replacePattern3;\r\n\r\n    // URLs starting with http://, https://, or ftp://\r\n    replacePattern1 = /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gim;\r\n    replacedText = inputText.replace(replacePattern1, '<a href=\"$1\" target=\"_blank\">$1</a>');\r\n\r\n    // URLs starting with \"www.\" (without // before it, or it'd re-link the ones done above).\r\n    replacePattern2 = /(^|[^/])(www\\.[\\S]+(\\b|$))/gim;\r\n    replacedText = replacedText.replace(replacePattern2, '$1<a href=\"http://$2\" target=\"_blank\">$2</a>');\r\n\r\n    // Change email addresses to mailto:: links.\r\n    replacePattern3 = /(([a-zA-Z0-9\\-_.])+@[a-zA-Z_]+?(\\.[a-zA-Z]{2,6})+)/gim;\r\n    replacedText = replacedText.replace(replacePattern3, '<a href=\"mailto:$1\">$1</a>');\r\n\r\n    return replacedText;\r\n}\r\n\r\nexport const formatMessage = (message) => {\r\n    if (!message) return;\r\n\r\n    let formatted = message.replaceAll('\\n', '<br/>');\r\n    formatted = linkify(formatted);\r\n    return replaceEmojis(formatted);\r\n}\r\n\r\nfunction containsOnlyEmojis(text) {\r\n    const onlyEmojis = text.replace(new RegExp('[\\u0000-\\u1eeff]', 'g'), '')\r\n    const visibleChars = text.replace(new RegExp('[\\n\\r\\s]+|( )+', 'g'), '')\r\n    return onlyEmojis.length === visibleChars.length\r\n}\r\n\r\nexport const replaceEmojis = (message, ignoreOnlyEmojis) => {\r\n    if (!message) return;\r\n\r\n    const onlyEmojis = !ignoreOnlyEmojis ? containsOnlyEmojis(message) : false;\r\n    const regex = emojiRegex();\r\n\r\n    return message.replace(regex, function (occurrence) {\r\n        // TODO: Finding emoji data is too slow, find an alternative or improve it\r\n        const emojiData = getEmojiDataFromNative(occurrence, EMOJI_SET, data);\r\n        if (emojiData) {\r\n            const emoji = Emoji({\r\n                html: true,\r\n                emoji: emojiData,\r\n                size: onlyEmojis ? 44 : 22,\r\n                set: EMOJI_SET,\r\n                sheetSize: EMOJI_SHEET_SIZE\r\n            });\r\n\r\n            // Emoji might be null\r\n            return emoji ?? occurrence;\r\n\r\n        } else {\r\n            return occurrence;\r\n        }\r\n    });\r\n}\r\n\r\nexport const translateHTMLInputToText = (html) => {\r\n    let result;\r\n    //const reg = new RegExp('((<span\\\\b[^>]*\\\\s\\\\bstyle=([\"\\'])([^\"]*)\\\\3[^>]*>)(.*?)</span>)', 'g');\r\n    const reg = new RegExp('<img\\\\s[^>]*?src\\\\s*=\\\\s*[\\'\\\\\"]([^\\'\\\\\"]*?)[\\'\\\\\"][^>]*?>', 'g');\r\n    result = html.replace(reg, function (occurrences) {\r\n        // Extract unicode from aria-label\r\n        const matches = occurrences.match(new RegExp('aria-label=\"\\\\s*(.*?)\\\\s*,'), '$1');\r\n        if (matches && matches.length >= 1) {\r\n            return matches[1];\r\n        }\r\n        return '';\r\n    });\r\n\r\n    // Convert it to plain text\r\n    result = htmlToText(result);\r\n\r\n    return result;\r\n}\r\n\r\nexport const markOccurrences = (message, sub) => {\r\n    if (!message) return;\r\n\r\n    const reg = new RegExp('(' + sub + ')', 'gi');\r\n    return message.replace(reg, '<span class=\"searchOccurrence\">$1</span>');\r\n}\r\n\r\nexport const generateInitialsHelper = (name) => {\r\n    return (name ? name.replace(/[^a-z\\d\\s]+/gi, '').trim()[0] : '')?.toUpperCase();\r\n}\r\n\r\nexport const getFirstObject = (jsonObject) => {\r\n    return jsonObject[Object.keys(jsonObject)[0]];\r\n}\r\n\r\nexport const getLastObject = (jsonObject) => {\r\n    return jsonObject[Object.keys(jsonObject)[Object.keys(jsonObject).length - 1]];\r\n}\r\n\r\nexport const getObjectByIndex = (jsonObject, index) => {\r\n    return jsonObject[Object.keys(jsonObject)[index]];\r\n}\r\n\r\nexport const getLastKey = (jsonObject) => {\r\n    const keys = Object.keys(jsonObject);\r\n    return keys[keys.length - 1];\r\n}\r\n\r\nexport const messageHelper = (messagesObject) => {\r\n    const last = getLastObject(messagesObject);\r\n    return extractTimestampFromMessage(last);\r\n}\r\n\r\nexport const extractTimestampFromMessage = (message) => {\r\n    return message ? parseInt(message.timestamp) : -1;\r\n}\r\n\r\nexport const generateUnixTimestamp = () => {\r\n    return Math.round(+new Date() / 1000);\r\n}\r\n\r\nexport const stringContainsAnyInArray = (string, array) => {\r\n    for (let i = 0; i < array.length; i++) {\r\n        if (string.includes(array[i])) {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nexport const getSelectionHtml = () => {\r\n    let html = \"\";\r\n    if (typeof window.getSelection != \"undefined\") {\r\n        const sel = window.getSelection();\r\n        if (sel.rangeCount) {\r\n            const container = document.createElement(\"div\");\r\n            for (let i = 0, len = sel.rangeCount; i < len; ++i) {\r\n                container.appendChild(sel.getRangeAt(i).cloneContents());\r\n            }\r\n            html = container.innerHTML;\r\n        }\r\n    } else if (typeof document.selection != \"undefined\") {\r\n        if (document.selection.type === \"Text\") {\r\n            html = document.selection.createRange().htmlText;\r\n        }\r\n    }\r\n    return html;\r\n}\r\n\r\nexport const getAdminPanelURL = () => {\r\n    return BASE_URL.replace('/api/v1', '/admin');\r\n}\r\n\r\nexport const getHubURL = () => {\r\n    return BASE_URL.replace('/api/v1', '/hub');\r\n}\r\n\r\nexport const getBaseURL = () => {\r\n    const windowLocation = window.location;\r\n    return windowLocation.protocol + \"//\" + windowLocation.host + \"/\";\r\n}\r\n\r\nexport const getWebSocketURL = () => {\r\n    const baseURL = getBaseURL();\r\n    if (baseURL.includes('localhost') || baseURL.includes('10.0.2.2')) {\r\n        return 'wss://websockets.whatsapp.kondz.io/';\r\n    } else {\r\n        return baseURL.replace('https://', 'wss://websockets.').replace('http://', 'wss://websockets.');\r\n    }\r\n}\r\n\r\nexport const displaySeconds = (seconds) => {\r\n    const format = val => `0${Math.floor(val)}`.slice(-2);\r\n    //const hours = seconds / 3600;\r\n    const minutes = (seconds % 3600) / 60;\r\n\r\n    return [minutes, seconds % 60].map(format).join(':');\r\n}\r\n\r\nexport const getTemplateParams = (text) => {\r\n    const matches = text?.match(/\\{{(.*?)\\}}/g);\r\n    return matches ? matches : [];\r\n}\r\n\r\nexport const templateParamToInteger = (templateParam) => {\r\n    return templateParam.match(/\\d+/);\r\n}\r\n\r\nexport const insertTemplateComponentParameters = (component, params) => {\r\n    if (!component) return;\r\n\r\n    const type = component.type.toLowerCase();\r\n    const format = component.format ? component.format.toLowerCase() : \"text\";\r\n    let text = component[format];\r\n\r\n    if (!params) return text;\r\n\r\n    for (let i = 0; i < params.length; i++) {\r\n        const component = params[i];\r\n\r\n        if (component.type === type) {\r\n            component.parameters.forEach((param, index) => {\r\n                const paramType = param.type;\r\n\r\n                const paramValue = param[paramType].fallback_value ?? param[paramType];\r\n                text = text.replace(`{{${index+1}}}`, paramValue);\r\n            });\r\n\r\n            break;\r\n        }\r\n    }\r\n\r\n    return text;\r\n}\r\n\r\nconst removeWhitespaces = (text) => {\r\n    return text.replace(/ /g,'');\r\n}\r\n\r\nconst removeHyphens = (text) => {\r\n    return text.replace(/-/g, '');\r\n}\r\n\r\nconst removePluses = (text) => {\r\n    return text.replace(/\\+/g,'');\r\n}\r\n\r\nexport const preparePhoneNumber = (phoneNumber) => {\r\n    phoneNumber = removeHyphens(phoneNumber);\r\n    phoneNumber = removeWhitespaces(phoneNumber);\r\n    phoneNumber = removePluses(phoneNumber);\r\n\r\n    return phoneNumber;\r\n}\r\n\r\nexport const addPlus = (phoneNumber) => {\r\n    return phoneNumber?.includes('+') ? phoneNumber : `+${phoneNumber}`;\r\n}\r\n\r\nexport const containsLetters = (text) => {\r\n    const regExp = /[a-zA-Z]/g;\r\n    return regExp.test(text);\r\n}\r\n\r\nexport const extractAvatarFromContactProviderData = (contactProviderData) => {\r\n    if (contactProviderData) {\r\n        for (let i = 0; i < getObjLength(contactProviderData); i++) {\r\n            const data = contactProviderData[i];\r\n            if (data?.avatar) {\r\n                return data.avatar;\r\n            }\r\n        }\r\n    }\r\n\r\n    return undefined;\r\n}\r\n\r\nexport const hasInternetConnection = () => {\r\n    return navigator.onLine;\r\n}\r\n\r\nexport const sortMessagesAsc = (messages) => {\r\n    let sortedNextState = Object.entries(messages).sort((a, b) => a[1].timestamp - b[1].timestamp);\r\n    return Object.fromEntries(sortedNextState);\r\n}\r\n\r\nexport const isScrollable = (el) => {\r\n    const hasScrollableContent = el.scrollHeight > el.clientHeight;\r\n    const overflowYStyle = window.getComputedStyle(el).overflowY;\r\n    const isOverflowHidden = overflowYStyle.indexOf('hidden') !== -1;\r\n\r\n    return hasScrollableContent && !isOverflowHidden;\r\n}",["413","414"],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\StorageHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\SidebarHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\FileHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\DateHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\Helpers\\ChatHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\UserClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Main.js",["415"],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\ContactDetails.js",["416"],"import React, {useEffect, useState} from 'react';\r\nimport {Avatar, IconButton} from \"@material-ui/core\";\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\nimport PersonIcon from '@material-ui/icons/Person';\r\nimport GroupIcon from '@material-ui/icons/Group';\r\nimport PubSub from \"pubsub-js\";\r\nimport {CALENDAR_NORMAL, EVENT_TOPIC_CONTACT_DETAILS_VISIBILITY} from \"../../Constants\";\r\nimport '../../styles/ContactDetails.css';\r\nimport Moment from \"react-moment\";\r\nimport {avatarStyles} from \"../../AvatarStyles\";\r\nimport googleLogo from '../../assets/images/ic-google.png';\r\nimport hubspotLogo from '../../assets/images/ic-hubspot.png';\r\nimport {addPlus, extractAvatarFromContactProviderData, replaceEmojis, sanitize} from \"../../helpers/Helpers\";\r\nimport LabelIcon from \"@material-ui/icons/Label\";\r\n\r\nfunction ContactDetails(props)  {\r\n\r\n    const [chat, setChat] = useState({});\r\n\r\n    const hideContactDetails = () => {\r\n        PubSub.publish(EVENT_TOPIC_CONTACT_DETAILS_VISIBILITY, false);\r\n    }\r\n\r\n    const avatarClasses = avatarStyles();\r\n\r\n    useEffect(() => {\r\n        props.retrieveContactData(props.contactData.waId);\r\n        setChat(getChatByWaId());\r\n    }, []);\r\n\r\n    const getChatByWaId = () => {\r\n        const waId = props.contactData.waId;\r\n        return props.chats[waId];\r\n    }\r\n\r\n    return (\r\n        <div className=\"contactDetails\">\r\n            <div className=\"contactDetails__header\">\r\n                <IconButton onClick={hideContactDetails}>\r\n                    <CloseIcon />\r\n                </IconButton>\r\n\r\n                <h3>Contact Details</h3>\r\n            </div>\r\n\r\n            {props.contactData &&\r\n            <div className=\"contactDetails__body\">\r\n\r\n                <div className=\"contactDetails__body__section\">\r\n                    <div className=\"contactDetails__body__avatarContainer\">\r\n                        <Avatar\r\n                            src={extractAvatarFromContactProviderData(props.contactProvidersData[props.contactData.waId], true)}\r\n                            className={avatarClasses[props.contactData.getAvatarClassName()] + \" contactDetails__body__avatar\"}>{props.contactData.initials}</Avatar>\r\n                    </div>\r\n\r\n                    <h3 dangerouslySetInnerHTML={{__html: replaceEmojis(sanitize(props.contactProvidersData[props.contactData.waId]?.[0]?.name ?? props.contactData.name ))}} />\r\n\r\n                    {props.contactProvidersData[props.contactData.waId]?.[0]?.companies?.[0] !== undefined &&\r\n                    <div className=\"contactDetails__body__job\">\r\n                        <span>{props.contactProvidersData[props.contactData.waId]?.[0]?.companies?.[0]?.job_title}</span> at <span>{props.contactProvidersData[props.contactData.waId]?.[0]?.companies?.[0]?.company_name}</span>\r\n                    </div>\r\n                    }\r\n\r\n                    <span>Last message: {(props.contactData.lastMessageTimestamp && props.contactData.lastMessageTimestamp > 0)\r\n                        ? <Moment unix calendar={CALENDAR_NORMAL}>{props.contactData.lastMessageTimestamp}</Moment> : 'Never'}</span>\r\n\r\n                    {chat?.tags?.length > 0 &&\r\n                    <div className=\"contactDetails__body__tags mt-3\">\r\n                        {chat?.tags.map((tag, index) =>\r\n                            <div\r\n                                className=\"contactDetails__body__tags__tag\"\r\n                                key={index}\r\n                                onClick={() => props.setFilterTag(tag)}>\r\n                                <LabelIcon style={{fill: tag.web_inbox_color}} />\r\n                                <span className=\"bold\">{tag.name}</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                    }\r\n\r\n                    {(chat?.assignedToUser || chat?.assignedGroup) &&\r\n                    <div className=\"contactDetails__body__assignees mt-3\">\r\n                        {chat?.assignedToUser &&\r\n                        <div>\r\n                            <PersonIcon />\r\n                            Assigned to: <span className=\"bold\">{chat?.assignedToUser.username} {(props.users?.[chat?.assignedToUser.id]?.isBot()) ? ' (App)' : ''}</span>\r\n                        </div>\r\n                        }\r\n\r\n                        {chat?.assignedGroup &&\r\n                        <div>\r\n                            <GroupIcon />\r\n                            Assigned group: <span className=\"bold\">{chat?.assignedGroup.name}</span>\r\n                        </div>\r\n                        }\r\n                    </div>\r\n                    }\r\n                </div>\r\n\r\n                <div className=\"contactDetails__body__section\">\r\n                    <div className=\"contactDetails__body__section__title\">Whatsapp Phone Number</div>\r\n                    <a href={\"tel:+\" + props.contactData.waId}>{addPlus(props.contactData.waId)}</a>\r\n                </div>\r\n\r\n                {props.contactProvidersData[props.contactData.waId]?.map((providerData, index) =>\r\n                    <div\r\n                        className=\"contactDetails__body__section\"\r\n                        key={providerData.contact_provider.id}>\r\n\r\n                        <div className=\"contactDetails__body__section__title mb-3\">\r\n                            <div className=\"contactDetails__body__section__providerTitle\">\r\n                                {providerData.contact_provider.type === \"google\" &&\r\n                                <img className=\"mr-1\" src={googleLogo} alt={providerData.contact_provider.name} />\r\n                                }\r\n                                {providerData.contact_provider.type === \"hubspot\" &&\r\n                                <img className=\"mr-1\" src={hubspotLogo} alt={providerData.contact_provider.name} />\r\n                                }\r\n                                {providerData.contact_provider.name}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"contactDetails__body__section__content mb-2\">\r\n                            <div className=\"contactDetails__body__section__subtitle\">Phone number</div>\r\n                            <div className=\"contactDetails__body__section__content__sub\">\r\n                                {providerData.phone_numbers?.map((phoneNumber, phoneNumberIndex) =>\r\n                                    <div key={phoneNumberIndex}>\r\n                                        <a href={\"tel:\" + addPlus(phoneNumber.phone_number)}>\r\n                                            <span>{addPlus(phoneNumber.phone_number)}</span></a>\r\n                                        {phoneNumber.description &&\r\n                                        <span className=\"ml-1\">({phoneNumber.description})</span>\r\n                                        }\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"contactDetails__body__section__content\">\r\n                            <div className=\"contactDetails__body__section__subtitle\">E-mail</div>\r\n                            <div className=\"contactDetails__body__section__content__sub\">\r\n                                {providerData.email_addresses?.map((emailAddress, emailAddressIndex) =>\r\n                                    <div key={emailAddressIndex}>\r\n                                        <a href={\"mailto:\" + emailAddress.email_address}>{emailAddress.email_address}</a>\r\n                                        {emailAddress.description &&\r\n                                        <span className=\"ml-1\">({emailAddress.description})</span>\r\n                                        }\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n            </div>\r\n            }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ContactDetails;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\ChatAssignment.js",["417"],"import React, {useEffect, useState} from \"react\";\r\nimport {\r\n    Button,\r\n    CircularProgress,\r\n    Dialog,\r\n    DialogActions,\r\n    DialogContent,\r\n    DialogContentText,\r\n    DialogTitle,\r\n    FormControl,\r\n    InputLabel,\r\n    MenuItem,\r\n    Select\r\n} from \"@material-ui/core\";\r\nimport axios from \"axios\";\r\nimport {BASE_URL} from \"../../Constants\";\r\nimport {getConfig} from \"../../Helpers/Helpers\";\r\nimport '../../styles/ChatAssignment.css';\r\n\r\nfunction ChatAssignment(props) {\r\n\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [users, setUsers] = useState([]);\r\n    const [groups, setGroups] = useState([]);\r\n    const [assignedToUser, setAssignedToUser] = useState('null');\r\n    const [assignedGroup, setAssignedGroup] = useState('null');\r\n\r\n    useEffect(() => {\r\n        listUsers();\r\n    }, []);\r\n\r\n    const close = () => {\r\n        props.setOpen(false);\r\n    }\r\n\r\n    const retrieveChatAssignment = () => {\r\n        axios.get( `${BASE_URL}chat_assignment/${props.waId}/`, getConfig())\r\n            .then((response) => {\r\n                console.log(\"Assignment: \", response.data);\r\n\r\n                setAssignedToUser(response.data.assigned_to_user ?? 'null');\r\n                setAssignedGroup(response.data.assigned_group ?? 'null');\r\n\r\n                setLoading(false);\r\n            })\r\n            .catch((error) => {\r\n                window.displayError(error);\r\n            });\r\n    }\r\n\r\n    const updateChatAssignment = () => {\r\n        axios.put( `${BASE_URL}chat_assignment/${props.waId}/`, {\r\n            'wa_id': props.waId,\r\n            'assigned_to_user': assignedToUser === 'null' ? null : assignedToUser,\r\n            'assigned_group': assignedGroup === 'null' ? null : assignedGroup,\r\n        }, getConfig())\r\n            .then((response) => {\r\n                console.log(\"Assignment: \", response.data);\r\n\r\n                close();\r\n            })\r\n            .catch((error) => {\r\n                window.displayError(error);\r\n            });\r\n    }\r\n\r\n    const listUsers = () => {\r\n        axios.get( `${BASE_URL}users/`, getConfig())\r\n            .then((response) => {\r\n                console.log(\"Users: \", response.data);\r\n\r\n                setUsers(response.data.results);\r\n\r\n                // Next\r\n                listGroups();\r\n            })\r\n            .catch((error) => {\r\n                window.displayError(error);\r\n            });\r\n    }\r\n\r\n    const listGroups = () => {\r\n        axios.get( `${BASE_URL}groups/`, getConfig())\r\n            .then((response) => {\r\n                console.log(\"Groups: \", response.data);\r\n\r\n                setGroups(response.data.results);\r\n\r\n                // Next\r\n                retrieveChatAssignment();\r\n            })\r\n            .catch((error) => {\r\n                window.displayError(error);\r\n            });\r\n    }\r\n\r\n    const handleUserChange = (event) => {\r\n        setAssignedToUser(event.target.value);\r\n    }\r\n\r\n    const handleGroupChange = (event) => {\r\n        setAssignedGroup(event.target.value);\r\n    }\r\n\r\n    const prepareUserLabel = (user) => {\r\n        let label = '';\r\n        if (user.first_name) {\r\n            label = user.first_name;\r\n        }\r\n\r\n        if (user.last_name) {\r\n            if (label) {\r\n                label += ' ';\r\n            }\r\n\r\n            label += user.last_name;\r\n        }\r\n\r\n        if (label) {\r\n            label += ` (${user.username})`;\r\n        } else {\r\n            label = user.username;\r\n        }\r\n\r\n        return label;\r\n    }\r\n\r\n    return (\r\n        <Dialog open={props.open} onClose={close} className=\"chatAssignmentWrapper\">\r\n            <DialogTitle>Assign chat</DialogTitle>\r\n            <DialogContent className=\"chatAssignment\">\r\n\r\n                <DialogContentText>You can assign this chat to a user or a group.</DialogContentText>\r\n\r\n                <FormControl fullWidth={true}>\r\n                    <InputLabel id=\"assign-user-select-label\">User</InputLabel>\r\n                    <Select\r\n                        labelId=\"assign-user-select-label\"\r\n                        id=\"assign-user-select\"\r\n                        value={assignedToUser}\r\n                        onChange={handleUserChange}>\r\n                        <MenuItem value=\"null\">Unassigned</MenuItem>\r\n                        {users?.map((user) =>\r\n                            <MenuItem key={user.id} value={user.id}>{prepareUserLabel(user)}</MenuItem>\r\n                        )}\r\n                    </Select>\r\n                </FormControl>\r\n\r\n                <FormControl fullWidth={true}>\r\n                    <InputLabel id=\"assign-group-select-label\">Group</InputLabel>\r\n                    <Select\r\n                        labelId=\"assign-group-select-label\"\r\n                        id=\"assign-group-select\"\r\n                        value={assignedGroup}\r\n                        onChange={handleGroupChange}>\r\n                        <MenuItem value=\"null\">Unassigned</MenuItem>\r\n                        {groups?.map((group) =>\r\n                            <MenuItem key={group.id} value={group.id}>{group.name}</MenuItem>\r\n                        )}\r\n                    </Select>\r\n                </FormControl>\r\n\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={close} color=\"secondary\">Close</Button>\r\n                <Button color=\"primary\" onClick={updateChatAssignment}>Update</Button>\r\n            </DialogActions>\r\n\r\n            {isLoading &&\r\n            <div className=\"chatAssignmentWrapper__loading\">\r\n                <CircularProgress size={28} />\r\n            </div>\r\n            }\r\n\r\n        </Dialog>\r\n    )\r\n}\r\n\r\nexport default ChatAssignment;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\LoadingScreen.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\ChatTags.js",["418","419","420"],"import React, {useEffect, useState} from \"react\";\r\nimport {\r\n    Button,\r\n    Chip,\r\n    CircularProgress,\r\n    Dialog,\r\n    DialogActions,\r\n    DialogContent,\r\n    DialogContentText,\r\n    DialogTitle,\r\n    Link\r\n} from \"@material-ui/core\";\r\nimport '../../styles/ChatTags.css';\r\nimport {createChatTaggingCall, deleteChatTaggingCall, listTagsCall, retrieveChatCall} from \"../../api/ApiCalls\";\r\nimport {getHubURL} from \"../../helpers/URLHelper\";\r\n\r\nfunction ChatTags(props) {\r\n\r\n    const [isLoading, setLoading] = useState(true);\r\n    const [chat, setChat] = useState();\r\n    const [chatTags, setChatTags] = useState([]);\r\n    const [unusedTags, setUnusedTags] = useState([]);\r\n    const [allTags, setAllTags] = useState([]);\r\n\r\n    useEffect(() => {\r\n        retrieveChat();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const nextState = allTags.filter((tag) => {\r\n            if (chatTags) {\r\n                let found = false;\r\n                for (let i = 0; i < chatTags.length; i++) {\r\n                    const curTag = chatTags[i];\r\n                    if (curTag.id === tag.id) {\r\n                        found = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (!found) {\r\n                    return true;\r\n                }\r\n            } else {\r\n                return true;\r\n            }\r\n        });\r\n\r\n        setUnusedTags(nextState);\r\n\r\n    }, [chatTags, allTags]);\r\n\r\n    const close = () => {\r\n        props.setOpen(false);\r\n    }\r\n\r\n    const onDeleteTag = (tag) => {\r\n        deleteChatTagging(tag);\r\n    }\r\n\r\n    const onClickTag = (tag) => {\r\n        createChatTagging(tag);\r\n    }\r\n\r\n    const makeUniqueTagsArray = (tagsArray) => {\r\n        const uniqueTagsArray = {};\r\n        tagsArray.forEach((tag) => {\r\n            if (!uniqueTagsArray.hasOwnProperty(tag.id)) {\r\n                uniqueTagsArray[tag.id] = tag;\r\n            }\r\n        });\r\n\r\n        return Object.values(uniqueTagsArray);\r\n    }\r\n\r\n    const retrieveChat = () => {\r\n        retrieveChatCall(props.waId,\r\n            (response) => {\r\n                setChat(response.data);\r\n                setChatTags(response.data.tags);\r\n\r\n                // Next\r\n                listTags();\r\n            });\r\n    }\r\n\r\n    const listTags = () => {\r\n        listTagsCall((response) => {\r\n            setAllTags(response.data.results);\r\n            setLoading(false);\r\n        });\r\n    }\r\n\r\n    const createChatTagging = (tag) => {\r\n        createChatTaggingCall(props.waId, tag.id,\r\n            (response) => {\r\n                setChatTags(prevState => {\r\n                    let nextState = prevState.filter((curTag) => {\r\n                        return curTag.id !== tag.id;\r\n                    });\r\n\r\n                    tag.tagging_id = response.data.id;\r\n\r\n                    nextState.push(tag);\r\n                    nextState = makeUniqueTagsArray(nextState);\r\n\r\n                    return nextState;\r\n                });\r\n            });\r\n    }\r\n\r\n    const deleteChatTagging = (tag) => {\r\n        deleteChatTaggingCall(tag.tagging_id,\r\n            (response) => {\r\n                setChatTags(prevState => {\r\n                    let nextState = prevState.filter((curTag) => {\r\n                        return curTag.id !== tag.id;\r\n                    });\r\n                    nextState = makeUniqueTagsArray(nextState);\r\n                    return nextState;\r\n                });\r\n            });\r\n    }\r\n\r\n    return (\r\n        <Dialog open={props.open} onClose={close} className=\"chatTagsWrapper\">\r\n            <DialogTitle>Chat tags</DialogTitle>\r\n            <DialogContent>\r\n                <DialogContentText>You can add or remove tags for this chat.</DialogContentText>\r\n\r\n                {chatTags &&\r\n                <div className=\"chatTags__tags current\">\r\n                    <h5>Current tags</h5>\r\n                    {chatTags?.length > 0\r\n                        ?\r\n                        <div>\r\n                            {chatTags.map((tag) =>\r\n                                <Chip\r\n                                    key={tag.id}\r\n                                    label={tag.name}\r\n                                    onDelete={() => onDeleteTag(tag)} />\r\n                            )}\r\n                        </div>\r\n                        :\r\n                        <div className=\"chatTags__tags__empty mt-1\">\r\n                            Empty\r\n                        </div>\r\n                    }\r\n                </div>\r\n                }\r\n\r\n                {allTags &&\r\n                <div className=\"chatTags__tags mt-3\">\r\n                    <h5>All tags</h5>\r\n                    {unusedTags?.length > 0\r\n                        ?\r\n                        <div>\r\n                            {unusedTags.map((tag) =>\r\n                                <Chip\r\n                                    key={tag.id}\r\n                                    label={tag.name}\r\n                                    clickable\r\n                                    onClick={() => onClickTag(tag)} />\r\n                            )}\r\n                        </div>\r\n                        :\r\n                        <div className=\"chatTags__tags__empty mt-1\">\r\n                            Empty\r\n                        </div>\r\n                    }\r\n                </div>\r\n                }\r\n\r\n                <div className=\"mt-3\">\r\n                    <Link href={getHubURL() + 'main/tag/'} target=\"_blank\">Manage tags</Link>\r\n                </div>\r\n\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={close} color=\"secondary\">Close</Button>\r\n                {/*<Button color=\"primary\">Update</Button>*/}\r\n            </DialogActions>\r\n\r\n            {isLoading &&\r\n            <div className=\"chatTagsWrapper__loading\">\r\n                <CircularProgress size={28} />\r\n            </div>\r\n            }\r\n\r\n        </Dialog>\r\n    )\r\n}\r\n\r\nexport default ChatTags;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\PreviewMedia.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\ChatTagsList.js",["421"],"import React, {useState} from \"react\";\r\nimport {\r\n    Button,\r\n    CircularProgress,\r\n    Dialog,\r\n    DialogActions,\r\n    DialogContent,\r\n    DialogTitle,\r\n    Link,\r\n    ListItem\r\n} from \"@material-ui/core\";\r\nimport '../../styles/ChatTagsList.css';\r\nimport LabelIcon from \"@material-ui/icons/Label\";\r\nimport {getHubURL} from \"../../helpers/URLHelper\";\r\n\r\nfunction ChatTagsList(props) {\r\n\r\n    const [isLoading, setLoading] = useState(false);\r\n\r\n    const close = () => {\r\n        props.setOpen(false);\r\n    }\r\n\r\n    const handleClick = (tag) => {\r\n        props.setFilterTag(tag);\r\n        close();\r\n    }\r\n\r\n    return (\r\n        <Dialog open={props.open} onClose={close} className=\"chatTagsListWrapper\">\r\n            <DialogTitle>Tags</DialogTitle>\r\n            <DialogContent className=\"chatTagsListWrapper\">\r\n                <div className=\"mb-3\">You can filter chats by tags.</div>\r\n\r\n                {props.tags &&\r\n                <div className=\"chatTagsList\">\r\n                    {props.tags.length > 0\r\n                        ?\r\n                        <div>\r\n                            {props.tags.map((tag) =>\r\n                                <ListItem key={tag.id} button onClick={() => handleClick(tag)}>\r\n                                    <div className=\"chatTagsListWrapper__tag\">\r\n                                        <LabelIcon style={{fill: tag.web_inbox_color}} />\r\n                                        {tag.name}\r\n                                    </div>\r\n                                </ListItem>\r\n                            )}\r\n                        </div>\r\n                        :\r\n                        <div className=\"chatTagsList__empty\">\r\n                            Empty\r\n                        </div>\r\n                    }\r\n\r\n                </div>\r\n                }\r\n\r\n                <div className=\"mt-3\">\r\n                    <Link href={getHubURL() + 'main/tag/'} target=\"_blank\">Manage tags</Link>\r\n                </div>\r\n\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button onClick={close} color=\"secondary\">Close</Button>\r\n            </DialogActions>\r\n\r\n            {isLoading &&\r\n            <div className=\"chatTagsListWrapper__loading\">\r\n                <CircularProgress size={28} />\r\n            </div>\r\n            }\r\n\r\n        </Dialog>\r\n    )\r\n}\r\n\r\nexport default ChatTagsList;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\Helpers.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\StorageHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\SidebarHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\ChatHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\FileHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\DateHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\api\\ApiCalls.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\ApiHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\BulkMessageTaskElementClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\BulkMessageTaskClass.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\Sidebar.js",["422","423","424","425"],"import React, {useEffect, useRef, useState} from 'react';\r\nimport '../../../styles/Sidebar.css';\r\nimport {\r\n    Avatar,\r\n    CircularProgress,\r\n    Divider,\r\n    Fade,\r\n    IconButton,\r\n    Link,\r\n    Menu,\r\n    MenuItem,\r\n    Tab,\r\n    Tabs,\r\n    Zoom\r\n} from \"@material-ui/core\";\r\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\r\nimport SidebarChat from \"./SidebarChat\";\r\nimport {\r\n    containsLetters,\r\n    generateInitialsHelper,\r\n    isScrollable\r\n} from \"../../../helpers/Helpers\";\r\nimport {EVENT_TOPIC_GO_TO_MSG_ID, EVENT_TOPIC_NEW_CHAT_MESSAGES, EVENT_TOPIC_UPDATE_PERSON_NAME} from \"../../../Constants\";\r\nimport {useHistory, useParams} from \"react-router-dom\";\r\nimport SearchBar from \"../../SearchBar\";\r\nimport SidebarContactResult from \"./SidebarContactResult\";\r\nimport ChatClass from \"../../../ChatClass\";\r\nimport NewMessageClass from \"../../../NewMessageClass\";\r\nimport PubSub from \"pubsub-js\";\r\nimport BusinessProfile from \"./BusinessProfile\";\r\nimport ChangePasswordDialog from \"./ChangePasswordDialog\";\r\nimport ChatMessageClass from \"../../../ChatMessageClass\";\r\nimport SearchMessageResult from \"../../SearchMessageResult\";\r\nimport {isMobile} from 'react-device-detect';\r\nimport ChatIcon from '@material-ui/icons/Chat';\r\nimport Contacts from \"../../Contacts\";\r\nimport {clearContactProvidersData} from \"../../../helpers/StorageHelper\";\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\nimport {filterChat} from \"../../../helpers/SidebarHelper\";\r\nimport BulkSendIndicator from \"./BulkSendIndicator\";\r\nimport SelectableChatTag from \"./SelectableChatTag\";\r\nimport BulkSendActions from \"./BulkSendActions\";\r\nimport {clearUserSession} from \"../../../helpers/ApiHelper\";\r\nimport {generateCancelToken, listChatsCall, listMessagesCall, retrieveChatCall} from \"../../../api/ApiCalls\";\r\nimport Notifications from \"./Notifications/Notifications\";\r\nimport {Notifications as NotificationsIcon} from \"@material-ui/icons\";\r\nimport {generateAvatarColor} from \"../../../helpers/AvatarHelper\";\r\nimport {getObjLength} from \"../../../helpers/ObjectHelper\";\r\nimport {getHubURL} from \"../../../helpers/URLHelper\";\r\n\r\nfunction Sidebar(props) {\r\n\r\n    const {waId} = useParams();\r\n    const chatsContainer = useRef(null);\r\n    const [anchorEl, setAnchorEl] = useState(null);\r\n    const [keyword, setKeyword] = useState(\"\");\r\n    const [chatMessages, setChatMessages] = useState({});\r\n    const [contactResults, setContactResults] = useState({});\r\n    const [isProfileVisible, setProfileVisible] = useState(false);\r\n    const [isContactsVisible, setContactsVisible] = useState(false);\r\n    const [isChangePasswordDialogVisible, setChangePasswordDialogVisible] = useState(false);\r\n    const [isNotificationsVisible, setNotificationsVisible] = useState(false);\r\n    const [isLoadingMoreChats, setLoadingMoreChats] = useState(false);\r\n    const [tabCase, setTabCase] = useState(\"all\")\r\n\r\n    const history = useHistory();\r\n\r\n    const logOut = () => {\r\n        clearUserSession(undefined, undefined, history);\r\n        hideMenu();\r\n    }\r\n\r\n    const forceClearContactProvidersData = () => {\r\n        clearContactProvidersData();\r\n        window.location.reload();\r\n    }\r\n\r\n    const displayMenu = (event) => {\r\n        setAnchorEl(event.currentTarget);\r\n    }\r\n\r\n    const hideMenu = () => {\r\n        setAnchorEl(null);\r\n    }\r\n\r\n    let cancelTokenSourceRef = useRef();\r\n\r\n    useEffect(() => {\r\n        // Generate a token\r\n        cancelTokenSourceRef.current = generateCancelToken();\r\n\r\n        listChats(cancelTokenSourceRef.current, true, undefined, true);\r\n\r\n        if (keyword.trim().length > 0) {\r\n            searchMessages(cancelTokenSourceRef.current);\r\n        }\r\n\r\n        return () => {\r\n            if (cancelTokenSourceRef.current) {\r\n                cancelTokenSourceRef.current.cancel(\"Operation canceled due to new request.\");\r\n            }\r\n        }\r\n    }, [keyword]);\r\n\r\n    useEffect(() => {\r\n        // New chatMessages\r\n        const onNewMessages = function (msg, data) {\r\n            // We don't need to update if chats are filtered\r\n            if (keyword.trim().length === 0) {\r\n                let willMakeRequest = false;\r\n\r\n                const retrieveChatWaIdList = [];\r\n\r\n                const nextState = props.chats;\r\n                let changedAny = false;\r\n\r\n                Object.entries(data).forEach((message) => {\r\n                    //const msgId = message[0];\r\n                    const chatMessage = message[1];\r\n                    const chatMessageWaId = chatMessage.waId;\r\n\r\n                    // New chat, incoming or outgoing message\r\n                    // Check if chat with waId already exists\r\n                    if (!nextState.hasOwnProperty(chatMessageWaId)) {\r\n                        willMakeRequest = true;\r\n\r\n                        // Collect waid list to retrieve chats\r\n                        if (!retrieveChatWaIdList.includes(chatMessageWaId)) {\r\n                            retrieveChatWaIdList.push(chatMessageWaId);\r\n                        }\r\n                    }\r\n\r\n                    // Chats are ordered by incoming message date\r\n                    if (nextState.hasOwnProperty(chatMessageWaId)) {\r\n                        changedAny = true;\r\n\r\n                        // Update existing chat\r\n                        nextState[chatMessageWaId].setLastMessage(chatMessage.payload);\r\n\r\n                        // Incoming\r\n                        if (!chatMessage.isFromUs) {\r\n                            // Update name and initials on incoming message if name is missing\r\n                            const chat = nextState[chatMessageWaId];\r\n                            if (chat) {\r\n                                const chatName = chat.name;\r\n                                if (!containsLetters(chatName)) {\r\n                                    // Update sidebar chat name\r\n                                    nextState[chatMessageWaId].setName(chatMessage.senderName);\r\n\r\n                                    // Check if current chat\r\n                                    if (waId === chatMessageWaId) {\r\n                                        PubSub.publish(EVENT_TOPIC_UPDATE_PERSON_NAME, chatMessage.senderName);\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // New chatMessages\r\n                    if (!chatMessage.isFromUs && (waId !== chatMessageWaId || document.visibilityState === 'hidden' || props.isBlurred)) {\r\n                        const preparedNewMessages = props.newMessages;\r\n                        if (props.newMessages[chatMessageWaId] === undefined) {\r\n                            preparedNewMessages[chatMessageWaId] = new NewMessageClass(chatMessageWaId, 0);\r\n                        }\r\n\r\n                        // Increase number of new chatMessages\r\n                        preparedNewMessages[chatMessageWaId].newMessages++;\r\n\r\n                        props.setNewMessages({...preparedNewMessages});\r\n\r\n                        // Display a notification\r\n                        if (!chatMessage.isFromUs) {\r\n                            props.displayNotification(\"New messages\", \"You have new messages!\", chatMessageWaId);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                // If anything has changed, sort chats\r\n                if (changedAny) {\r\n                    // Sorting\r\n                    const sortedNextState = sortChats(nextState);\r\n                    props.setChats({...sortedNextState});\r\n                }\r\n\r\n                // We do this to generate new (missing) chat\r\n                if (willMakeRequest) {\r\n                    retrieveChatWaIdList.forEach((chatMessageWaId) => {\r\n                        retrieveChat(chatMessageWaId);\r\n                    })\r\n\r\n                    //listChats(cancelTokenSourceRef.current, false, undefined, false);\r\n                }\r\n            }\r\n        }\r\n\r\n        const newChatMessagesEventToken = PubSub.subscribe(EVENT_TOPIC_NEW_CHAT_MESSAGES, onNewMessages);\r\n\r\n        return () => {\r\n            PubSub.unsubscribe(newChatMessagesEventToken);\r\n        }\r\n    }, [waId, props.isBlurred, props.chats, props.newMessages, keyword]);\r\n\r\n    useEffect(() => {\r\n        const chatsContainerCopy = chatsContainer.current;\r\n\r\n        // To optimize scroll event\r\n        let debounceTimer;\r\n\r\n        function handleScroll(e) {\r\n            if (debounceTimer) {\r\n                window.clearTimeout(debounceTimer);\r\n            }\r\n\r\n            if (keyword) {\r\n                window.clearTimeout(debounceTimer);\r\n                return false;\r\n            }\r\n\r\n            debounceTimer = setTimeout(function () {\r\n                // const threshold = 0;\r\n                const el = e.target;\r\n\r\n                if (isScrollable(el)) {\r\n                    if (el.scrollHeight - el.scrollTop - el.clientHeight < 1) {\r\n                        listChats(cancelTokenSourceRef.current, false, getObjLength(props.chats), false);\r\n                    }\r\n                }\r\n            }, 100);\r\n        }\r\n\r\n        chatsContainerCopy.addEventListener(\"scroll\", handleScroll);\r\n\r\n        return () => {\r\n            clearTimeout(debounceTimer);\r\n            chatsContainerCopy.removeEventListener(\"scroll\", handleScroll);\r\n        }\r\n    }, [props.chats, keyword]);\r\n\r\n    const search = async (_keyword) => {\r\n        setKeyword(_keyword);\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (props.isSelectionModeEnabled) {\r\n            setContactsVisible(false);\r\n        }\r\n    }, [props.isSelectionModeEnabled]);\r\n\r\n    const sortChats = (state) => {\r\n        let sortedState = Object.entries(state).sort((a, b) => b[1].lastMessageTimestamp - a[1].lastMessageTimestamp);\r\n        return Object.fromEntries(sortedState);\r\n    }\r\n\r\n    const listChats = (cancelTokenSource, isInitial, offset, replaceAll) => {\r\n        if (!isInitial) {\r\n            setLoadingMoreChats(true);\r\n        }\r\n\r\n        listChatsCall(keyword, 18, offset, cancelTokenSource.token,\r\n            (response) => {\r\n                const preparedChats = {};\r\n                response.data.results.forEach((contact) => {\r\n                    const prepared = new ChatClass(contact);\r\n                    preparedChats[prepared.waId] = prepared;\r\n                });\r\n\r\n                props.setChats(prevState => {\r\n                    if (replaceAll) {\r\n                        return preparedChats;\r\n                    } else {\r\n                        return {...prevState, ...preparedChats};\r\n                    }\r\n                });\r\n\r\n                // In case param is undefined\r\n                isInitial = isInitial === true;\r\n\r\n                if (isInitial) {\r\n                    props.setProgress(100);\r\n                }\r\n\r\n                const willNotify = !isInitial;\r\n\r\n                const preparedNewMessages = {};\r\n                response.data.results.forEach((newMessage) => {\r\n                    const newWaId = newMessage.contact.waba_payload.wa_id;\r\n                    const newAmount = newMessage.new_messages;\r\n                    const prepared = new NewMessageClass(newWaId, newAmount);\r\n                    preparedNewMessages[prepared.waId] = prepared;\r\n                });\r\n\r\n                if (willNotify) {\r\n                    let hasAnyNewMessages = false;\r\n                    let chatMessageWaId;\r\n\r\n                    props.setNewMessages(prevState => {\r\n                            Object.entries(preparedNewMessages).forEach((newMsg) => {\r\n                                const newMsgWaId = newMsg[0]\r\n                                const number = newMsg[1].newMessages;\r\n                                if (newMsgWaId !== waId) {\r\n                                    // TODO: Consider a new contact (last part of the condition)\r\n                                    if ((prevState[newMsgWaId] && number > prevState[newMsgWaId].newMessages) /*|| (!prevState[newMsgWaId] && number > 0)*/) {\r\n                                        hasAnyNewMessages = true;\r\n\r\n                                        // There can be multiple new chats, we take first one\r\n                                        if (chatMessageWaId === newMsgWaId) chatMessageWaId = newMsgWaId;\r\n                                    }\r\n                                }\r\n                            });\r\n\r\n                            // When state is a JSON object, it is unable to understand whether it is different or same and renders again\r\n                            // So we check if new state is actually different than previous state\r\n                            if (JSON.stringify(preparedNewMessages) !== JSON.stringify(prevState)) {\r\n                                return {...prevState, ...preparedNewMessages};\r\n                            } else {\r\n                                return prevState;\r\n                            }\r\n                        }\r\n                    );\r\n\r\n                    // Display a notification\r\n                    if (hasAnyNewMessages) {\r\n                        props.displayNotification(\"New messages\", \"You have new messages!\", chatMessageWaId);\r\n                    }\r\n                } else {\r\n                    props.setNewMessages(prevState => {\r\n                        return {...prevState, ...preparedNewMessages}\r\n                    });\r\n                }\r\n\r\n                setLoadingMoreChats(false);\r\n\r\n            }, (error) => {\r\n                setLoadingMoreChats(false);\r\n            }, history);\r\n    }\r\n\r\n    const retrieveChat = (chatWaId) => {\r\n        retrieveChatCall(chatWaId,\r\n            (response) => {\r\n                const preparedChat = new ChatClass(response.data);\r\n\r\n                props.setChats(prevState => {\r\n                    prevState[chatWaId] = preparedChat;\r\n                    const sortedNextState = sortChats(prevState);\r\n                    return {...sortedNextState};\r\n                });\r\n            });\r\n    }\r\n\r\n    const searchMessages = (cancelTokenSource) => {\r\n        listMessagesCall(\r\n            undefined,\r\n            keyword, 30, undefined, undefined, undefined, cancelTokenSource.source,\r\n            (response) => {\r\n                const preparedMessages = {};\r\n                response.data.results.forEach((message) => {\r\n                    const prepared = new ChatMessageClass(message);\r\n                    preparedMessages[prepared.id] = prepared;\r\n                });\r\n\r\n                setChatMessages(preparedMessages);\r\n            }, undefined, history);\r\n    }\r\n\r\n    const goToMessage = (chatMessage) => {\r\n        if (waId !== chatMessage.waId) {\r\n            history.push({\r\n                'pathname': `/main/chat/${chatMessage.waId}`,\r\n                'goToMessage': chatMessage,\r\n            });\r\n        } else {\r\n            PubSub.publish(EVENT_TOPIC_GO_TO_MSG_ID, chatMessage);\r\n        }\r\n    }\r\n\r\n    const displayEditBusinessProfile = () => {\r\n        setAnchorEl(null);\r\n        setProfileVisible(true);\r\n    }\r\n\r\n    const goToSettings = () => {\r\n        setAnchorEl(null);\r\n        if (window.AndroidWebInterface) {\r\n            window.AndroidWebInterface.goToSettings();\r\n        }\r\n    }\r\n\r\n    const showChangePassword = () => {\r\n        setAnchorEl(null);\r\n        setChangePasswordDialogVisible(true);\r\n    }\r\n\r\n    const showChatTagsList = () => {\r\n        setAnchorEl(null);\r\n        props.setChatTagsListVisible(true);\r\n    }\r\n\r\n    const displayContacts = () => {\r\n        setContactsVisible(true);\r\n    }\r\n\r\n    const handleTabChange = (event, newValue) => {\r\n        setTabCase(newValue);\r\n    }\r\n\r\n    const clearFilter = () => {\r\n        props.setFilterTag(undefined);\r\n    }\r\n\r\n    const cancelSelection = () => {\r\n        props.setSelectionModeEnabled(false);\r\n        props.setSelectedChats([]);\r\n        props.setSelectedTags([]);\r\n    }\r\n\r\n    const finishBulkSendMessage = () => {\r\n        props.setSelectionModeEnabled(false);\r\n        props.finishBulkSendMessage();\r\n    }\r\n\r\n    const displayNotifications = () => {\r\n        setNotificationsVisible(true);\r\n    }\r\n\r\n    return (\r\n        <div className={\"sidebar\" + (props.isChatOnly ? \" hidden\" : \"\")}>\r\n            <div className=\"sidebar__header\">\r\n                <Avatar\r\n                    onClick={() => setProfileVisible(true)}\r\n                    className=\"cursorPointer\" style={{backgroundColor: generateAvatarColor(props.currentUser?.username)}}>\r\n                    {props.currentUser ? generateInitialsHelper(props.currentUser.username) : ''}\r\n                </Avatar>\r\n                <div className=\"sidebar__headerRight\">\r\n                    <IconButton onClick={displayContacts}>\r\n                        <ChatIcon />\r\n                    </IconButton>\r\n                    <IconButton onClick={displayNotifications}>\r\n                        <NotificationsIcon />\r\n                    </IconButton>\r\n                    <IconButton onClick={displayMenu}>\r\n                        <MoreVertIcon />\r\n                    </IconButton>\r\n                </div>\r\n            </div>\r\n\r\n            {props.isSelectionModeEnabled &&\r\n            <BulkSendActions\r\n                selectedChats={props.selectedChats}\r\n                selectedTags={props.selectedTags}\r\n                cancelSelection={cancelSelection}\r\n                finishBulkSendMessage={finishBulkSendMessage} />\r\n            }\r\n\r\n            <SearchBar onChange={(_keyword) => search(_keyword)} />\r\n\r\n            {props.filterTag &&\r\n            <div className=\"sidebar__clearFilter\" onClick={clearFilter}>\r\n                <CloseIcon />\r\n                Clear filter:&nbsp;\r\n                <span className=\"bold\">{props.filterTag.name}</span>\r\n            </div>\r\n            }\r\n\r\n            <div className=\"sidebar__tabs\">\r\n                <Tabs\r\n                    textColor=\"primary\"\r\n                    indicatorColor=\"primary\"\r\n                    variant={\"fullWidth\"}\r\n                    value={tabCase}\r\n                    scrollButtons=\"auto\"\r\n                    onChange={handleTabChange}>\r\n\r\n                    <Tab label={\"All\"} value={\"all\"} />\r\n                    <Tab label={\"Me\"} value={\"me\"} />\r\n                    <Tab label={\"Group\"} value={\"group\"} />\r\n\r\n                </Tabs>\r\n            </div>\r\n\r\n            <div\r\n                className=\"sidebar__results\"\r\n                ref={chatsContainer}>\r\n\r\n                {(props.isSelectionModeEnabled && props.tags) &&\r\n                <h3>Tags</h3>\r\n                }\r\n\r\n                {(props.isSelectionModeEnabled && props.tags) &&\r\n                <div>\r\n                    { Object.entries(props.tags).map((tag) =>\r\n                        <SelectableChatTag\r\n                            key={tag[0]}\r\n                            data={tag[1]}\r\n                            selectedTags={props.selectedTags}\r\n                            setSelectedTags={props.setSelectedTags} />\r\n                    )}\r\n                </div>\r\n                }\r\n\r\n                {(keyword.trim().length > 0 || props.isSelectionModeEnabled) &&\r\n                <h3>Chats</h3>\r\n                }\r\n\r\n                <div className=\"sidebar__results__chats\">\r\n                    { Object.entries(props.chats)\r\n                        .filter((chat) => {\r\n                            // Filter by helper method\r\n                            return filterChat(props, tabCase, chat[1]);\r\n                        })\r\n                        .map((chat) =>\r\n                            <SidebarChat\r\n                                key={chat[0]}\r\n                                chatData={chat[1]}\r\n                                newMessages={props.newMessages}\r\n                                keyword={keyword}\r\n                                contactProvidersData={props.contactProvidersData}\r\n                                retrieveContactData={props.retrieveContactData}\r\n                                tabCase={tabCase}\r\n                                bulkSendPayload={props.bulkSendPayload}\r\n                                isSelectionModeEnabled={props.isSelectionModeEnabled}\r\n                                selectedChats={props.selectedChats}\r\n                                setSelectedChats={props.setSelectedChats} />\r\n                        )}\r\n\r\n                    { Object.keys(props.chats).length === 0 &&\r\n                    <span className=\"sidebar__results__chats__noResult\">\r\n                        {keyword.trim().length > 0 ?\r\n                            <span>No chats found for: <span className=\"searchOccurrence\">{keyword}</span></span>\r\n                            :\r\n                            <span>You don't have any chats yet.</span>\r\n                        }\r\n                    </span>\r\n                    }\r\n                </div>\r\n\r\n                {(keyword.trim().length > 0 && getObjLength(contactResults) > 0) &&\r\n                <h3>Contacts</h3>\r\n                }\r\n\r\n                {(keyword.trim().length > 0 && getObjLength(contactResults) > 0) &&\r\n                <div className=\"sidebar__results__contacts\">\r\n                    { Object.entries(contactResults).map((contactResult) =>\r\n                        <SidebarContactResult\r\n                            key={contactResult[0]}\r\n                            chatData={contactResult[1]}\r\n                        />\r\n                    )}\r\n                </div>\r\n                }\r\n\r\n                {(keyword.trim().length > 0 && getObjLength(chatMessages) > 0) &&\r\n                <h3>Messages</h3>\r\n                }\r\n\r\n                {(keyword.trim().length > 0 && getObjLength(chatMessages) > 0) &&\r\n                <div className=\"sidebar__results__messages\">\r\n                    { Object.entries(chatMessages).map((message) =>\r\n                        <SearchMessageResult\r\n                            key={message[0]}\r\n                            waId={waId}\r\n                            messageData={message[1]}\r\n                            keyword={keyword}\r\n                            displaySender={true}\r\n                            onClick={(chatMessage) => goToMessage(chatMessage)} />\r\n                    )}\r\n                </div>\r\n                }\r\n            </div>\r\n\r\n            <Fade in={isLoadingMoreChats}>\r\n                <div className=\"sidebar__loadingMore\">\r\n                    <Zoom in={isLoadingMoreChats}>\r\n                        <div className=\"sidebar__loadingMore__wrapper\">\r\n                            <CircularProgress size={28}/>\r\n                        </div>\r\n                    </Zoom>\r\n                </div>\r\n            </Fade>\r\n\r\n            {isContactsVisible &&\r\n            <Contacts\r\n                contactProvidersData={props.contactProvidersData}\r\n                onHide={() => setContactsVisible(false)} />\r\n            }\r\n\r\n            {isProfileVisible &&\r\n            <BusinessProfile\r\n                isAdmin={props.isAdmin}\r\n                currentUser={props.currentUser}\r\n                onHide={() => setProfileVisible(false)}\r\n                displayEditBusinessProfile={displayEditBusinessProfile}\r\n                setChangePasswordDialogVisible={setChangePasswordDialogVisible} />\r\n            }\r\n\r\n            <BulkSendIndicator/>\r\n\r\n            <Menu\r\n                anchorEl={anchorEl}\r\n                getContentAnchorEl={null}\r\n                anchorOrigin={{ vertical: \"bottom\", horizontal: \"right\" }}\r\n                transformOrigin={{ vertical: \"top\", horizontal: \"right\" }}\r\n                keepMounted\r\n                open={Boolean(anchorEl)}\r\n                onClose={hideMenu}\r\n                elevation={3}>\r\n                <MenuItem onClick={showChatTagsList}>Tags</MenuItem>\r\n                <Divider />\r\n                <MenuItem className=\"sidebar__menu__refresh\" onClick={() => window.location.reload()}>Refresh</MenuItem>\r\n                <MenuItem onClick={showChangePassword}>Change password</MenuItem>\r\n                <MenuItem onClick={forceClearContactProvidersData}>Refresh contacts</MenuItem>\r\n                {props.isAdmin &&\r\n                <Divider />\r\n                }\r\n                {props.isAdmin &&\r\n                <MenuItem component={Link} href={getHubURL()} target=\"_blank\" color=\"initial\">Admin panel</MenuItem>\r\n                }\r\n                {isMobile &&\r\n                <MenuItem onClick={goToSettings}>Settings (App Only)</MenuItem>\r\n                }\r\n                <Divider />\r\n                <MenuItem onClick={logOut}>Logout</MenuItem>\r\n            </Menu>\r\n\r\n            <ChangePasswordDialog\r\n                open={isChangePasswordDialogVisible}\r\n                setOpen={setChangePasswordDialogVisible} />\r\n\r\n            {isNotificationsVisible &&\r\n            <Notifications\r\n                onHide={() => setNotificationsVisible(false)} />\r\n            }\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Sidebar","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\Chat.js",["426","427","428","429","430","431","432","433","434"],"import React, {useEffect, useRef, useState} from 'react'\r\nimport '../../../styles/Chat.css'\r\nimport {CircularProgress, Zoom} from \"@material-ui/core\";\r\nimport ChatMessage from \"./ChatMessage/ChatMessage\";\r\nimport {useHistory, useLocation, useParams} from \"react-router-dom\";\r\nimport {\r\n    ATTACHMENT_TYPE_DOCUMENT,\r\n    ATTACHMENT_TYPE_IMAGE,\r\n    ATTACHMENT_TYPE_VIDEO,\r\n    EVENT_TOPIC_CHAT_ASSIGNMENT,\r\n    EVENT_TOPIC_CHAT_MESSAGE_STATUS_CHANGE,\r\n    EVENT_TOPIC_CHAT_TAGGING, EVENT_TOPIC_CLEAR_TEXT_MESSAGE_INPUT,\r\n    EVENT_TOPIC_DROPPED_FILES,\r\n    EVENT_TOPIC_EMOJI_PICKER_VISIBILITY,\r\n    EVENT_TOPIC_GO_TO_MSG_ID,\r\n    EVENT_TOPIC_MARKED_AS_RECEIVED,\r\n    EVENT_TOPIC_NEW_CHAT_MESSAGES,\r\n    EVENT_TOPIC_SEND_TEMPLATE_MESSAGE_ERROR,\r\n    EVENT_TOPIC_SENT_TEMPLATE_MESSAGE,\r\n    EVENT_TOPIC_UPDATE_PERSON_NAME\r\n} from \"../../../Constants\";\r\nimport ChatMessageClass from \"../../../ChatMessageClass\";\r\nimport PersonClass from \"../../../PersonClass\";\r\nimport TemplateMessages from \"./TemplateMessages/TemplateMessages\";\r\nimport ChatFooter from \"./ChatFooter/ChatFooter\";\r\nimport ChatHeader from \"./ChatHeader\";\r\nimport ChatMessageOptionsMenu from \"./ChatMessage/ChatMessageOptionsMenu\";\r\nimport moment from \"moment\";\r\nimport PubSub from \"pubsub-js\";\r\nimport MessageDateIndicator from \"./MessageDateIndicator\";\r\nimport {\r\n    generateUnixTimestamp,\r\n    hasInternetConnection,\r\n    isScrollable,\r\n    sortMessagesAsc,\r\n    translateHTMLInputToText\r\n} from \"../../../helpers/Helpers\";\r\nimport PreviewSendMedia from \"./PreviewSendMedia\";\r\nimport {getDroppedFiles, handleDragOver, prepareSelectedFiles} from \"../../../helpers/FileHelper\";\r\nimport SavedResponses from \"./SavedResponses\";\r\nimport {generateTemplateMessagePayload} from \"../../../helpers/ChatHelper\";\r\nimport {isMobileOnly} from \"react-device-detect\";\r\nimport {clearUserSession} from \"../../../helpers/ApiHelper\";\r\nimport {\r\n    generateCancelToken,\r\n    listChatAssignmentEventsCall,\r\n    listChatTaggingEventsCall,\r\n    listMessagesCall,\r\n    markAsReceivedCall,\r\n    retrievePersonCall,\r\n    sendMessageCall,\r\n    uploadMediaCall\r\n} from \"../../../api/ApiCalls\";\r\nimport {Prompt} from 'react-router-dom';\r\nimport {getFirstObject, getLastObject, getObjLength} from \"../../../helpers/ObjectHelper\";\r\nimport {\r\n    extractTimestampFromMessage,\r\n    messageHelper\r\n} from \"../../../helpers/MessageHelper\";\r\n\r\nconst SCROLL_OFFSET = 15;\r\nconst SCROLL_LAST_MESSAGE_VISIBILITY_OFFSET = 150;\r\n\r\nexport default function Chat(props) {\r\n\r\n    const messagesContainer = useRef(null);\r\n\r\n    const [fixedDateIndicatorText, setFixedDateIndicatorText] = useState();\r\n    const [isLoaded, setLoaded] = useState(false);\r\n    const [isLoadingMoreMessages, setLoadingMoreMessages] = useState(false);\r\n    const [isExpired, setExpired] = useState(false);\r\n    const [isTemplateMessagesVisible, setTemplateMessagesVisible] = useState(false);\r\n    const [isSavedResponsesVisible, setSavedResponsesVisible] = useState(false);\r\n    const [person, setPerson] = useState();\r\n    const [messages, setMessages] = useState({});\r\n    const [input, setInput] = useState('');\r\n    const [isScrollButtonVisible, setScrollButtonVisible] = useState(false);\r\n\r\n    const [hasFailedMessages, setHasFailedMessages] = useState(false);\r\n\r\n    const [selectedFiles, setSelectedFiles] = useState();\r\n    const [accept, setAccept] = useState('');\r\n\r\n    const [isPreviewSendMediaVisible, setPreviewSendMediaVisible] = useState(false);\r\n    const [previewSendMediaData, setPreviewSendMediaData] = useState();\r\n\r\n    const [currentNewMessages, setCurrentNewMessages] = useState(0);\r\n\r\n    const [isAtBottom, setAtBottom] = useState(false);\r\n\r\n    const [lastMessageId, setLastMessageId] = useState();\r\n\r\n    const {waId} = useParams();\r\n\r\n    const history = useHistory();\r\n    const location = useLocation();\r\n\r\n    const cancelTokenSourceRef = useRef();\r\n\r\n    const confirmationMessage = \"There are unsent messages in the chat. If you continue, they will be deleted. Are you sure you want to continue?\";\r\n\r\n    useEffect(() => {\r\n        props.retrieveContactData(waId);\r\n\r\n        // Generate a token\r\n        cancelTokenSourceRef.current = generateCancelToken();\r\n\r\n        if (messagesContainer) {\r\n            messagesContainer.current.addEventListener('DOMNodeInserted', event => {\r\n                if (event.target.parentNode.id === \"chat__body\") {\r\n                    const {currentTarget: target} = event;\r\n                    target.scroll({top: target.scrollHeight - target.offsetHeight - SCROLL_OFFSET});\r\n                }\r\n            });\r\n        }\r\n\r\n        // Handle files dragged and dropped to sidebar chat\r\n        const handleFilesDropped = function (msg, data) {\r\n            setSelectedFiles(data);\r\n        }\r\n\r\n        // Listen for file drop events\r\n        const handleFilesDroppedEventToken = PubSub.subscribe(EVENT_TOPIC_DROPPED_FILES, handleFilesDropped);\r\n\r\n        // Clear input on event\r\n        const clearInputOnEvent = function (msg, data) {\r\n            clearInput();\r\n        }\r\n\r\n        // Listen for clear input events\r\n        const clearInputEventToken = PubSub.subscribe(EVENT_TOPIC_CLEAR_TEXT_MESSAGE_INPUT, clearInputOnEvent);\r\n\r\n        return () => {\r\n            // Cancelling ongoing requests\r\n            cancelTokenSourceRef.current.cancel();\r\n\r\n            // Unsubscribe\r\n            PubSub.unsubscribe(handleFilesDroppedEventToken);\r\n            PubSub.unsubscribe(clearInputEventToken);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setLoaded(false);\r\n\r\n        // Clear values for next route\r\n        setPerson(null);\r\n        setMessages([]);\r\n        setTemplateMessagesVisible(false);\r\n        setSavedResponsesVisible(false);\r\n        setAtBottom(false);\r\n        setInput('');\r\n        setHasFailedMessages(false);\r\n\r\n        setPreviewSendMediaVisible(false);\r\n        setPreviewSendMediaData(undefined);\r\n\r\n        props.previewMedia(null);\r\n\r\n        // Close emoji picker\r\n        PubSub.publish(EVENT_TOPIC_EMOJI_PICKER_VISIBILITY, false);\r\n\r\n        if (!waId) {\r\n            console.log('waId is empty.');\r\n            return false;\r\n        }\r\n\r\n        // Load contact and messages\r\n        retrievePerson(true);\r\n\r\n        return () => {\r\n            // Cancelling ongoing requests\r\n            cancelTokenSourceRef.current.cancel();\r\n\r\n            // Generate a new token, because component is not destroyed\r\n            cancelTokenSourceRef.current = generateCancelToken();\r\n        }\r\n    }, [waId]);\r\n\r\n    useEffect(() => {\r\n        // Window close event\r\n        window.addEventListener('beforeunload', alertUser);\r\n        return () => {\r\n            window.removeEventListener('beforeunload', alertUser);\r\n        }\r\n    }, [hasFailedMessages]);\r\n\r\n    const alertUser = e => {\r\n        if (hasFailedMessages) {\r\n            if (!window.confirm(confirmationMessage)) {\r\n                e.preventDefault()\r\n                e.returnValue = ''\r\n            }\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        props.setChosenContact(person);\r\n    }, [person]);\r\n\r\n    const getNewMessagesCount = () => {\r\n        return props.newMessages[waId]?.newMessages ?? 0;\r\n    }\r\n\r\n    useEffect(() => {\r\n        const newMessagesCount = getNewMessagesCount();\r\n        if (newMessagesCount > currentNewMessages) {\r\n            setCurrentNewMessages(newMessagesCount);\r\n        }\r\n    }, [waId, props.newMessages]);\r\n\r\n    useEffect(() => {\r\n        const messagesContainerCopy = messagesContainer.current;\r\n        const dateIndicators = messagesContainerCopy.querySelectorAll('.chat__message__outer > .chat__message__dateContainer > .chat__message__dateContainer__indicator');\r\n\r\n        // To optimize scroll event\r\n        let debounceTimer;\r\n\r\n        // Consider replacing this with IntersectionObserver\r\n        // Browser support should be considered: https://caniuse.com/intersectionobserver\r\n        function handleScroll(e) {\r\n            if (debounceTimer) {\r\n                window.clearTimeout(debounceTimer);\r\n            }\r\n\r\n            debounceTimer = setTimeout(function () {\r\n                const threshold = 0;\r\n                const el = e.target;\r\n\r\n                if (isScrollable(el)) {\r\n                    if (!canSeeLastMessage(el)) {\r\n                        setScrollButtonVisible(true);\r\n                    } else if (isAtBottom) {\r\n                        setScrollButtonVisible(false);\r\n\r\n                        if (currentNewMessages > 0) {\r\n                            const lastMessage = getLastObject(messages);\r\n                            if (lastMessage) {\r\n                                markAsReceived(extractTimestampFromMessage(lastMessage));\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (el.scrollTop <= threshold) {\r\n                        //console.log(\"Scrolled to top\");\r\n                        if (isLoaded && !isLoadingMoreMessages) {\r\n                            setLoadingMoreMessages(true);\r\n                            listMessages(false, undefined, getFirstObject(messages)?.timestamp);\r\n                        }\r\n                    } else {\r\n                        // TODO: Make sure user scrolls\r\n                        if (el.scrollHeight - el.scrollTop - el.clientHeight < 1) {\r\n                            //console.log('Scrolled to bottom');\r\n                            if (isLoaded && !isLoadingMoreMessages && !isAtBottom) {\r\n                                setLoadingMoreMessages(true);\r\n                                listMessages(false, undefined, undefined, undefined, getLastObject(messages)?.timestamp, true, false);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Second part, to display date\r\n                if (isLoaded) {\r\n                    prepareFixedDateIndicator(dateIndicators, el);\r\n                }\r\n            }, 100);\r\n        }\r\n\r\n        if (messagesContainer && isLoaded) {\r\n            messagesContainerCopy.addEventListener(\"scroll\", handleScroll);\r\n\r\n            // Display fixed date indicator\r\n            prepareFixedDateIndicator(dateIndicators, messagesContainerCopy);\r\n        }\r\n\r\n        return () => {\r\n            clearTimeout(debounceTimer);\r\n            messagesContainerCopy.removeEventListener(\"scroll\", handleScroll);\r\n        }\r\n    }, [messages, isLoaded, isLoadingMoreMessages, isAtBottom, currentNewMessages]);\r\n\r\n    useEffect(() => {\r\n        // New messages\r\n        const onNewMessages = function (msg, data) {\r\n            if (data && isLoaded) {\r\n                let hasAnyIncomingMsg = false;\r\n\r\n                const preparedMessages = {};\r\n                Object.entries(data).forEach((message) => {\r\n                    const msgId = message[0];\r\n                    const chatMessage = message[1];\r\n\r\n                    if (waId === chatMessage.waId) {\r\n                        preparedMessages[msgId] = chatMessage;\r\n\r\n                        if (!chatMessage.isFromUs) {\r\n                            hasAnyIncomingMsg = true;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (getObjLength(preparedMessages) > 0) {\r\n                    const lastMessage = getLastObject(preparedMessages);\r\n\r\n                    if (isAtBottom) {\r\n                        const prevScrollTop = messagesContainer.current.scrollTop;\r\n                        const prevScrollHeight = messagesContainer.current.scrollHeight;\r\n                        const isCurrentlyLastMessageVisible = isLastMessageVisible();\r\n\r\n                        setMessages(prevState => {\r\n                            return {...prevState, ...preparedMessages};\r\n                        });\r\n\r\n                        if (!isCurrentlyLastMessageVisible) {\r\n                            persistScrollStateFromBottom(prevScrollHeight, prevScrollTop, 0);\r\n                            displayScrollButton();\r\n                        }\r\n\r\n                        if (hasAnyIncomingMsg) {\r\n                            const lastMessageTimestamp = extractTimestampFromMessage(lastMessage);\r\n\r\n                            // Mark new message as received if visible\r\n                            if (canSeeLastMessage(messagesContainer.current)) {\r\n                                markAsReceived(lastMessageTimestamp);\r\n                            } else {\r\n                                setCurrentNewMessages(prevState => prevState+1);\r\n                            }\r\n\r\n                            // Update contact\r\n                            setPerson(prevState => {\r\n                                const nextState = prevState;\r\n                                nextState.lastMessageTimestamp = lastMessageTimestamp;\r\n                                nextState.isExpired = false;\r\n\r\n                                return nextState;\r\n                            });\r\n\r\n                            // Chat is not expired anymore\r\n                            setExpired(false);\r\n                        }\r\n                    } else {\r\n                        setCurrentNewMessages(prevState => prevState+1);\r\n                    }\r\n\r\n                    // Update last message id\r\n                    setLastMessageId(lastMessage.id);\r\n                }\r\n            }\r\n        }\r\n\r\n        const newChatMessagesEventToken = PubSub.subscribe(EVENT_TOPIC_NEW_CHAT_MESSAGES, onNewMessages);\r\n\r\n        // Status changes\r\n        const onMessageStatusChange = function (msg, data) {\r\n            if (data && isLoaded) {\r\n\r\n                // TODO: Check if message belongs to active conversation to avoid doing this unnecessarily\r\n                setMessages(prevState => {\r\n                    const newState = prevState;\r\n                    let changedAny = false;\r\n\r\n                    Object.entries(data).forEach((status) => {\r\n                        const statusMsgId = status[0];\r\n                        const statusObj = status[1];\r\n\r\n                        if (newState[statusMsgId]) {\r\n                            if (statusObj.sentTimestamp) {\r\n                                changedAny = true;\r\n                                newState[statusMsgId].sentTimestamp = statusObj.sentTimestamp;\r\n                            }\r\n\r\n                            if (statusObj.deliveredTimestamp) {\r\n                                changedAny = true;\r\n                                newState[statusMsgId].deliveredTimestamp = statusObj.deliveredTimestamp;\r\n                            }\r\n\r\n                            if (statusObj.readTimestamp) {\r\n                                changedAny = true;\r\n                                newState[statusMsgId].readTimestamp = statusObj.readTimestamp;\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    if (changedAny) {\r\n                        return {...newState};\r\n                    } else {\r\n                        return prevState;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        const chatMessageStatusChangeEventToken = PubSub.subscribe(EVENT_TOPIC_CHAT_MESSAGE_STATUS_CHANGE, onMessageStatusChange);\r\n\r\n        // Chat assignment\r\n        const onChatAssignment = function (msg, data) {\r\n            // This event always has a single message\r\n            const prepared = getFirstObject(data);\r\n            if (waId === prepared.waId) {\r\n                if (isAtBottom) {\r\n                    const prevScrollTop = messagesContainer.current.scrollTop;\r\n                    const prevScrollHeight = messagesContainer.current.scrollHeight;\r\n                    const isCurrentlyLastMessageVisible = isLastMessageVisible();\r\n\r\n                    // Display as a new message\r\n                    setMessages(prevState => {\r\n                        return {...prevState, ...data};\r\n                    });\r\n\r\n                    if (!isCurrentlyLastMessageVisible) {\r\n                        persistScrollStateFromBottom(prevScrollHeight, prevScrollTop, 0);\r\n                        displayScrollButton();\r\n                    }\r\n                } else {\r\n                    displayScrollButton();\r\n                }\r\n            }\r\n        }\r\n\r\n        const chatAssignmentEventToken = PubSub.subscribe(EVENT_TOPIC_CHAT_ASSIGNMENT, onChatAssignment);\r\n\r\n        // Chat tagging\r\n        const onChatAssignmentOrChatTagging = function (msg, data) {\r\n            // This event always has a single message\r\n            const prepared = getFirstObject(data);\r\n            if (waId === prepared.waId) {\r\n                if (isAtBottom) {\r\n                    const prevScrollTop = messagesContainer.current.scrollTop;\r\n                    const prevScrollHeight = messagesContainer.current.scrollHeight;\r\n                    const isCurrentlyLastMessageVisible = isLastMessageVisible();\r\n\r\n                    // Display as a new message\r\n                    setMessages(prevState => {\r\n                        return {...prevState, ...data};\r\n                    });\r\n\r\n                    if (!isCurrentlyLastMessageVisible) {\r\n                        persistScrollStateFromBottom(prevScrollHeight, prevScrollTop, 0);\r\n                        displayScrollButton();\r\n                    }\r\n                } else {\r\n                    displayScrollButton();\r\n                }\r\n            }\r\n        }\r\n\r\n        const chatTaggingEventToken = PubSub.subscribe(EVENT_TOPIC_CHAT_TAGGING, onChatAssignmentOrChatTagging);\r\n\r\n        return () => {\r\n            PubSub.unsubscribe(newChatMessagesEventToken);\r\n            PubSub.unsubscribe(chatMessageStatusChangeEventToken);\r\n            PubSub.unsubscribe(chatAssignmentEventToken);\r\n            PubSub.unsubscribe(chatTaggingEventToken);\r\n        }\r\n    }, [waId, messages, isLoaded, /*isLoadingMoreMessages,*/ isExpired, isAtBottom, currentNewMessages]);\r\n\r\n    useEffect(() => {\r\n        const hasNewerToLoad = lastMessageId === undefined || !messages.hasOwnProperty(lastMessageId); //(previous != null && typeof previous !== typeof undefined);\r\n        //console.log(\"Has newer to load:\", hasNewerToLoad);\r\n        setAtBottom(!hasNewerToLoad);\r\n\r\n    }, [messages, lastMessageId]);\r\n\r\n    useEffect(() => {\r\n        const onUpdatePersonName = function (msg, data) {\r\n            const name = data;\r\n            setPerson(prevState => {\r\n                prevState?.setName(name);\r\n                // Assign object to a new instance to trigger change\r\n                return Object.assign(PersonClass.newInstance(), prevState);\r\n            });\r\n        }\r\n\r\n        const updatePersonNameTokenEventToken = PubSub.subscribe(EVENT_TOPIC_UPDATE_PERSON_NAME, onUpdatePersonName);\r\n\r\n        return () => {\r\n            PubSub.unsubscribe(updatePersonNameTokenEventToken);\r\n        }\r\n    }, [person]);\r\n\r\n    /*useEffect(() => {\r\n        // Scrolling to bottom on initial templates load\r\n        if (!isLoadingTemplates) {\r\n            const target = messagesContainer.current;\r\n            target.scroll({top: target.scrollHeight - SCROLL_OFFSET});\r\n        }\r\n    }, [isLoadingTemplates]);*/\r\n\r\n    const prepareFixedDateIndicator = (dateIndicators, el) => {\r\n        const curScrollTop = el.scrollTop;\r\n        let indicatorToShow;\r\n\r\n        for (let i = 0; i < dateIndicators.length; i++) {\r\n            const indicator = dateIndicators[i];\r\n            if (indicatorToShow === undefined || indicator.offsetTop <= curScrollTop) {\r\n                indicatorToShow = indicator;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (indicatorToShow) {\r\n            setFixedDateIndicatorText(indicatorToShow.innerHTML);\r\n        }\r\n    }\r\n\r\n    const isLastMessageVisible = () => {\r\n        const el = messagesContainer.current;\r\n        return el.scrollHeight - el.scrollTop - el.clientHeight < SCROLL_LAST_MESSAGE_VISIBILITY_OFFSET;\r\n    }\r\n\r\n    const displayScrollButton = () => {\r\n        setScrollButtonVisible(true);\r\n    }\r\n\r\n    const canSeeLastMessage = (element) => {\r\n        return !(element.scrollHeight - element.scrollTop - element.clientHeight > SCROLL_LAST_MESSAGE_VISIBILITY_OFFSET);\r\n    }\r\n\r\n    const handleScrollButtonClick = () => {\r\n        if (isAtBottom) {\r\n            const el = messagesContainer.current;\r\n            el.scroll({top: el.scrollHeight - el.offsetHeight - SCROLL_OFFSET, behavior: \"smooth\"});\r\n        } else {\r\n            listMessages(false, undefined, undefined, undefined, undefined, false, true);\r\n        }\r\n\r\n        //setScrollButtonVisible(false);\r\n    }\r\n\r\n    const persistScrollStateFromBottom = (prevScrollHeight, prevScrollTop, offset) => {\r\n        const nextScrollHeight = messagesContainer.current.scrollHeight;\r\n        messagesContainer.current.scrollTop = (nextScrollHeight - prevScrollHeight) + prevScrollTop - offset;\r\n    }\r\n\r\n    const scrollToChild = (msgId) => {\r\n        setTimeout(function () {\r\n            const child = messagesContainer.current.querySelector('#message_' + msgId);\r\n            let _offset = 25;\r\n            if (child) {\r\n                let targetOffsetTop = child.offsetTop - _offset;\r\n                if (targetOffsetTop < SCROLL_OFFSET) targetOffsetTop = SCROLL_OFFSET;\r\n                messagesContainer.current.scroll({top: targetOffsetTop, behavior: \"smooth\"});\r\n\r\n                child.classList.add('blink');\r\n\r\n                setTimeout(function () {\r\n                    if (child) {\r\n                        child.classList.remove('blink');\r\n                    }\r\n                }, 1000);\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    const goToMessageId = (msgId, timestamp) => {\r\n        if (messagesContainer.current) {\r\n            if (msgId) {\r\n                if (messages[msgId]) {\r\n                    console.log(\"This message is already loaded.\");\r\n                    scrollToChild(msgId);\r\n                } else {\r\n                    console.log(\"This message will be loaded.\");\r\n\r\n                    // TODO: Cancel other messages requests first\r\n\r\n                    // Load messages since clicked results\r\n                    setLoadingMoreMessages(true);\r\n                    const callback = () => {\r\n                        scrollToChild(msgId);\r\n                    };\r\n                    listMessages(false, callback, undefined, undefined, timestamp, true, true);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        const onGoToMessageId = function (msg, data) {\r\n            const msgId = data.id;\r\n            const timestamp = data.timestamp;\r\n\r\n            goToMessageId(msgId, timestamp);\r\n        }\r\n\r\n        // Subscribe for scrolling to message event\r\n        const token = PubSub.subscribe(EVENT_TOPIC_GO_TO_MSG_ID, onGoToMessageId);\r\n\r\n        return () => {\r\n            // Unsubscribe\r\n            PubSub.unsubscribe(token);\r\n        }\r\n    }, [messages, isAtBottom]);\r\n\r\n    useEffect(() => {\r\n        if (selectedFiles) {\r\n            handleChosenFiles();\r\n        }\r\n    }, [selectedFiles]);\r\n\r\n    const [optionsChatMessage, setOptionsChatMessage] = useState();\r\n    const [menuAnchorEl, setMenuAnchorEl] = useState();\r\n\r\n    const displayOptionsMenu = (event, chatMessage) => {\r\n        // We need to use parent because menu view gets hidden\r\n        setMenuAnchorEl(event.currentTarget.parentElement);\r\n        setOptionsChatMessage(chatMessage);\r\n    }\r\n\r\n    const retrievePerson = (loadMessages) => {\r\n        retrievePersonCall(waId, cancelTokenSourceRef.current.token, (response) => {\r\n            const preparedPerson = new PersonClass(response.data);\r\n            setPerson(preparedPerson);\r\n            setExpired(preparedPerson.isExpired);\r\n\r\n            // Person information is loaded, now load messages\r\n            if (loadMessages !== undefined && loadMessages === true) {\r\n                listMessages(true, function (preparedMessages) {\r\n                    setLastMessageId(getLastObject(preparedMessages)?.id);\r\n\r\n                    // Scroll to message if goToMessageId is defined\r\n                    const goToMessage = location.goToMessage;\r\n                    if (goToMessage !== undefined) {\r\n                        goToMessageId(goToMessage.id, goToMessage.timestamp);\r\n                    }\r\n                });\r\n            }\r\n        }, (error) => {\r\n            if (error.response?.status === 404) {\r\n                if (location.person) {\r\n                    const preparedPerson = new PersonClass({});\r\n                    preparedPerson.name = location.person.name;\r\n                    preparedPerson.initials = location.person.initials;\r\n                    preparedPerson.waId = waId;\r\n\r\n                    setPerson(preparedPerson);\r\n\r\n                    setExpired(true);\r\n                    setLoaded(true);\r\n                    setLoadingMoreMessages(false);\r\n                    setAtBottom(true);\r\n                } else {\r\n                    // To prevent missing data on refresh\r\n                    closeChat();\r\n                }\r\n            } else {\r\n                window.displayError(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    const listMessages = (isInitial, callback, beforeTime, offset, sinceTime, isInitialWithSinceTime, replaceAll) => {\r\n        const limit = 30;\r\n\r\n        listMessagesCall(waId, undefined, limit, offset ?? 0, beforeTime, sinceTime, cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                const count = response.data.count;\r\n                //const previous = response.data.previous;\r\n                const next = response.data.next;\r\n\r\n                if (sinceTime && isInitialWithSinceTime === true) {\r\n                    if (next) { /*count > limit*/\r\n                        setAtBottom(false);\r\n                        listMessages(false, callback, beforeTime, count - limit, sinceTime, false, replaceAll);\r\n                        return false;\r\n                    }\r\n                }\r\n\r\n                const preparedMessages = {};\r\n                response.data.results.reverse().forEach((message) => {\r\n                    const prepared = new ChatMessageClass(message);\r\n                    preparedMessages[prepared.id] = prepared;\r\n                });\r\n\r\n                const lastMessage = getLastObject(preparedMessages);\r\n\r\n                // Pagination filters for events\r\n                let beforeTimeForEvents = beforeTime;\r\n                let sinceTimeForEvents = sinceTime;\r\n\r\n                if (isInitial) {\r\n                    beforeTimeForEvents = undefined;\r\n                } else {\r\n                    if (!beforeTime) {\r\n                        beforeTimeForEvents = lastMessage?.timestamp;\r\n                    }\r\n                }\r\n\r\n                if (!sinceTime) {\r\n                    sinceTimeForEvents = getFirstObject(preparedMessages)?.timestamp;\r\n                }\r\n\r\n                // List assignment events\r\n                listChatAssignmentEvents(preparedMessages, isInitial, callback, replaceAll, beforeTime, sinceTime, beforeTimeForEvents, sinceTimeForEvents);\r\n            }, (error) => {\r\n                setLoadingMoreMessages(false);\r\n            }, history);\r\n    }\r\n\r\n    // Chain: listMessages -> listChatAssignmentEvents -> listChatTaggingEvents -> finishLoadingMessages\r\n    const finishLoadingMessages = (preparedMessages, isInitial, callback, replaceAll, beforeTime, sinceTime) => {\r\n\r\n        // Sort prepared messages\r\n        preparedMessages = sortMessagesAsc(preparedMessages);\r\n\r\n        if (getObjLength(preparedMessages) > 0) {\r\n            // To persist scroll position, we store current scroll information\r\n            const prevScrollTop = messagesContainer.current.scrollTop;\r\n            const prevScrollHeight = messagesContainer.current.scrollHeight;\r\n\r\n            setMessages((prevState => {\r\n                let nextState;\r\n                if (replaceAll) {\r\n                    nextState = preparedMessages;\r\n                } else {\r\n                    if (sinceTime) {\r\n                        nextState = {...prevState, ...preparedMessages}\r\n                    } else {\r\n                        nextState = {...preparedMessages, ...prevState}\r\n                    }\r\n                }\r\n\r\n                // Sort final object\r\n                return sortMessagesAsc(nextState);\r\n            }));\r\n\r\n            if (!sinceTime || replaceAll) {\r\n                persistScrollStateFromBottom(prevScrollHeight, prevScrollTop, SCROLL_OFFSET);\r\n            } else if (sinceTime) {\r\n                messagesContainer.current.scrollTop = prevScrollTop;\r\n            }\r\n        }\r\n\r\n        setLoaded(true);\r\n        setLoadingMoreMessages(false);\r\n\r\n        // TODO: Check unread messages first and then decide to do it or not\r\n        if (isInitial) {\r\n            // beforeTime is not passed only for initial request\r\n            // Mark messages as received\r\n            const lastMessageTimestamp = messageHelper(preparedMessages);\r\n            markAsReceived(lastMessageTimestamp);\r\n        }\r\n\r\n        // Promise\r\n        if (callback) {\r\n            setTimeout(function () {\r\n                callback(preparedMessages);\r\n            }, 50);\r\n        }\r\n    }\r\n\r\n    const listChatAssignmentEvents = (preparedMessages, isInitial, callback, replaceAll, beforeTime, sinceTime, beforeTimeForEvents, sinceTimeForEvents) => {\r\n        listChatAssignmentEventsCall(waId, beforeTimeForEvents, sinceTimeForEvents, cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                response.data.results.reverse().forEach((assignmentEvent) => {\r\n                    const prepared = ChatMessageClass.fromAssignmentEvent(assignmentEvent);\r\n                    preparedMessages[prepared.id] = prepared;\r\n                });\r\n\r\n                // List chat tagging events\r\n                listChatTaggingEvents(preparedMessages, isInitial, callback, replaceAll, beforeTime, sinceTime, beforeTimeForEvents, sinceTimeForEvents);\r\n            });\r\n    }\r\n\r\n    const listChatTaggingEvents = (preparedMessages, isInitial, callback, replaceAll, beforeTime, sinceTime, beforeTimeForEvents, sinceTimeForEvents) => {\r\n        listChatTaggingEventsCall(waId, beforeTimeForEvents, sinceTimeForEvents, cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                response.data.results.reverse().forEach((taggingEvent) => {\r\n                    const prepared = ChatMessageClass.fromTaggingEvent(taggingEvent);\r\n                    preparedMessages[prepared.id] = prepared;\r\n                });\r\n\r\n                // Finish loading\r\n                finishLoadingMessages(preparedMessages, isInitial, callback, replaceAll, beforeTime, sinceTime);\r\n            });\r\n    }\r\n\r\n    const resendMessage = (message) => {\r\n        const successCallback = () => {\r\n            // Delete message if resent successfully\r\n            setMessages(prevState => {\r\n                delete prevState[message.id];\r\n\r\n                // Check if there is another failed message\r\n                let hasAnotherFailedMessage = false;\r\n\r\n                for (let i = 0; i < getObjLength(messages); i++) {\r\n                    const curMessage = messages[i];\r\n                    if (curMessage.isFailed && !curMessage.isStored) {\r\n                        hasAnotherFailedMessage = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                setHasFailedMessages(hasAnotherFailedMessage);\r\n\r\n                return {...prevState};\r\n            });\r\n        }\r\n\r\n        const resendPayload = message.resendPayload;\r\n\r\n        if (resendPayload.type === ChatMessageClass.TYPE_TEXT || resendPayload.text) {\r\n            sendMessage(undefined, resendPayload, successCallback);\r\n        } else if (resendPayload.type === ChatMessageClass.TYPE_TEMPLATE) {\r\n            sendTemplateMessage(undefined, resendPayload, successCallback);\r\n        } else {\r\n            // File\r\n            sendFile(undefined, undefined, resendPayload, successCallback);\r\n        }\r\n    }\r\n\r\n    const sendCustomTextMessage = (text) => {\r\n        sendMessage(undefined, {\r\n            wa_id: waId,\r\n            text: {\r\n                body: text.trim()\r\n            }\r\n        });\r\n    }\r\n\r\n    const bulkSendMessage = (type, payload) => {\r\n        props.setSelectionModeEnabled(true);\r\n\r\n        if (type === ChatMessageClass.TYPE_TEXT) {\r\n            const preparedInput = translateHTMLInputToText(input).trim();\r\n            payload = {\r\n                type: \"text\",\r\n                text: {\r\n                    body: preparedInput\r\n                }\r\n            };\r\n        }\r\n\r\n        props.setBulkSendPayload(payload);\r\n\r\n        // Close chat on mobile\r\n        if (isMobileOnly) {\r\n            closeChat();\r\n        }\r\n    }\r\n\r\n    const sendMessage = (e, customPayload, callback) => {\r\n        e?.preventDefault();\r\n\r\n        // Check if has internet connection\r\n        if (!hasInternetConnection()) {\r\n            window.displayCustomError('Check your internet connection.');\r\n            return false;\r\n        }\r\n\r\n        let requestBody;\r\n\r\n        if (e) {\r\n            const preparedInput = translateHTMLInputToText(input).trim();\r\n\r\n            if (preparedInput === '') {\r\n                return false;\r\n            }\r\n\r\n            console.log('You typed: ', preparedInput);\r\n\r\n            requestBody = {\r\n                wa_id: waId,\r\n                text: {\r\n                    body: preparedInput\r\n                }\r\n            };\r\n        } else if (customPayload) {\r\n            // Resend payload is being sent\r\n            requestBody = customPayload;\r\n        }\r\n\r\n        if (isLoaded) {\r\n            sendMessageCall(requestBody,\r\n                (response) => {\r\n                    // TODO: Display message immediately\r\n                    /*const messageId = response.data?.waba_response?.messages?.[0]?.id;\r\n                    setMessages(prevState => {\r\n                        const sentMessage = new ChatMessageClass();\r\n                        prevState[messageId] = sentMessage;\r\n                        return {...prevState};\r\n                    });*/\r\n\r\n                    if (callback) {\r\n                        callback();\r\n                    }\r\n                }, (error) => {\r\n                    if (error.response) {\r\n                        const status = error.response.status;\r\n                        // Switch to expired mode if status code is 453\r\n                        if (status === 453) {\r\n                            setExpired(true);\r\n                        } else if (status === 500 || status === 502) {\r\n                            const isStored = status === 502;\r\n                            displayFailedMessage(requestBody, isStored, true);\r\n\r\n                            // This will be used to display a warning before refreshing\r\n                            if (!isStored) {\r\n                                setHasFailedMessages(true);\r\n                            }\r\n                        }\r\n\r\n                        handleIfUnauthorized();\r\n                    }\r\n                });\r\n\r\n            clearInput();\r\n\r\n            // Close emoji picker\r\n            PubSub.publish(EVENT_TOPIC_EMOJI_PICKER_VISIBILITY, false);\r\n        }\r\n    }\r\n\r\n    const sendTemplateMessage = (templateMessage, customPayload, callback) => {\r\n        let requestBody;\r\n\r\n        if (customPayload) {\r\n            requestBody = customPayload;\r\n        } else {\r\n            requestBody = generateTemplateMessagePayload(templateMessage);\r\n            requestBody.wa_id = waId;\r\n        }\r\n\r\n        if (isLoaded) {\r\n            sendMessageCall(requestBody,\r\n                (response) => {\r\n                    // Hide dialog by this event\r\n                    PubSub.publish(EVENT_TOPIC_SENT_TEMPLATE_MESSAGE, true);\r\n\r\n                    if (callback) {\r\n                        callback();\r\n                    }\r\n                }, (error) => {\r\n                    if (error.response) {\r\n                        const errors = error.response.data?.waba_response?.errors;\r\n                        PubSub.publish(EVENT_TOPIC_SEND_TEMPLATE_MESSAGE_ERROR, errors);\r\n\r\n                        const status = error.response.status;\r\n\r\n                        if (status === 453) {\r\n                            setExpired(true);\r\n                        } else if (status === 500 || status === 502) {\r\n                            const isStored = status === 502;\r\n                            displayFailedMessage(requestBody, isStored);\r\n                        }\r\n\r\n                        handleIfUnauthorized(error);\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n    const displayFailedMessage = (requestBody, isStored, willClearInput) => {\r\n        setMessages(prevState => {\r\n            let text;\r\n\r\n            if (requestBody.type === ChatMessageClass.TYPE_TEXT || requestBody.text) {\r\n                text = requestBody.text.body;\r\n            } else if (requestBody.type === ChatMessageClass.TYPE_TEMPLATE) {\r\n                text = requestBody.template.name;\r\n            } else {\r\n                // File\r\n                text = requestBody.link;\r\n            }\r\n\r\n            const timestamp = generateUnixTimestamp();\r\n            const messageId = 'failed_' + timestamp;\r\n            const failedMessage = new ChatMessageClass();\r\n            failedMessage.id = messageId;\r\n            failedMessage.text = text;\r\n            failedMessage.isFromUs = true;\r\n            failedMessage.isFailed = true;\r\n            failedMessage.isStored = isStored;\r\n            failedMessage.timestamp = timestamp;\r\n            failedMessage.resendPayload = requestBody;\r\n\r\n            prevState[messageId] = failedMessage;\r\n            return {...prevState};\r\n        });\r\n\r\n        if (willClearInput === true) {\r\n            clearInput();\r\n        }\r\n    }\r\n\r\n    const clearInput = () => {\r\n        setInput('')\r\n    }\r\n\r\n    const sendFile = (fileURL, chosenFile, customPayload, callback) => {\r\n        let requestBody;\r\n\r\n        if (customPayload) {\r\n            requestBody = customPayload;\r\n        } else {\r\n            const caption = chosenFile.caption;\r\n            const type = chosenFile.attachmentType;\r\n            const file = chosenFile.file;\r\n            const filename = file.name;\r\n            const mimeType = file.type;\r\n\r\n            requestBody = {\r\n                wa_id: waId,\r\n                recipient_type: 'individual',\r\n                to: waId,\r\n                type: type\r\n            };\r\n\r\n            requestBody[type] = {\r\n                link: fileURL,\r\n                mime_type: mimeType,\r\n            }\r\n\r\n            // caption param is accepted for only images and videos\r\n            if (type === ATTACHMENT_TYPE_IMAGE || type === ATTACHMENT_TYPE_VIDEO) {\r\n                requestBody[type]['caption'] = caption;\r\n            }\r\n\r\n            // filename param is accepted for documents\r\n            if (type === ATTACHMENT_TYPE_DOCUMENT) {\r\n                requestBody[type]['filename'] = filename;\r\n            }\r\n        }\r\n\r\n        if (isLoaded) {\r\n            sendMessageCall(requestBody,\r\n                (response) => {\r\n                    // Send next request (or resend callback)\r\n                    callback();\r\n                }, (error) => {\r\n                    if (error.response) {\r\n                        const status = error.response.status;\r\n\r\n                        if (status === 453) {\r\n                            setExpired(true);\r\n                        } else if (status === 500 || status === 502) {\r\n                            const isStored = status === 502;\r\n                            displayFailedMessage(requestBody, isStored);\r\n                        }\r\n\r\n                        handleIfUnauthorized(error);\r\n                    }\r\n\r\n                    // Send next when it fails, a retry can be considered\r\n                    // If custom payload is empty, it means it is resending, so it is just a success callback\r\n                    if (!customPayload) {\r\n                        callback();\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n    const handleChosenFiles = () => {\r\n        if (getObjLength(selectedFiles) > 0) {\r\n            const preparedFiles = prepareSelectedFiles(selectedFiles);\r\n\r\n            setPreviewSendMediaData(preparedFiles);\r\n            setPreviewSendMediaVisible(true);\r\n        }\r\n    }\r\n\r\n    const sendHandledChosenFiles = (preparedFiles) => {\r\n        if (isLoaded && preparedFiles) {\r\n            const requests = [];\r\n\r\n            // Sending all files in a loop\r\n            Object.entries(preparedFiles).forEach((curFile) => {\r\n                const curChosenFile = curFile[1];\r\n                const file = curChosenFile.file;\r\n\r\n                const formData = new FormData();\r\n                formData.append(\"file_encoded\", file);\r\n\r\n                requests.push({\r\n                    formData: formData,\r\n                    chosenFile: curChosenFile\r\n                });\r\n            });\r\n\r\n            let requestIndex = 0;\r\n\r\n            const sendRequest = (request) => {\r\n                const sendNextRequest = () => {\r\n                    requestIndex++;\r\n                    const nextRequest = requests[requestIndex];\r\n                    if (nextRequest) {\r\n                        sendRequest(nextRequest);\r\n                    }\r\n                }\r\n\r\n                uploadMediaCall(request.formData,\r\n                    (response) => {\r\n                        // Convert parameters to a ChosenFile object\r\n                        sendFile(response.data.file, request.chosenFile, undefined, function () {\r\n                            sendNextRequest();\r\n                        });\r\n                    }, (error) => {\r\n                        if (error.response) {\r\n                            if (error.response) {\r\n                                handleIfUnauthorized(error);\r\n                            }\r\n                        }\r\n\r\n                        // Send next when it fails, a retry can be considered\r\n                        sendNextRequest();\r\n                    });\r\n            }\r\n\r\n            sendRequest(requests[requestIndex]);\r\n        }\r\n    }\r\n\r\n    const handleDrop = (event) => {\r\n        if (waId) {\r\n            setSelectedFiles(getDroppedFiles(event));\r\n        } else {\r\n            event.preventDefault();\r\n        }\r\n    }\r\n\r\n    const markAsReceived = (timestamp) => {\r\n        markAsReceivedCall(waId, timestamp, cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                PubSub.publish(EVENT_TOPIC_MARKED_AS_RECEIVED, waId);\r\n                setCurrentNewMessages(0);\r\n            });\r\n    }\r\n\r\n    const handleIfUnauthorized = (error) => {\r\n        if (error.response.status === 401) {\r\n            clearUserSession(\"invalidToken\", undefined, history);\r\n        }\r\n    }\r\n\r\n    const closeChat = () => {\r\n        history.push(\"/main\");\r\n    }\r\n\r\n    let lastPrintedDate;\r\n    let lastSenderWaId;\r\n\r\n    return (\r\n        <div\r\n            className={\"chat\" + (waId ? \" chatOpen\" : \"\") + (props.isChatOnly ? \" chatFullWidth\" : \"\")}\r\n            onDrop={(event) => handleDrop(event)}\r\n            onDragOver={(event) => handleDragOver(event)}>\r\n\r\n            <Prompt when={hasFailedMessages}\r\n                    message={confirmationMessage} />\r\n\r\n            <ChatHeader\r\n                person={person}\r\n                contactProvidersData={props.contactProvidersData}\r\n                retrieveContactData={props.retrieveContactData}\r\n                isChatOnly={props.isChatOnly}\r\n                setChatAssignmentVisible={props.setChatAssignmentVisible}\r\n                setChatTagsVisible={props.setChatTagsVisible}\r\n                closeChat={closeChat} />\r\n\r\n            <Zoom in={(isLoaded && !isLoadingMoreMessages && (fixedDateIndicatorText !== undefined && fixedDateIndicatorText.trim().length > 0))}>\r\n                <div className=\"chat__body__dateIndicator\">\r\n                    <MessageDateIndicator text={fixedDateIndicatorText} />\r\n                </div>\r\n            </Zoom>\r\n\r\n            <Zoom in={(waId && !isLoaded) || isLoadingMoreMessages}>\r\n                <div className=\"chat__body__loadingMore\">\r\n                    <div className=\"chat__body__loadingMore__wrapper\">\r\n                        <CircularProgress size={28} />\r\n                    </div>\r\n                </div>\r\n            </Zoom>\r\n\r\n            <div id=\"chat__body\" className=\"chat__body\" ref={messagesContainer} onDrop={(event) => event.preventDefault()}>\r\n                <div className=\"chat__empty\"/>\r\n\r\n                { Object.entries(messages).map((message, index) => {\r\n\r\n                    // Message date is created here and passed to ChatMessage for a better performance\r\n                    const curMsgDate = moment.unix(message[1].timestamp);\r\n\r\n                    if (index === 0) {\r\n                        lastPrintedDate = undefined;\r\n                        lastSenderWaId = undefined;\r\n                    }\r\n\r\n                    let willDisplayDate = false;\r\n                    if (lastPrintedDate === undefined) {\r\n                        willDisplayDate = true;\r\n                        lastPrintedDate = moment.unix(message[1].timestamp);\r\n                    } else {\r\n                        if (!curMsgDate.isSame(lastPrintedDate, 'day')) {\r\n                            willDisplayDate = true;\r\n                        }\r\n\r\n                        lastPrintedDate = curMsgDate;\r\n                    }\r\n\r\n                    let willDisplaySender = false;\r\n                    const curSenderWaId = message[1].getUniqueSender();\r\n                    if (lastSenderWaId === undefined) {\r\n                        willDisplaySender = true;\r\n                        lastSenderWaId = message[1].getUniqueSender();\r\n                    } else {\r\n                        if (lastSenderWaId !== curSenderWaId) {\r\n                            willDisplaySender = true;\r\n                        }\r\n\r\n                        lastSenderWaId = message[1].getUniqueSender();\r\n                    }\r\n\r\n                    return (\r\n                        <ChatMessage\r\n                            key={message[0]}\r\n                            messageData={message[1]}\r\n                            displayDate={willDisplayDate}\r\n                            displaySender={willDisplaySender}\r\n                            date={curMsgDate}\r\n                            onPreview={(chatMessage) => props.previewMedia(chatMessage)}\r\n                            templates={props.templates}\r\n                            goToMessageId={goToMessageId}\r\n                            onOptionsClick={(event, chatMessage) => displayOptionsMenu(event, chatMessage)}\r\n                            contactProvidersData={props.contactProvidersData}\r\n                            retrieveContactData={props.retrieveContactData}\r\n                            resendMessage={(message) => resendMessage(message)} />\r\n                    )\r\n                }) }\r\n\r\n                <div className=\"chat__body__empty\" />\r\n\r\n            </div>\r\n\r\n            <ChatFooter\r\n                waId={waId}\r\n                currentNewMessages={currentNewMessages}\r\n                isExpired={isExpired}\r\n                input={input}\r\n                setInput={setInput}\r\n                sendMessage={sendMessage}\r\n                bulkSendMessage={bulkSendMessage}\r\n                setSelectedFiles={setSelectedFiles}\r\n                isTemplateMessagesVisible={isTemplateMessagesVisible}\r\n                setTemplateMessagesVisible={setTemplateMessagesVisible}\r\n                isSavedResponsesVisible={isSavedResponsesVisible}\r\n                setSavedResponsesVisible={setSavedResponsesVisible}\r\n                sendHandledChosenFiles={sendHandledChosenFiles}\r\n                accept={accept}\r\n                setAccept={setAccept}\r\n                isScrollButtonVisible={isScrollButtonVisible}\r\n                handleScrollButtonClick={handleScrollButtonClick}\r\n                closeChat={closeChat} />\r\n\r\n            {isTemplateMessagesVisible &&\r\n            <TemplateMessages\r\n                waId={waId}\r\n                templatesData={props.templates}\r\n                onSend={(templateMessage) => sendTemplateMessage(templateMessage)}\r\n                onBulkSend={bulkSendMessage}\r\n                isLoadingTemplates={props.isLoadingTemplates} />\r\n            }\r\n\r\n            {isSavedResponsesVisible &&\r\n            <SavedResponses\r\n                savedResponses={props.savedResponses}\r\n                deleteSavedResponse={props.deleteSavedResponse}\r\n                sendCustomTextMessage={sendCustomTextMessage} />\r\n            }\r\n\r\n            {!waId &&\r\n            <div className=\"chat__default\">\r\n                <h2>Hey</h2>\r\n                <p>Choose a contact to start a conversation</p>\r\n            </div>\r\n            }\r\n\r\n            <ChatMessageOptionsMenu\r\n                menuAnchorEl={menuAnchorEl}\r\n                setMenuAnchorEl={setMenuAnchorEl}\r\n                optionsChatMessage={optionsChatMessage}\r\n                createSavedResponse={props.createSavedResponse} />\r\n\r\n            {isPreviewSendMediaVisible &&\r\n            <PreviewSendMedia\r\n                data={previewSendMediaData}\r\n                setData={setPreviewSendMediaData}\r\n                setPreviewSendMediaVisible={setPreviewSendMediaVisible}\r\n                sendHandledChosenFiles={sendHandledChosenFiles}\r\n                accept={accept} />\r\n            }\r\n\r\n        </div>\r\n    )\r\n}","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\SidebarChat.js",["435","436"],"import React, {useEffect, useState} from 'react';\r\nimport '../../../styles/SidebarChat.css';\r\nimport {Avatar, Checkbox, ListItem, Tooltip} from \"@material-ui/core\";\r\nimport {useHistory, useParams} from \"react-router-dom\";\r\nimport LabelIcon from '@material-ui/icons/Label';\r\nimport GroupIcon from '@material-ui/icons/Group';\r\nimport Moment from \"react-moment\";\r\nimport moment from \"moment\";\r\nimport {\r\n    addPlus,\r\n    extractAvatarFromContactProviderData,\r\n    generateInitialsHelper,\r\n    markOccurrences\r\n} from \"../../../helpers/Helpers\";\r\nimport {getDroppedFiles, handleDragOver} from \"../../../helpers/FileHelper\";\r\nimport PubSub from \"pubsub-js\";\r\nimport {\r\n    CALENDAR_SHORT,\r\n    EVENT_TOPIC_DROPPED_FILES,\r\n    SIDEBAR_TAB_CASE_ALL,\r\n    SIDEBAR_TAB_CASE_GROUP,\r\n    SIDEBAR_TAB_CASE_ME\r\n} from \"../../../Constants\";\r\nimport ChatMessageShortContent from \"../Chat/ChatMessage/ChatMessageShortContent\";\r\nimport {generateAvatarColor} from \"../../../helpers/AvatarHelper\";\r\nimport {replaceEmojis} from \"../../../helpers/EmojiHelper\";\r\n\r\nfunction SidebarChat(props) {\r\n\r\n    const history = useHistory();\r\n\r\n    const [isSelected, setSelected] = useState(false);\r\n    const [isExpired, setExpired] = useState(props.chatData.isExpired);\r\n    const [timeLeft, setTimeLeft] = useState();\r\n    const [remainingSeconds, setRemainingSeconds] = useState();\r\n    const {waId} = useParams();\r\n\r\n    useEffect(() => {\r\n        setSelected(props.selectedChats.includes(props.chatData.waId));\r\n    }, [props.selectedChats]);\r\n\r\n    const generateTagNames = () => {\r\n        const generatedTagNames = [];\r\n        props.chatData.tags?.forEach((tag) => {\r\n            generatedTagNames.push(tag.name);\r\n        });\r\n        return generatedTagNames.join(', ');\r\n    }\r\n\r\n    useEffect(() => {\r\n        function calculateRemaining() {\r\n            const momentDate = moment.unix(props.chatData.lastReceivedMessageTimestamp);\r\n            momentDate.add(1, 'day');\r\n            const curDate = moment(new Date());\r\n            const hours = momentDate.diff(curDate, 'hours');\r\n            const seconds = momentDate.diff(curDate, 'seconds');\r\n\r\n            setRemainingSeconds(seconds);\r\n\r\n            let suffix;\r\n\r\n            if (hours > 0) {\r\n                suffix = 'h';\r\n                setTimeLeft(hours + suffix);\r\n            } else {\r\n                const minutes = momentDate.diff(curDate, 'minutes');\r\n                if (minutes > 1) {\r\n                    suffix = 'm';\r\n                    setTimeLeft(minutes + suffix);\r\n                } else {\r\n                    if (seconds > 1) {\r\n                        suffix = 'm';\r\n                        setTimeLeft(minutes + suffix);\r\n                    } else {\r\n                        // Expired\r\n                        setExpired(true);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        setExpired(props.chatData.isExpired);\r\n\r\n        // Initial\r\n        calculateRemaining();\r\n\r\n        let intervalId;\r\n        if (!isExpired) {\r\n            intervalId = setInterval(() => {\r\n                calculateRemaining();\r\n            }, 30000);\r\n        }\r\n\r\n        return () => {\r\n            clearInterval(intervalId);\r\n        }\r\n    }, [isExpired, props.chatData.isExpired, props.chatData.lastMessageTimestamp]);\r\n\r\n    const handleDroppedFiles = (event) => {\r\n        if (isExpired) {\r\n            event.preventDefault();\r\n            return;\r\n        }\r\n\r\n        // Preparing dropped files\r\n        const files = getDroppedFiles(event);\r\n\r\n        // Switching to related chat\r\n        history.push(`/main/chat/${props.chatData.waId}`);\r\n\r\n        // Sending files via eventbus\r\n        PubSub.publish(EVENT_TOPIC_DROPPED_FILES, files);\r\n    }\r\n\r\n    const handleClick = () => {\r\n        if (props.isSelectionModeEnabled) {\r\n            if (isDisabled()) return;\r\n\r\n            let newSelectedState = !isSelected;\r\n\r\n            props.setSelectedChats(prevState => {\r\n                if (newSelectedState) {\r\n                    if (!prevState.includes(props.chatData.waId)) {\r\n                        prevState.push(props.chatData.waId);\r\n                    }\r\n                } else {\r\n                    prevState = prevState.filter(arrayItem => arrayItem !== props.chatData.waId);\r\n                }\r\n\r\n                return [...prevState];\r\n            });\r\n\r\n        } else {\r\n            history.push(`/main/chat/${props.chatData.waId}`);\r\n        }\r\n    }\r\n\r\n    const isDisabled = () => {\r\n        return isExpired && props.bulkSendPayload?.type !== 'template';\r\n    }\r\n\r\n    return (\r\n        <ListItem button onClick={handleClick}>\r\n            <div\r\n                id={props.chatData.waId}\r\n                className={\r\n                    'sidebarChatWrapper '\r\n                    + (waId === props.chatData.waId ? 'activeChat ' : '') + (isExpired ? 'expired ' : (remainingSeconds < 8 * 60 * 60 ? 'almostExpired ' : ''))\r\n                    + (props.isSelectionModeEnabled && isSelected ? 'isSelected ' : '')\r\n                }\r\n                onDrop={(event) => handleDroppedFiles(event)}\r\n                onDragOver={(event) => handleDragOver(event)}>\r\n\r\n                <div className=\"sidebarChat\">\r\n\r\n                    {props.isSelectionModeEnabled &&\r\n                    <Checkbox className=\"sidebarChat__selection\" checked={isSelected} color=\"primary\" disabled={isDisabled()} />\r\n                    }\r\n\r\n                    <div className=\"sidebarChat__avatarWrapper\">\r\n                        <Avatar src={extractAvatarFromContactProviderData(props.contactProvidersData[props.chatData.waId])}\r\n                                style={isExpired ? {} : {backgroundColor: generateAvatarColor(props.chatData.name)}}>\r\n                            {props.chatData.initials}\r\n                        </Avatar>\r\n\r\n                        {(props.chatData.assignedToUser && ((props.tabCase === SIDEBAR_TAB_CASE_ALL) || (props.tabCase === SIDEBAR_TAB_CASE_GROUP))) &&\r\n                        <Tooltip title={props.chatData.generateAssignmentInformation()}>\r\n                            <Avatar className=\"sidebarChat__avatarWrapper__assignee\" style={{\r\n                                backgroundColor: generateAvatarColor(props.chatData.getAssignedUserUsername())\r\n                            }}>\r\n                                {generateInitialsHelper(props.chatData.generateAssignedToInitials())}\r\n                            </Avatar>\r\n                        </Tooltip>\r\n                        }\r\n\r\n                        {(props.chatData.assignedGroup\r\n                            && ((props.tabCase === SIDEBAR_TAB_CASE_ALL && !props.chatData.assignedToUser)\r\n                                || (props.tabCase === SIDEBAR_TAB_CASE_ME)\r\n                                || (props.tabCase === SIDEBAR_TAB_CASE_GROUP && !props.chatData.assignedToUser)))\r\n                        &&\r\n                        <Tooltip title={props.chatData.generateAssignmentInformation()}>\r\n                            <Avatar className=\"sidebarChat__avatarWrapper__assignee\"\r\n                                style={{backgroundColor: generateAvatarColor(props.chatData.assignedGroup?.name)}}>\r\n                                <GroupIcon />\r\n                            </Avatar>\r\n                        </Tooltip>\r\n                        }\r\n                    </div>\r\n\r\n                    <div className=\"sidebarChat__info\">\r\n                        <div className=\"sidebarChat__info__nameWrapper\">\r\n                            <h2>\r\n                                {(props.keyword !== undefined && props.keyword.trim().length > 0)\r\n                                    ?\r\n                                    <span dangerouslySetInnerHTML={{__html: markOccurrences(replaceEmojis(props.chatData.name), props.keyword)}}/>\r\n                                    :\r\n                                    <span dangerouslySetInnerHTML={{__html: replaceEmojis(props.contactProvidersData[props.chatData.waId]?.[0]?.name ?? props.chatData.name)}} />\r\n                                }\r\n\r\n                                {props.chatData.tags?.length > 0 &&\r\n                                <div className=\"sidebarChat__info__tags\">\r\n                                    <Tooltip title={generateTagNames()}>\r\n                                        <LabelIcon className={props.chatData.tags.length > 1 ? \"multiple\" : \"\"} style={{fill: props.chatData.tags[0].web_inbox_color}} />\r\n                                    </Tooltip>\r\n                                </div>\r\n                                }\r\n                            </h2>\r\n\r\n                            <div className=\"sidebarChat__info__date\">\r\n                                {props.chatData.lastMessageTimestamp &&\r\n                                <Moment\r\n                                    className=\"sidebarChat__info__nameWrapper__lastMessageDate\"\r\n                                    date={props.chatData.lastMessageTimestamp}\r\n                                    calendar={CALENDAR_SHORT}\r\n                                    unix />\r\n                                }\r\n\r\n                                {!isExpired &&\r\n                                <span className=\"sidebarChat__info__date__timeLeft\">{timeLeft} left</span>\r\n                                }\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"sidebarChat__info__lastMessage\">\r\n                            {((props.newMessages[props.chatData.waId]?.newMessages ?? 0) > 0 /*&& waId !== props.chatData.waId*/)\r\n                                ?\r\n                                <div className=\"sidebarChat__info__lastMessage__new\">\r\n                                    {props.newMessages[props.chatData.waId]?.newMessages} new message(s)\r\n                                </div>\r\n                                :\r\n                                <div className=\"sidebarChat__info__lastMessage__body\">\r\n                                    <ChatMessageShortContent\r\n                                        type={props.chatData.lastMessageType}\r\n                                        buttonText={props.chatData.lastMessageButtonText}\r\n                                        text={props.chatData.lastMessageBody}\r\n                                        caption={props.chatData.lastMessageCaption}\r\n                                        isLastMessageFromUs={props.chatData.isLastMessageFromUs } />\r\n                                </div>\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <span className=\"sidebarChatWrapper__waId\">{addPlus(props.chatData.waId)}</span>\r\n\r\n            </div>\r\n        </ListItem>\r\n    )\r\n}\r\n\r\nexport default SidebarChat","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\SidebarContactResult.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\BusinessProfile.js",["437"],"import React, {useEffect, useRef, useState} from \"react\";\r\nimport '../../../styles/BusinessProfile.css';\r\nimport {Avatar, Button, FormControl, IconButton, InputLabel, MenuItem, Select, TextField} from \"@material-ui/core\";\r\nimport {ArrowBack} from \"@material-ui/icons\";\r\nimport {generateInitialsHelper} from \"../../../helpers/Helpers\";\r\nimport FileInput from \"../../FileInput\";\r\nimport {avatarStyles} from \"../../../AvatarStyles\";\r\nimport {\r\n    deleteProfilePhotoCall,\r\n    generateCancelToken,\r\n    retrieveBusinessProfileCall,\r\n    retrieveProfileAboutCall,\r\n    retrieveProfilePhotoCall,\r\n    updateBusinessProfileCall,\r\n    updateProfileAboutCall,\r\n    updateProfilePhotoCall\r\n} from \"../../../api/ApiCalls\";\r\n\r\nfunction BusinessProfile(props) {\r\n\r\n    const [isLoaded, setLoaded] = useState(false);\r\n    const [isUpdating, setUpdating] = useState(false);\r\n    const [address, setAddress] = useState('');\r\n    const [description, setDescription] = useState('');\r\n    const [email, setEmail] = useState('');\r\n    const [vertical, setVertical] = useState('');\r\n    const [websites, setWebsites] = useState({});\r\n    const [about, setAbout] = useState('');\r\n    const [profilePhoto, setProfilePhoto] = useState();\r\n\r\n    const fileInput = useRef();\r\n\r\n    const cancelTokenSourceRef = useRef();\r\n\r\n    const avatarClasses = avatarStyles();\r\n\r\n    useEffect(() => {\r\n        const handleKey = (event) => {\r\n            if (event.keyCode === 27) { // Escape\r\n                props.onHide();\r\n            }\r\n        }\r\n\r\n        document.addEventListener('keydown', handleKey);\r\n\r\n        // Generate a token\r\n        cancelTokenSourceRef.current = generateCancelToken();\r\n\r\n        retrieveBusinessProfile();\r\n\r\n        return () => {\r\n            document.removeEventListener('keydown', handleKey);\r\n            cancelTokenSourceRef.current.cancel();\r\n        }\r\n    }, []);\r\n\r\n    const retrieveBusinessProfile = () => {\r\n        retrieveBusinessProfileCall(cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                const data = response.data;\r\n\r\n                setAddress(data.address);\r\n                setDescription(data.description);\r\n                setEmail(data.email);\r\n                setVertical(data.vertical);\r\n\r\n                let websitesArray = data.websites;\r\n                if (websitesArray.length === 0) {\r\n                    websitesArray = [];\r\n                }\r\n\r\n                setWebsites({...websitesArray});\r\n\r\n                // Load about\r\n                retrieveProfileAbout();\r\n            });\r\n    }\r\n\r\n    const updateBusinessProfile = async event => {\r\n        event.preventDefault();\r\n\r\n        setUpdating(true);\r\n\r\n        updateBusinessProfileCall(address, description, email, vertical, Object.values(websites),\r\n            cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                updateProfileAbout(event);\r\n            }, (error) => {\r\n                setUpdating(false);\r\n            });\r\n    }\r\n\r\n    const retrieveProfileAbout = () => {\r\n        retrieveProfileAboutCall(cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                const profile = response.data.settings?.profile;\r\n                setAbout(profile?.about?.text);\r\n                retrieveProfilePhoto();\r\n            });\r\n    }\r\n\r\n    const updateProfileAbout = async event => {\r\n        event.preventDefault();\r\n\r\n        updateProfileAboutCall(about, cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                setUpdating(false);\r\n            }, (error) => {\r\n                setUpdating(false);\r\n            });\r\n    }\r\n\r\n    const retrieveProfilePhoto = () => {\r\n        retrieveProfilePhotoCall(cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                const base64 = Buffer.from(response.data, 'binary').toString('base64');\r\n                setProfilePhoto(base64);\r\n\r\n                // Finish\r\n                setLoaded(true);\r\n            }, (error) => {\r\n                // No photo\r\n                if (error?.response?.status === 404) {\r\n                    // Finish\r\n                    setLoaded(true);\r\n                } else {\r\n                    window.displayError(error);\r\n                }\r\n            });\r\n    }\r\n\r\n    const updateProfilePhoto = async (file) => {\r\n        const formData = new FormData();\r\n        formData.append(\"file_encoded\", file[0]);\r\n\r\n        updateProfilePhotoCall(formData, cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                setUpdating(false);\r\n\r\n                // Display new photo\r\n                retrieveProfilePhoto();\r\n            }, (error) => {\r\n                setUpdating(false);\r\n            });\r\n    }\r\n\r\n    const deleteProfilePhoto = () => {\r\n        deleteProfilePhotoCall(cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                setProfilePhoto(undefined);\r\n            });\r\n    }\r\n\r\n    const verticalOptions = [\r\n        \"Automotive\", \"Beauty, Spa and Salon\",\r\n        \"Clothing and Apparel\",\r\n        \"Education\",\r\n        \"Entertainment\",\r\n        \"Event Planning and Service\",\r\n        \"Finance and Banking\",\r\n        \"Food and Grocery\",\r\n        \"Public Service\",\r\n        \"Hotel and Lodging\",\r\n        \"Medical and Health\",\r\n        \"Non-profit\",\r\n        \"Professional Services\",\r\n        \"Shopping and Retail\",\r\n        \"Travel and Transportation\",\r\n        \"Restaurant\",\r\n        \"Other\"\r\n    ];\r\n\r\n    const handleBusinessProfileAvatarClick = () => {\r\n        if (props.isAdmin) fileInput.current.click();\r\n    }\r\n\r\n    return(\r\n        <div className=\"sidebarBusinessProfile\">\r\n            <div className=\"sidebarBusinessProfile__header\">\r\n                <IconButton onClick={props.onHide}>\r\n                    <ArrowBack />\r\n                </IconButton>\r\n\r\n                <h3>Profile</h3>\r\n            </div>\r\n\r\n            <div className=\"sidebarBusinessProfile__body\">\r\n                <div className=\"sidebarBusinessProfile__body__section\">\r\n                    {props.currentUser &&\r\n                    <div>\r\n                        <div className=\"sidebarBusinessProfile__body__section__header\">\r\n                            <h5>Personal Profile</h5>\r\n                        </div>\r\n\r\n                        <div className=\"sidebarBusinessProfile__body__avatarContainer\">\r\n                            <Avatar className={avatarClasses[generateInitialsHelper(props.currentUser.username)?.[0]]}>{generateInitialsHelper(props.currentUser.username)}</Avatar>\r\n                        </div>\r\n\r\n                        <h3>{props.currentUser.username}</h3>\r\n                        <span>{props.currentUser.first_name + ' ' + props.currentUser.last_name}</span>\r\n\r\n                        <div className=\"sidebarBusinessProfile__body__changePasswordContainer\">\r\n                            <Button onClick={() => props.setChangePasswordDialogVisible(true)} color=\"secondary\">Change password</Button>\r\n                        </div>\r\n                    </div>\r\n                    }\r\n                </div>\r\n\r\n                <div className=\"sidebarBusinessProfile__body__section\">\r\n                    <div className=\"sidebarBusinessProfile__body__section__header\">\r\n                        <h5>Business Profile</h5>\r\n                    </div>\r\n\r\n                    {!isLoaded &&\r\n                    <span>Loading</span>\r\n                    }\r\n\r\n                    {isLoaded &&\r\n                    <div className=\"sidebarBusinessProfile__body__section__subSection\">\r\n\r\n                        <div className={\"sidebarBusinessProfile__body__avatarContainer\" + (props.isAdmin ? \" editable\" : \"\")}>\r\n                            <FileInput innerRef={fileInput} handleSelectedFiles={(file) => updateProfilePhoto(file)} accept=\"image/jpeg, image/png\" multiple={false} />\r\n                            <Avatar src={profilePhoto ? \"data:image/png;base64,\" + profilePhoto : undefined} onClick={handleBusinessProfileAvatarClick} />\r\n\r\n                            {(profilePhoto && props.isAdmin) &&\r\n                            <Button onClick={deleteProfilePhoto} color=\"secondary\">Delete profile photo</Button>\r\n                            }\r\n                        </div>\r\n\r\n                        <form onSubmit={updateBusinessProfile}>\r\n                            <div>\r\n                                <TextField value={about} onChange={e => setAbout(e.target.value)} label=\"About\" size=\"medium\" multiline={true} fullWidth={true} InputProps={{readOnly: !props.isAdmin}} />\r\n                                <TextField value={address} onChange={e => setAddress(e.target.value)} label=\"Address\" size=\"medium\" fullWidth={true} InputProps={{readOnly: !props.isAdmin}} />\r\n                                <TextField value={description} onChange={e => setDescription(e.target.value)} label=\"Description\" size=\"medium\" fullWidth={true} InputProps={{readOnly: !props.isAdmin}} />\r\n                                <TextField value={email} onChange={e => setEmail(e.target.value)} label=\"E-mail\" size=\"medium\" fullWidth={true} InputProps={{readOnly: !props.isAdmin}} />\r\n\r\n                                <FormControl fullWidth={true} disabled={!props.isAdmin}>\r\n                                    <InputLabel id=\"vertical-label\">Vertical</InputLabel>\r\n                                    <Select value={vertical} onChange={(event) => setVertical(event.target.value)} labelId=\"vertical-label\">\r\n                                        <MenuItem value=\"\">None</MenuItem>\r\n\r\n                                        {verticalOptions.map((verticalOption, index) =>\r\n                                            <MenuItem key={index} value={verticalOption}>{verticalOption}</MenuItem>\r\n                                        )}\r\n                                    </Select>\r\n                                </FormControl>\r\n                            </div>\r\n\r\n                            {props.isAdmin &&\r\n                            <div className=\"sidebarBusinessProfile__body__section__subSection__action\">\r\n                                <Button type=\"submit\" disabled={isUpdating} color=\"primary\" size=\"large\">Update</Button>\r\n                            </div>\r\n                            }\r\n                        </form>\r\n                    </div>\r\n                    }\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default BusinessProfile;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\ChangePasswordDialog.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\SelectableChatTag.js",["438"],"import React, {useEffect, useState} from \"react\";\r\nimport {Checkbox, ListItem} from \"@material-ui/core\";\r\nimport LabelIcon from \"@material-ui/icons/Label\";\r\nimport '../../../styles/SelectableChatTag.css';\r\n\r\nfunction SelectableChatTag(props) {\r\n    const [isSelected, setSelected] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setSelected(props.selectedTags.includes(props.data.id));\r\n    }, [props.selectedTags]);\r\n\r\n    const handleClick = () => {\r\n        props.setSelectedTags(prevState => {\r\n            if (prevState.includes(props.data.id)) {\r\n                prevState = prevState.filter(arrayItem => arrayItem !== props.data.id);\r\n            } else {\r\n                prevState.push(props.data.id);\r\n            }\r\n\r\n            return [...prevState];\r\n        });\r\n    }\r\n\r\n    return (\r\n        <ListItem className=\"sidebarTagListItem\" button onClick={handleClick}>\r\n            <div className={\r\n                'sidebarTag '\r\n                + (isSelected ? 'isSelected ' : '')\r\n            }>\r\n                <Checkbox className=\"sidebarTag__selection\" checked={isSelected} color=\"primary\"/>\r\n                <div className=\"sidebarTag__selection__tag\">\r\n                    <LabelIcon style={{fill: props.data.web_inbox_color}} />\r\n                    {props.data.name}\r\n                </div>\r\n            </div>\r\n        </ListItem>\r\n    )\r\n}\r\n\r\nexport default SelectableChatTag;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\BulkSendIndicator.js",["439"],"import React, {useEffect, useState} from \"react\";\r\nimport '../../../styles/BulkSendIndicator.css';\r\nimport {LinearProgress} from \"@material-ui/core\";\r\nimport PubSub from \"pubsub-js\";\r\nimport {CALENDAR_SHORT, EVENT_TOPIC_BULK_MESSAGE_TASK, EVENT_TOPIC_BULK_MESSAGE_TASK_STARTED} from \"../../../Constants\";\r\nimport Moment from \"react-moment\";\r\nimport {getObjLength} from \"../../../helpers/ObjectHelper\";\r\nimport {generateMessagePreview} from \"../../../helpers/MessageHelper\";\r\n\r\nfunction BulkSendIndicator(props) {\r\n\r\n    const [tasks, setTasks] = useState({});\r\n\r\n    const addTask = (prevState, task) => {\r\n        if (!(task.id in task) || task.done > tasks[task.id].done) {\r\n            prevState[task.id] = task;\r\n        }\r\n\r\n        return prevState;\r\n    }\r\n\r\n    useEffect(() => {\r\n        const onBulkMessageTask = function (msg, data) {\r\n            setTasks((prevState) => {\r\n                Object.entries(data).forEach((curTask) => {\r\n                    const task = curTask[1];\r\n                    prevState = addTask(prevState, task);\r\n                });\r\n\r\n                return {...prevState};\r\n            });\r\n        }\r\n\r\n        const bulkMessageTaskToken = PubSub.subscribe(EVENT_TOPIC_BULK_MESSAGE_TASK, onBulkMessageTask);\r\n\r\n        const onBulkMessageTaskStarted = function (msg, data) {\r\n            setTasks(prevState => {\r\n                return {...addTask(prevState, data)}\r\n            });\r\n        }\r\n\r\n        const bulkMessageTaskStartedToken = PubSub.subscribe(EVENT_TOPIC_BULK_MESSAGE_TASK_STARTED, onBulkMessageTaskStarted);\r\n\r\n        return () => {\r\n            PubSub.unsubscribe(bulkMessageTaskToken);\r\n            PubSub.unsubscribe(bulkMessageTaskStartedToken);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        let intervalId;\r\n\r\n        if (getObjLength(tasks) > 0) {\r\n            intervalId = setInterval(function () {\r\n                const nextState = tasks;\r\n                let changedAny = false;\r\n                const now = (new Date()).getTime();\r\n\r\n                // Delete tasks after 5 seconds after their completion\r\n                Object.entries(tasks).forEach((curTask) => {\r\n                    const task = curTask[1];\r\n                    if (task.done >= task.total) {\r\n                        if (task.doneAt) {\r\n                            const secondsPast = Math.floor((now - task.doneAt) / 1000);\r\n                            if (secondsPast >= 5) {\r\n                                delete nextState[task.id];\r\n                                changedAny = true;\r\n                            }\r\n                        } else {\r\n                            task.doneAt = now;\r\n                            changedAny = true;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (changedAny) {\r\n                    setTasks({...nextState});\r\n                }\r\n            }, 1000);\r\n        }\r\n\r\n        return () => {\r\n            clearInterval(intervalId);\r\n        }\r\n    }, [tasks]);\r\n\r\n    return (\r\n        <div className=\"bulkSendIndicatorWrapper\">\r\n            {Object.entries(tasks).map((task) =>\r\n            <div className=\"bulkSendIndicator\" key={task.id}>\r\n                <div className=\"mb-1\">Sending ({task[1].done} / {task[1].total})</div>\r\n                <div className=\"bulkSendIndicator__messagePreviewWrapper mb-1\">\r\n                    <span className=\"bulkSendIndicator__messagePreview\">\r\n                        {generateMessagePreview(task[1].payload)}\r\n                    </span>\r\n                </div>\r\n                <div className=\"bulkSendIndicator__timestamp mb-2\">\r\n                    Started at <Moment className=\"bold\" date={task[1].timestamp} calendar={CALENDAR_SHORT} unix />\r\n                </div>\r\n                <LinearProgress variant=\"determinate\" value={(task[1].done * 100) / task[1].total} />\r\n            </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default BulkSendIndicator;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\BulkSendActions.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\MessageDateIndicator.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\SavedResponses.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\PreviewSendMedia.js",["440","441","442","443"],"import React, {useEffect, useRef, useState} from \"react\";\r\nimport '../../../styles/PreviewSendMedia.css';\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\nimport {ButtonBase, IconButton, TextField} from \"@material-ui/core\";\r\nimport {getFirstObject, getLastObject, getObjLength} from \"../../../helpers/Helpers\";\r\nimport Send from \"@material-ui/icons/Send\";\r\nimport AddIcon from '@material-ui/icons/Add';\r\nimport {\r\n    ATTACHMENT_TYPE_AUDIO,\r\n    ATTACHMENT_TYPE_DOCUMENT,\r\n    ATTACHMENT_TYPE_IMAGE,\r\n    ATTACHMENT_TYPE_VIDEO,\r\n    EMPTY_IMAGE_BASE64, EVENT_TOPIC_RELOAD_PREVIEW\r\n} from \"../../../Constants\";\r\nimport FileInput from \"../../FileInput\";\r\nimport {getDroppedFiles, handleDragOver, prepareSelectedFiles} from \"../../../helpers/FileHelper\";\r\nimport InsertDriveFileIcon from \"@material-ui/icons/InsertDriveFile\";\r\nimport AudiotrackIcon from \"@material-ui/icons/Audiotrack\";\r\n\r\nimport {Document, Page, pdfjs} from \"react-pdf\";\r\nimport PubSub from \"pubsub-js\";\r\nimport {useForceUpdate} from \"../../../hooks/useForceUpdate\";\r\n\r\nfunction PreviewSendMedia(props) {\r\n\r\n    const fileInput = useRef(null);\r\n\r\n    const [data, setData] = useState({});\r\n    const [chosenFile, setChosenFile] = useState();\r\n    const [captions, setCaptions] = useState({});\r\n    const [currentCaption, setCurrentCaption] = useState(\"\");\r\n    const [isDragOverlayVisible, setDragOverlayVisible] = useState(false);\r\n\r\n    const forceUpdate = useForceUpdate();\r\n\r\n    const hidePreview = () => {\r\n        props.setPreviewSendMediaVisible(false);\r\n    }\r\n\r\n    const changePreview = (index) => {\r\n        if (index >= 0 && data[index] !== undefined) {\r\n            setChosenFile(data[index]);\r\n        }\r\n    }\r\n\r\n    const deleteByIndex = (index) => {\r\n        const dataSize = getObjLength(data);\r\n        if (index >= 0 && data[index] !== undefined) {\r\n            if (dataSize === 1) {\r\n                props.setPreviewSendMediaVisible(false);\r\n            } else {\r\n                let nextState = {};\r\n                setData(prevState => {\r\n                    delete prevState[index];\r\n                    nextState = {...prevState};\r\n                    return nextState;\r\n                });\r\n\r\n                if (chosenFile && chosenFile.key === index) {\r\n                    changePreview(getFirstObject(nextState).key);\r\n                }\r\n\r\n                setCaptions(prevState => {\r\n                    delete prevState[index];\r\n                    return prevState;\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    const send = () => {\r\n        const finalData = data;\r\n\r\n        // Inject captions\r\n        const finalPreparedData = {};\r\n        Object.entries(finalData).forEach((curChosenFile) => {\r\n            const copyCurChosenFile = curChosenFile[1];\r\n            copyCurChosenFile.caption = captions[copyCurChosenFile.key] ?? '';\r\n            finalPreparedData[copyCurChosenFile.key] = copyCurChosenFile;\r\n        });\r\n\r\n        // Send\r\n        props.sendHandledChosenFiles(finalData);\r\n\r\n        // Hide\r\n        props.setPreviewSendMediaVisible(false);\r\n    }\r\n\r\n    const handleSelectedFiles = (selectedFiles) => {\r\n        console.log(selectedFiles);\r\n\r\n        if (getObjLength(selectedFiles) > 0) {\r\n            const preparedFiles = prepareSelectedFiles(selectedFiles);\r\n\r\n            // Updating data with new files\r\n            setData(prevState => {\r\n                const newState = prevState;\r\n                let nextIndex = parseInt(getLastObject(newState).key) + 1;\r\n                Object.entries(preparedFiles).forEach((curPreparedFile) => {\r\n                    const preparedFile = curPreparedFile[1];\r\n                    preparedFile.key = nextIndex.toString();\r\n                    newState[nextIndex] = preparedFile;\r\n                    nextIndex++;\r\n                });\r\n\r\n                return {...newState};\r\n            });\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        // For PDF previews\r\n        pdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;\r\n\r\n        setData(props.data);\r\n        setCaptions({});\r\n\r\n        const reloadPreview = (msg, data) => {\r\n            // Just to rerender\r\n            forceUpdate();\r\n        }\r\n\r\n        // Force async codec information\r\n        const token = PubSub.subscribe(EVENT_TOPIC_RELOAD_PREVIEW, reloadPreview);\r\n\r\n        return () => {\r\n            // Clear data\r\n            props.setData({});\r\n\r\n            PubSub.unsubscribe(token);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (chosenFile && data) {\r\n            const handleKey = (event) => {\r\n                // If any element is focused, ignore key\r\n                if (document.activeElement.tagName === \"INPUT\") {\r\n                    return false;\r\n                }\r\n\r\n                if (event.keyCode === 27) { // Escape\r\n                    hidePreview();\r\n                } else if (event.keyCode === 37) { // Left arrow\r\n                    changePreview(parseInt(chosenFile.key) - 1);\r\n                } else if (event.keyCode === 39) { // Right arrow\r\n                    changePreview(parseInt(chosenFile.key) + 1);\r\n                }\r\n            };\r\n\r\n            document.addEventListener('keydown', handleKey);\r\n\r\n            return () => {\r\n                document.removeEventListener('keydown', handleKey);\r\n            }\r\n        }\r\n    }, [chosenFile, data]);\r\n\r\n    useEffect(() => {\r\n        if (chosenFile) {\r\n            setCaptions(prevState => {\r\n                const newState = {};\r\n                newState[chosenFile.key] = currentCaption;\r\n\r\n                return {...prevState, ...newState};\r\n            })\r\n        }\r\n    }, [currentCaption]);\r\n\r\n    useEffect(() => {\r\n        // Preview first one\r\n        if (!chosenFile && getObjLength(data) > 0) {\r\n            changePreview(0)\r\n        }\r\n\r\n    }, [data]);\r\n\r\n    useEffect(() => {\r\n        if (chosenFile) {\r\n            setCurrentCaption(captions[chosenFile.key] ?? '');\r\n        }\r\n    }, [chosenFile, captions]);\r\n\r\n    return (\r\n        <div\r\n            className=\"previewSendMedia\"\r\n            /*onDragEnter={() => setDragOverlayVisible(true)}*/\r\n            onDrop={(event) => handleSelectedFiles(getDroppedFiles(event))}\r\n            onDragOver={(event) => handleDragOver(event)}>\r\n            <div className=\"previewSendMedia__header\">\r\n\r\n                <CloseIcon onClick={hidePreview}/>\r\n                <span>Preview</span>\r\n            </div>\r\n\r\n            <div className=\"previewSendMedia__preview\">\r\n                <div className=\"previewSendMedia__preview__wrapper\">\r\n                    {(chosenFile && chosenFile.attachmentType === ATTACHMENT_TYPE_IMAGE) &&\r\n                    <img className=\"previewSendMedia__preview__image\" src={chosenFile.fileURL} alt=\"Preview\" />\r\n                    }\r\n                    {(chosenFile && chosenFile.attachmentType === ATTACHMENT_TYPE_VIDEO) &&\r\n                    <video className=\"previewSendMedia__preview__video\" src={chosenFile.fileURL} controls={true} />\r\n                    }\r\n                    {(chosenFile && chosenFile.isPDF) &&\r\n                    <Document\r\n                        className=\"previewSendMedia__preview__pdf\"\r\n                        file={chosenFile.fileURL}>\r\n                        <Page pageNumber={1} scale={0.75} />\r\n                    </Document>\r\n                    }\r\n                </div>\r\n\r\n                {(chosenFile && chosenFile.attachmentType !== ATTACHMENT_TYPE_IMAGE && chosenFile.attachmentType !== ATTACHMENT_TYPE_VIDEO && !chosenFile.isPDF) &&\r\n                <div>\r\n                    {chosenFile.attachmentType}, <span className=\"searchOccurrence\">{chosenFile.file?.name}</span>\r\n                </div>\r\n                }\r\n            </div>\r\n\r\n            {(chosenFile && (chosenFile.attachmentType === ATTACHMENT_TYPE_IMAGE || chosenFile.attachmentType === ATTACHMENT_TYPE_VIDEO)) &&\r\n            <div className=\"previewSendMedia__caption\">\r\n                <TextField value={currentCaption}\r\n                           onChange={e => setCurrentCaption(e.target.value)}\r\n                           label=\"Add a caption...\"\r\n                           size=\"medium\"\r\n                           fullWidth={true}/>\r\n            </div>\r\n            }\r\n\r\n            <div className=\"previewSendMedia__footer\">\r\n\r\n                <div className=\"previewSendMedia__footer__inner\">\r\n                    { Object.entries(data).map((file) => {\r\n                        return (\r\n                            <span key={file[0]} className=\"previewSendMedia__footer__thumbnailOuter\">\r\n                                <span\r\n                                    className={\"previewSendMedia__footer__thumbnail\" + (chosenFile === file[1] ? \" chosenFile\" : \"\")}\r\n                                    onClick={() => changePreview(file[0])}>\r\n\r\n                                    {(file[1].attachmentType === ATTACHMENT_TYPE_IMAGE || file[1].attachmentType === ATTACHMENT_TYPE_VIDEO) &&\r\n                                    <img\r\n                                        className=\"previewSendMedia__footer__thumbnail__image\"\r\n                                        src={file[1].attachmentType === ATTACHMENT_TYPE_IMAGE ? file[1].fileURL : EMPTY_IMAGE_BASE64}\r\n                                        alt=\"Thumbnail\"\r\n                                    />\r\n                                    }\r\n\r\n                                    {(file[1].attachmentType === ATTACHMENT_TYPE_DOCUMENT) &&\r\n                                    <span className=\"previewSendMedia__footer__thumbnail__iconWrapper\">\r\n                                        <InsertDriveFileIcon />\r\n                                    </span>\r\n                                    }\r\n\r\n                                    {(file[1].attachmentType === ATTACHMENT_TYPE_AUDIO) &&\r\n                                    <span className=\"previewSendMedia__footer__thumbnail__iconWrapper\">\r\n                                        <AudiotrackIcon />\r\n                                    </span>\r\n                                    }\r\n                                </span>\r\n\r\n                                <IconButton onClick={() => deleteByIndex(file[0])} className=\"previewSendMedia__footer__thumbnail__delete\">\r\n                                    <CloseIcon />\r\n                                </IconButton>\r\n\r\n                            </span>\r\n                        )\r\n                    }) }\r\n\r\n                    <ButtonBase className=\"previewSendMedia__footer__addMoreWrapper\" onClick={() => fileInput.current?.click()}>\r\n                        <div className=\"previewSendMedia__footer__addMore\">\r\n                            <AddIcon/>\r\n                            <span>Add more</span>\r\n                        </div>\r\n                    </ButtonBase>\r\n\r\n                    <div className=\"hidden\">\r\n                        <FileInput innerRef={fileInput} accept=\"*.*\" handleSelectedFiles={handleSelectedFiles} />\r\n                    </div>\r\n\r\n                </div>\r\n\r\n                <div className=\"previewSendMedia__footer__sendWrapper\">\r\n                    <IconButton className=\"previewSendMedia__footer__send\" onClick={send}>\r\n                        <Send />\r\n                    </IconButton>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            {isDragOverlayVisible &&\r\n            <div className=\"previewSendMedia__dragOverlay\" onDragLeave={() => setDragOverlayVisible(false)}>\r\n                <div className=\"previewSendMedia__dragOverlay__innerWrapper\">\r\n                    Drag and drop here\r\n                </div>\r\n            </div>\r\n            }\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default PreviewSendMedia;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatHeader.js",["444"],"import React, {useEffect, useState} from 'react';\r\nimport '../../../styles/ChatHeader.css';\r\nimport {Avatar, IconButton, Menu, MenuItem} from \"@material-ui/core\";\r\nimport {ArrowBack, MoreVert, Search} from \"@material-ui/icons\";\r\nimport {avatarStyles} from \"../../../AvatarStyles\";\r\nimport {EVENT_TOPIC_CONTACT_DETAILS_VISIBILITY, EVENT_TOPIC_SEARCH_MESSAGES_VISIBILITY} from \"../../../Constants\";\r\nimport PubSub from \"pubsub-js\";\r\nimport {useHistory} from \"react-router-dom\";\r\nimport {addPlus, extractAvatarFromContactProviderData, replaceEmojis} from \"../../../helpers/Helpers\";\r\n\r\nfunction ChatHeader(props) {\r\n\r\n    const [anchorEl, setAnchorEl] = useState(null);\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n\r\n    }, []);\r\n\r\n    const displayMenu = (event) => {\r\n        setAnchorEl(event.currentTarget);\r\n    }\r\n\r\n    const hideMenu = () => {\r\n        setAnchorEl(null);\r\n    }\r\n\r\n    const avatarClasses = avatarStyles();\r\n\r\n    const showSearchMessages = () => {\r\n        PubSub.publish(EVENT_TOPIC_SEARCH_MESSAGES_VISIBILITY, true);\r\n    }\r\n\r\n    const showContactDetails = () => {\r\n        PubSub.publish(EVENT_TOPIC_CONTACT_DETAILS_VISIBILITY, true);\r\n    }\r\n\r\n    const showContactDetailsAndHideMenu = () => {\r\n        showContactDetails();\r\n        hideMenu();\r\n    }\r\n\r\n    const showChatAssignmentAndHideMenu = () => {\r\n        props.setChatAssignmentVisible(true);\r\n        hideMenu();\r\n    }\r\n\r\n    const showChatTagsAndHideMenu = () => {\r\n        props.setChatTagsVisible(true);\r\n        hideMenu();\r\n    }\r\n\r\n    return (\r\n        <div className=\"chat__header\" onDrop={(event) => event.preventDefault()}>\r\n\r\n            {!props.isChatOnly &&\r\n            <div className=\"mobileOnly\">\r\n                <IconButton className=\"chat__header__backButton\" onClick={props.closeChat}>\r\n                    <ArrowBack/>\r\n                </IconButton>\r\n            </div>\r\n            }\r\n\r\n            <div className=\"chat__header__clickable\" onClick={showContactDetails}>\r\n                <Avatar\r\n                    src={extractAvatarFromContactProviderData(props.contactProvidersData[props.person?.waId])}\r\n                    className={(props.person?.isExpired ? '' : avatarClasses[props.person?.getAvatarClassName()]) + (\" chat__header__avatar\")}>{props.person?.initials}</Avatar>\r\n\r\n                <div className=\"chat__headerInfo\">\r\n                    <h3 dangerouslySetInnerHTML={{__html: replaceEmojis((props.contactProvidersData[props.person?.waId]?.[0]?.name ?? props.person?.name) ?? (props.person?.waId ? addPlus(props.person?.waId) : ''))}} />\r\n\r\n                    {/*<p><Moment date={contact?.lastMessageTimestamp} format={dateFormat} unix /></p>*/}\r\n\r\n                    {props.person?.isExpired &&\r\n                    <p className=\"chat__header__expired\">Inactive</p>\r\n                    }\r\n                </div>\r\n\r\n                <div className=\"chat__headerInfo_2\">\r\n                <span className=\"chat__headerInfo_2__waId desktopOnly\">\r\n                    {props.person?.waId ? addPlus(props.person?.waId) : ''}\r\n                </span>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"chat__headerRight\">\r\n                <IconButton onClick={showSearchMessages}>\r\n                    <Search />\r\n                </IconButton>\r\n                <IconButton onClick={displayMenu}>\r\n                    <MoreVert />\r\n                </IconButton>\r\n            </div>\r\n\r\n            <Menu\r\n                anchorEl={anchorEl}\r\n                getContentAnchorEl={null}\r\n                anchorOrigin={{ vertical: \"bottom\", horizontal: \"right\" }}\r\n                transformOrigin={{ vertical: \"top\", horizontal: \"right\" }}\r\n                keepMounted\r\n                open={Boolean(anchorEl)}\r\n                onClose={hideMenu}\r\n                elevation={3}>\r\n                <MenuItem onClick={showContactDetailsAndHideMenu}>Contact details</MenuItem>\r\n                <MenuItem onClick={showChatAssignmentAndHideMenu}>Assign chat</MenuItem>\r\n                <MenuItem onClick={showChatTagsAndHideMenu}>Change tags</MenuItem>\r\n            </Menu>\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ChatHeader;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessage.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\Notifications\\Notifications.js",["445"],"import React, {useEffect, useRef, useState} from \"react\";\r\nimport {generateCancelToken, retrieveBulkMessageTaskElementsCall} from \"../../../../api/ApiCalls\";\r\nimport '../../../../styles/Notifications.css';\r\nimport PubSub from \"pubsub-js\";\r\nimport {EVENT_TOPIC_BULK_MESSAGE_TASK_ELEMENT} from \"../../../../Constants\";\r\nimport FailedBulkMessageNotification from \"./FailedBulkMessageNotification\";\r\nimport BulkMessageTaskElementClass from \"../../../../BulkMessageTaskElementClass\";\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\nimport {IconButton} from \"@material-ui/core\";\r\nimport {getObjLength} from \"../../../../helpers/Helpers\";\r\n\r\nfunction Notifications(props) {\r\n\r\n    const [bulkMessageTaskElements, setBulkMessageTaskElements] = useState({});\r\n    const [isLoaded, setLoaded] = useState(false);\r\n    let cancelTokenSourceRef = useRef();\r\n\r\n    useEffect(() => {\r\n        const handleKey = (event) => {\r\n            if (event.keyCode === 27) { // Escape\r\n                props.onHide();\r\n            }\r\n        }\r\n\r\n        document.addEventListener('keydown', handleKey);\r\n\r\n        // Retrieve bulk message task elements\r\n        cancelTokenSourceRef.current = generateCancelToken();\r\n        retrieveBulkMessageTaskElements();\r\n\r\n        const onBulkMessageTaskElement = function (msg, data) {\r\n            if (data.status) {\r\n                // Means a bulk message task element has failed, so we refresh the data\r\n                retrieveBulkMessageTaskElements();\r\n            }\r\n        }\r\n\r\n        const bulkMessageTaskElementEventToken = PubSub.subscribe(EVENT_TOPIC_BULK_MESSAGE_TASK_ELEMENT, onBulkMessageTaskElement);\r\n\r\n        return () => {\r\n            document.removeEventListener('keydown', handleKey);\r\n            cancelTokenSourceRef.current.cancel();\r\n            PubSub.unsubscribe(bulkMessageTaskElementEventToken);\r\n        }\r\n    }, []);\r\n\r\n    const retrieveBulkMessageTaskElements = () => {\r\n        retrieveBulkMessageTaskElementsCall(cancelTokenSourceRef.current.token,\r\n            (response) => {\r\n                const preparedBulkMessageTaskElements = {};\r\n                response.data.results.forEach((taskElement) => {\r\n                    const prepared = new BulkMessageTaskElementClass(taskElement);\r\n\r\n                    // TODO: Results should be ordered DESC in the backend\r\n                    // Check if failed\r\n                    if (prepared.statusCode >= 400) {\r\n                        preparedBulkMessageTaskElements[prepared.id] = prepared;\r\n                    }\r\n                });\r\n\r\n                setBulkMessageTaskElements(preparedBulkMessageTaskElements);\r\n                setLoaded(true);\r\n            }, (error) => {\r\n\r\n            });\r\n    }\r\n\r\n    const hideNotifications = () => {\r\n        props.onHide();\r\n    }\r\n\r\n    return (\r\n        <div className=\"notifications\">\r\n\r\n            <div className=\"notifications__header\">\r\n                <IconButton onClick={hideNotifications}>\r\n                    <CloseIcon />\r\n                </IconButton>\r\n\r\n                <h3>Notifications</h3>\r\n            </div>\r\n\r\n            <div className=\"notifications__body\">\r\n                {(isLoaded && getObjLength(bulkMessageTaskElements) === 0) &&\r\n                <div className=\"notifications__body__empty\">\r\n                    You have no notifications\r\n                </div>\r\n                }\r\n\r\n                {Object.entries(bulkMessageTaskElements).reverse().map((notification) =>\r\n                    <FailedBulkMessageNotification key={notification[1].id} data={notification[1]} />\r\n                )}\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Notifications;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageOptionsMenu.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\TemplateMessages\\TemplateMessages.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatFooter\\ChatFooter.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageTypeIcon.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageShortContent.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\TemplateMessages\\SendTemplateMessage.js",["446","447","448"],"import React, {useEffect, useRef, useState} from \"react\";\r\nimport {Button, TextField} from \"@material-ui/core\";\r\nimport '../../../../styles/SendTemplateMessage.css';\r\nimport {getTemplateParams, templateParamToInteger} from \"../../../../helpers/Helpers\";\r\nimport FileInput from \"../../../FileInput\";\r\nimport {Alert, AlertTitle} from \"@material-ui/lab\";\r\nimport {uploadMediaCall} from \"../../../../api/ApiCalls\";\r\n\r\nfunction SendTemplateMessage(props) {\r\n\r\n    const template = props.data;\r\n\r\n    const [params, setParams] = useState({});\r\n    const [headerFileURL, setHeaderFileURL] = useState('');\r\n    const [isUploading, setUploading] = useState(false);\r\n\r\n    const headerFileInput = useRef();\r\n\r\n    useEffect(() => {\r\n        const preparedParams = {};\r\n        const components = {...template.components};\r\n\r\n        Object.entries(components).forEach((paramEntry, paramIndex) => {\r\n            const key = paramEntry[0];\r\n            const component = paramEntry[1];\r\n            const componentType = component.type;\r\n\r\n            if (componentType === \"HEADER\") {\r\n                if (component.format === \"IMAGE\" || component.format === \"VIDEO\" || component.format === \"DOCUMENT\") {\r\n                    const format = component.format.toLowerCase();\r\n                    preparedParams[key] = {\r\n                        0: { type: format }\r\n                    };\r\n\r\n                    preparedParams[key][0][format] = { link: \"\" };\r\n                }\r\n            }\r\n\r\n            const paramText = component.text;\r\n            const templateParamsArray = getTemplateParams(paramText);\r\n\r\n            templateParamsArray.map((extractedParam, extractedParamIndex) => {\r\n                if (preparedParams[key] === undefined) {\r\n                    preparedParams[key] = {};\r\n                }\r\n                preparedParams[key][templateParamToInteger(extractedParam)] = {\r\n                    type: \"text\",\r\n                    text: \"\"\r\n                };\r\n            });\r\n        });\r\n\r\n        setParams(preparedParams);\r\n\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // Update params when header image changes\r\n        setParams(prevState => {\r\n            // TODO: Do this in a better way depends on template headers complexity\r\n            if (prevState[0] && prevState[0][0] && prevState[0][0]['image']) {\r\n                prevState[0][0]['image']['link'] = headerFileURL;\r\n            } else if (prevState[0] && prevState[0][0] && prevState[0][0]['video']) {\r\n                prevState[0][0]['video']['link'] = headerFileURL;\r\n            } else if (prevState[0] && prevState[0][0] && prevState[0][0]['document']) {\r\n                prevState[0][0]['document']['link'] = headerFileURL;\r\n            }\r\n\r\n            return prevState;\r\n        });\r\n    }, [headerFileURL, params]);\r\n\r\n    const updateParam = (event, index, paramKey) => {\r\n        setParams(prevState => {\r\n            const nextState = prevState;\r\n            nextState[index][paramKey].text = event.target.value;\r\n\r\n            return {...nextState};\r\n        })\r\n    }\r\n\r\n    const send = (isBulk) => {\r\n        const preparedParams = {};\r\n        const components = {...template.components};\r\n\r\n        Object.entries(components).forEach((paramEntry, paramIndex) => {\r\n            const key = paramEntry[0];\r\n            const component = paramEntry[1];\r\n\r\n            if (params[key]) {\r\n                const paramsArray = Object.values(params[key]);\r\n\r\n                /*const localizableParams = [];\r\n                paramsArray.forEach((paramArrayItem) => {\r\n                    localizableParams.push({\r\n                        \"default\": paramArrayItem.text\r\n                    })\r\n                });*/\r\n\r\n                preparedParams[component.type] = {\r\n                    type: component.type.toLowerCase(),\r\n                    parameters: paramsArray,\r\n                    //localizable_params: localizableParams\r\n                };\r\n            }\r\n        });\r\n\r\n        const finalData = template;\r\n        finalData.params = Object.values(preparedParams);\r\n\r\n        if (isBulk === true) {\r\n            props.bulkSend(finalData);\r\n        } else {\r\n            props.send(finalData);\r\n        }\r\n\r\n        /*Object.entries(params).forEach((paramEntry) => {\r\n            finalData.components[paramEntry[0]].params = paramEntry[1];\r\n        });*/\r\n    }\r\n\r\n    const handleChosenImage = (file) => {\r\n        if (!file) return;\r\n\r\n        const formData = new FormData();\r\n        formData.append(\"file_encoded\", file[0]);\r\n\r\n        setUploading(true);\r\n\r\n        uploadMediaCall(formData,\r\n            (response) => {\r\n                const fileURL = response.data.file;\r\n                setHeaderFileURL(fileURL);\r\n\r\n                setUploading(false);\r\n            }, (error) => {\r\n                setUploading(false);\r\n            });\r\n    }\r\n\r\n    const getMimetypeByFormat = (format) => {\r\n        if (format === \"IMAGE\") return \"image/jpeg, image/png\";\r\n        if (format === \"VIDEO\") return \"video/mp4, video/3gpp\";\r\n        if (format === \"DOCUMENT\") return \"*/*\";\r\n    }\r\n\r\n    return (\r\n        <div className=\"sendTemplateMessage\">\r\n            <h4 className=\"sendTemplateMessage__title\">{template.name}</h4>\r\n\r\n            {template.components.map((comp, index) =>\r\n                <div key={index} className=\"sendTemplateMessage__component\">\r\n\r\n                    <div className=\"sendTemplateMessage__section\">\r\n                        <h6>{comp.type}</h6>\r\n                        <div>\r\n\r\n                            {(comp.format === \"IMAGE\" || comp.format === \"VIDEO\" || comp.format === \"DOCUMENT\") &&\r\n                            <div>\r\n                                <div>\r\n                                    {headerFileURL &&\r\n                                    <div>\r\n                                        <Alert severity=\"success\">\r\n                                            <AlertTitle>Uploaded successfully</AlertTitle>\r\n                                            <a href={headerFileURL} target=\"_blank\">{headerFileURL}</a>\r\n                                        </Alert>\r\n                                    </div>\r\n                                    }\r\n                                </div>\r\n                                <FileInput innerRef={headerFileInput} multiple={false} accept={getMimetypeByFormat(comp.format)} handleSelectedFiles={handleChosenImage} />\r\n                                <Button color=\"primary\" onClick={() => headerFileInput.current.click()} disabled={isUploading}>Upload {headerFileURL ? \"another \" : \"\"}{comp.format.toLowerCase()}</Button>\r\n                                {headerFileURL &&\r\n                                <Button color=\"secondary\" onClick={() => setHeaderFileURL('')}>Delete</Button>\r\n                                }\r\n                            </div>\r\n                            }\r\n\r\n                            {comp.text}\r\n                            <div>\r\n                                {getTemplateParams(comp.text).map((param, paramIndex) =>\r\n                                    <TextField\r\n                                        value={params[index] ? params[index][templateParamToInteger(param)].text : ''}\r\n                                        onChange={(event) => updateParam(event, index, templateParamToInteger(param))}\r\n                                        className=\"templateMessage__param\"\r\n                                        key={paramIndex}\r\n                                        label={templateParamToInteger(param)}\r\n                                        fullWidth={true} />\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {comp.type === \"BUTTONS\" &&\r\n                        <div>\r\n                            {comp.buttons.map((button, buttonIndex) =>\r\n                                <Button key={buttonIndex} color=\"primary\" disabled={true}>\r\n                                    {button.text}\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n                        }\r\n\r\n                    </div>\r\n\r\n                </div>\r\n            )}\r\n\r\n            <Button innerRef={props.sendButtonInnerRef} onClick={send} className=\"hidden\">Send</Button>\r\n            <Button innerRef={props.bulkSendButtonInnerRef} onClick={() => send(true)} className=\"hidden\">Bulk Send</Button>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default SendTemplateMessage;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatFooter\\VoiceRecord.js",["449","450"],"import React, {useEffect, useRef, useState} from \"react\";\r\nimport {Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, IconButton} from \"@material-ui/core\";\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\nimport FiberManualRecordIcon from \"@material-ui/icons/FiberManualRecord\";\r\nimport {displaySeconds} from \"../../../../helpers/Helpers\";\r\nimport DoneIcon from \"@material-ui/icons/Done\";\r\nimport '../../../../styles/VoiceRecord.css';\r\nimport VoiceRecorder from \"../../../../VoiceRecorder\";\r\nimport {EVENT_TOPIC_DISPLAY_ERROR, EVENT_TOPIC_REQUEST_MIC_PERMISSION} from \"../../../../Constants\";\r\nimport PubSub from \"pubsub-js\";\r\nimport {useParams} from \"react-router-dom\";\r\nimport Button from \"@material-ui/core/Button\";\r\n\r\nlet timerIntervalId;\r\n\r\nfunction VoiceRecord(props) {\r\n\r\n    const voiceRecorder = useRef(new VoiceRecorder());\r\n    const [timer, setTimer] = useState(0);\r\n\r\n    const {waId} = useParams();\r\n\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    const handleClose = () => {\r\n        setOpen(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const onRequestMicPermission = function (msg, data) {\r\n            requestMicrophonePermission();\r\n        }\r\n\r\n        const token = PubSub.subscribe(EVENT_TOPIC_REQUEST_MIC_PERMISSION, onRequestMicPermission);\r\n\r\n        return () => {\r\n            PubSub.unsubscribe(token);\r\n\r\n            cancelVoiceRecord();\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        cancelVoiceRecord();\r\n    }, [waId]);\r\n\r\n    const cancelVoiceRecord = () => {\r\n        voiceRecorder.current?.cancel();\r\n\r\n        onVoiceRecordStop();\r\n    }\r\n\r\n    const onVoiceRecordStop = () => {\r\n        props.setRecording(false);\r\n\r\n        // Stop timer\r\n        clearInterval(timerIntervalId);\r\n        setTimer(0);\r\n    }\r\n\r\n    const requestMicrophonePermission = () => {\r\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n\r\n            const constraints = {\r\n                audio: {\r\n                    sampleRate: 48000,\r\n                    channelCount: 1,\r\n                    volume: 1.0,\r\n                    noiseSuppression: true\r\n                },\r\n                video: false\r\n            };\r\n\r\n            navigator.mediaDevices.getUserMedia(constraints)\r\n                .then(function (stream) {\r\n                    startVoiceRecord(stream);\r\n                })\r\n                .catch(function (err) {\r\n                    console.log('Permission denied');\r\n\r\n                    PubSub.publish(EVENT_TOPIC_DISPLAY_ERROR, 'You must grant microphone permission.');\r\n\r\n                    if (window.AndroidWebInterface) {\r\n                        window.AndroidWebInterface.requestPermissions();\r\n                    }\r\n\r\n                    // Check if iframe\r\n                    if (window.self !== window.top) {\r\n                        setOpen(true);\r\n                    }\r\n                });\r\n        } else {\r\n            console.log('Not supported on your browser.');\r\n\r\n            PubSub.publish(EVENT_TOPIC_DISPLAY_ERROR, 'This feature is not supported on your browser.');\r\n        }\r\n    }\r\n\r\n    const startVoiceRecord = (stream) => {\r\n        // If it is already recording, return\r\n        if (voiceRecorder.current?.isRecording()) return;\r\n\r\n        // Start recording\r\n        voiceRecorder.current?.start(\r\n            stream,\r\n            function () {\r\n                props.setRecording(true);\r\n\r\n                // Update timer every second\r\n                timerIntervalId = setInterval(function () {\r\n                    setTimer(prevState => prevState + 1);\r\n                }, 1000);\r\n            },\r\n            function () {\r\n                onVoiceRecordStop();\r\n            },\r\n            function (audioFile) {\r\n                //console.log(audioFile);\r\n            }\r\n        );\r\n    }\r\n\r\n    const stopVoiceRecord = () => {\r\n        voiceRecorder.current?.stop();\r\n    }\r\n\r\n    const sendVoiceRecord = () => {\r\n        stopVoiceRecord();\r\n\r\n        setTimeout(function () {\r\n            const chosenFile = voiceRecorder.current.lastAudioChosenFile;\r\n\r\n            // Send\r\n            if (chosenFile) {\r\n                props.sendHandledChosenFiles({0: voiceRecorder.current.lastAudioChosenFile});\r\n            } else {\r\n                console.log('Audio file is missing');\r\n            }\r\n        }, 1000);\r\n    }\r\n\r\n    const goToInbox = () => {\r\n        window.open(window.location.href, '_blank');\r\n        handleClose();\r\n    }\r\n\r\n    return (\r\n        <div className=\"voiceRecord\">\r\n            <IconButton onClick={stopVoiceRecord} className=\"voiceRecord__cancelButton\">\r\n                <CloseIcon />\r\n            </IconButton>\r\n\r\n            <FiberManualRecordIcon className=\"voiceRecord__recordIcon\" />\r\n            <span className=\"voiceRecord__timer\">{ displaySeconds(timer) }</span>\r\n\r\n            <IconButton onClick={sendVoiceRecord} className=\"voiceRecord__sendButton\">\r\n                <DoneIcon />\r\n            </IconButton>\r\n\r\n            <Dialog\r\n                open={open}\r\n                onClose={handleClose}>\r\n                <DialogTitle>Oops!</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        You must open the inbox in a new tab to access this feature.\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={handleClose} color=\"secondary\">\r\n                        Close\r\n                    </Button>\r\n                    <Button onClick={goToInbox} color=\"primary\" autoFocus>\r\n                        Go to inbox\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default VoiceRecord;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageTypeLabel.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Sidebar\\Notifications\\FailedBulkMessageNotification.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageTemplate.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageVoice.js",["451"],"import React, {useEffect, useRef, useState} from \"react\";\r\nimport {Avatar, IconButton} from \"@material-ui/core\";\r\nimport PauseIcon from \"@material-ui/icons/Pause\";\r\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\r\nimport HeadsetIcon from \"@material-ui/icons/Headset\";\r\nimport PubSub from \"pubsub-js\";\r\nimport {EVENT_TOPIC_CHAT_MESSAGE, EVENT_TOPIC_UNSUPPORTED_FILE} from \"../../../../Constants\";\r\nimport {avatarStyles} from \"../../../../AvatarStyles\";\r\nimport {isAudioMimeTypeSupported} from \"../../../../helpers/FileHelper\";\r\nimport UnsupportedFileClass from \"../../../../UnsupportedFileClass\";\r\n\r\nfunction ChatMessageVoice(props) {\r\n\r\n    const data = props.data;\r\n\r\n    const [isPlaying, setPlaying] = useState(false);\r\n    const duration = useRef(null);\r\n    const [progress, setProgress] = useState(0);\r\n    const [currentDuration, setCurrentDuration] = useState(\"0:00\");\r\n    const audio = useRef(null);\r\n    const range = useRef(null);\r\n\r\n    const onChatMessageEvent = function (msg, data) {\r\n        if (data === 'pause') {\r\n            pauseVoice();\r\n        }\r\n    };\r\n\r\n    const avatarClasses = avatarStyles();\r\n\r\n    const playIconStyles = {\r\n        fontSize: '38px'\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Subscribing only if there is voice or audio\r\n        if (data.hasAnyAudio()) {\r\n            const token = PubSub.subscribe(EVENT_TOPIC_CHAT_MESSAGE, onChatMessageEvent);\r\n            return () => {\r\n                PubSub.unsubscribe(token);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    const pauseVoice = () => {\r\n        if (audio.current && range.current && !audio.current.paused) {\r\n            audio.current.pause();\r\n            setPlaying(false);\r\n        }\r\n    };\r\n\r\n    const playVoice = () => {\r\n        if (audio.current && range.current) {\r\n            if (!audio.current.paused) {\r\n                audio.current.pause();\r\n                setPlaying(false);\r\n            } else {\r\n\r\n                // Pause others\r\n                PubSub.publishSync(EVENT_TOPIC_CHAT_MESSAGE, 'pause');\r\n\r\n                console.log(data.mimeType);\r\n\r\n                if (isAudioMimeTypeSupported(data.mimeType)) {\r\n                    audio.current.play();\r\n                    setPlaying(true);\r\n                } else {\r\n                    const unsupportedFile = new UnsupportedFileClass({\r\n                        name: props.data.filename,\r\n                        link: props.data.audioLink\r\n                    });\r\n                    PubSub.publish(EVENT_TOPIC_UNSUPPORTED_FILE, unsupportedFile);\r\n                }\r\n            }\r\n\r\n            const interval = setInterval(function () {\r\n                if (audio.current && range.current) {\r\n                    const duration = audio.current.duration;\r\n                    const currentTime = audio.current.currentTime;\r\n\r\n                    setCurrentDuration(formatDuration(currentTime));\r\n\r\n                    if (duration) {\r\n                        const percentage = (currentTime * 100) / duration\r\n\r\n                        if (percentage >= 100) {\r\n                            setProgress(0);\r\n                            setCurrentDuration(formatDuration(0));\r\n                            setPlaying(false);\r\n                            clearInterval(interval);\r\n                        } else {\r\n                            setProgress(percentage);\r\n                        }\r\n                    }\r\n\r\n                    if (audio.current.paused) {\r\n                        clearInterval(interval);\r\n                    }\r\n                } else {\r\n                    // In case component is reloaded\r\n                    clearInterval(interval);\r\n                }\r\n            }, 300);\r\n        }\r\n    }\r\n\r\n    const formatDuration = (s) => {\r\n        s = Math.floor(s);\r\n        return (s-(s%=60))/60+(9<s?':':':0')+s;\r\n    }\r\n\r\n    const changeDuration = (value) => {\r\n        if (audio.current && range.current && audio.current.duration !== Infinity) {\r\n            setProgress(value);\r\n            const nextCurrentTime = audio.current.duration / value;\r\n            if (nextCurrentTime !== Infinity && !isNaN(nextCurrentTime)) {\r\n                audio.current.currentTime = parseFloat(nextCurrentTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"chat__voice\">\r\n            <span ref={duration} className=\"chat__voice__duration\">{currentDuration}</span>\r\n            <IconButton onClick={() => playVoice()}>\r\n                {isPlaying ? <PauseIcon style={playIconStyles}/> : <PlayArrowIcon style={playIconStyles}/>}\r\n            </IconButton>\r\n            <input ref={range} dir=\"ltr\" type=\"range\" className=\"chat__voice__range\" min=\"0\" max=\"100\" value={progress} onChange={(e) => changeDuration(e.target.value)} />\r\n            <audio ref={audio} src={data.voiceId ? data.generateVoiceLink() : data.generateAudioLink()} preload=\"none\" onLoadedMetadata={event => console.log(event.target.duration)} />\r\n\r\n            <Avatar className={(data.voiceId !== undefined ?? data.voiceLink !== undefined) ? avatarClasses[data.initials] : avatarClasses.orange + \" audioMessageAvatar\"}>\r\n                {data.voiceId !== undefined ? <span>{data.initials}</span> : <HeadsetIcon/>}\r\n            </Avatar>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ChatMessageVoice;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageDocument.js",["452"],"import React from \"react\";\r\nimport InsertDriveFileIcon from \"@material-ui/icons/InsertDriveFile\";\r\n\r\nfunction ChatMessageDocument(props) {\r\n    return (\r\n        <a href={props.data.documentLink ?? props.data.getHeaderFileLink('document')} target=\"_blank\" className=\"chat__document\">\r\n            <InsertDriveFileIcon fontSize=\"small\" />\r\n            <span className=\"chat__document__filename\">{props.data.documentCaption ?? (props.data.documentFileName ?? 'Document')}</span>\r\n        </a>\r\n    )\r\n}\r\n\r\nexport default ChatMessageDocument;","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageImage.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatMessageVideo.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ContextChatMessage.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\components\\Main\\Chat\\ChatMessage\\ChatTaggingEvent.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\AvatarHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\TemplateMessageHelper.js",["453"],"export const getTemplateParams = (text) => {\r\n    const matches = text?.match(/\\{{(.*?)\\}}/g);\r\n    return matches ? matches : [];\r\n}\r\nexport const templateParamToInteger = (templateParam) => {\r\n    return templateParam.match(/\\d+/);\r\n}\r\nexport const insertTemplateComponentParameters = (component, params) => {\r\n    if (!component) return;\r\n\r\n    const type = component.type.toLowerCase();\r\n    const format = component.format ? component.format.toLowerCase() : \"text\";\r\n    let text = component[format];\r\n\r\n    if (!params) return text;\r\n\r\n    for (let i = 0; i < params.length; i++) {\r\n        const component = params[i];\r\n\r\n        if (component.type === type) {\r\n            component.parameters.forEach((param, index) => {\r\n                const paramType = param.type;\r\n\r\n                const paramValue = param[paramType].fallback_value ?? param[paramType];\r\n                text = text.replace(`{{${index + 1}}}`, paramValue);\r\n            });\r\n\r\n            break;\r\n        }\r\n    }\r\n\r\n    return text;\r\n}","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\ObjectHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\EmojiHelper.js",["454","455","456"],"import {Emoji, getEmojiDataFromNative} from \"emoji-mart\";\r\nimport {EMOJI_SET, EMOJI_SHEET_SIZE} from \"../Constants\";\r\nimport data from \"../EmojiData.json\";\r\n\r\nconst emojiRegex = require('emoji-regex/RGI_Emoji.js');\r\n\r\nfunction containsOnlyEmojis(text) {\r\n    const onlyEmojis = text.replace(new RegExp('[\\u0000-\\u1eeff]', 'g'), '')\r\n    const visibleChars = text.replace(new RegExp('[\\n\\r\\s]+|( )+', 'g'), '')\r\n    return onlyEmojis.length === visibleChars.length\r\n}\r\n\r\nexport const replaceEmojis = (message, ignoreOnlyEmojis) => {\r\n    if (!message) return;\r\n\r\n    const onlyEmojis = !ignoreOnlyEmojis ? containsOnlyEmojis(message) : false;\r\n    const regex = emojiRegex();\r\n\r\n    return message.replace(regex, function (occurrence) {\r\n        // TODO: Finding emoji data is too slow, find an alternative or improve it\r\n        const emojiData = getEmojiDataFromNative(occurrence, EMOJI_SET, data);\r\n        if (emojiData) {\r\n            const emoji = Emoji({\r\n                html: true,\r\n                emoji: emojiData,\r\n                size: onlyEmojis ? 44 : 22,\r\n                set: EMOJI_SET,\r\n                sheetSize: EMOJI_SHEET_SIZE\r\n            });\r\n\r\n            // Emoji might be null\r\n            return emoji ?? occurrence;\r\n\r\n        } else {\r\n            return occurrence;\r\n        }\r\n    });\r\n}","C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\URLHelper.js",[],"C:\\Users\\Berkay\\PhpstormProjects\\wpclone\\src\\helpers\\MessageHelper.js",[],{"ruleId":"457","replacedBy":"458"},{"ruleId":"459","replacedBy":"460"},{"ruleId":"461","severity":1,"message":"462","line":66,"column":8,"nodeType":"463","endLine":66,"endColumn":10,"suggestions":"464"},{"ruleId":"465","severity":1,"message":"466","line":19,"column":7,"nodeType":"467","messageId":"468","endLine":19,"endColumn":26},{"ruleId":"465","severity":1,"message":"469","line":9,"column":12,"nodeType":"467","messageId":"468","endLine":9,"endColumn":18},{"ruleId":"465","severity":1,"message":"470","line":11,"column":11,"nodeType":"467","messageId":"468","endLine":11,"endColumn":27},{"ruleId":"465","severity":1,"message":"471","line":1,"column":16,"nodeType":"467","messageId":"468","endLine":1,"endColumn":24},{"ruleId":"461","severity":1,"message":"472","line":51,"column":8,"nodeType":"463","endLine":51,"endColumn":10,"suggestions":"473"},{"ruleId":"461","severity":1,"message":"474","line":70,"column":8,"nodeType":"463","endLine":70,"endColumn":17,"suggestions":"475"},{"ruleId":"476","severity":1,"message":"477","line":11,"column":13,"nodeType":"478","endLine":11,"endColumn":39},{"ruleId":"476","severity":1,"message":"477","line":14,"column":13,"nodeType":"478","endLine":14,"endColumn":37},{"ruleId":"476","severity":1,"message":"477","line":17,"column":13,"nodeType":"478","endLine":17,"endColumn":38},{"ruleId":"479","severity":1,"message":"480","line":59,"column":48,"nodeType":"481","messageId":"482","endLine":59,"endColumn":66},{"ruleId":"479","severity":1,"message":"483","line":60,"column":50,"nodeType":"481","messageId":"482","endLine":60,"endColumn":66},{"ruleId":"484","severity":1,"message":"485","line":60,"column":56,"nodeType":"481","messageId":"486","endLine":60,"endColumn":57,"suggestions":"487"},{"ruleId":"488","severity":1,"message":"489","line":232,"column":42,"nodeType":"490","messageId":"491","endLine":237,"endColumn":14},{"ruleId":"457","replacedBy":"492"},{"ruleId":"459","replacedBy":"493"},{"ruleId":"461","severity":1,"message":"494","line":518,"column":8,"nodeType":"463","endLine":518,"endColumn":10,"suggestions":"495"},{"ruleId":"461","severity":1,"message":"496","line":29,"column":8,"nodeType":"463","endLine":29,"endColumn":10,"suggestions":"497"},{"ruleId":"461","severity":1,"message":"498","line":30,"column":8,"nodeType":"463","endLine":30,"endColumn":10,"suggestions":"499"},{"ruleId":"465","severity":1,"message":"500","line":20,"column":12,"nodeType":"467","messageId":"468","endLine":20,"endColumn":16},{"ruleId":"461","severity":1,"message":"501","line":27,"column":8,"nodeType":"463","endLine":27,"endColumn":10,"suggestions":"502"},{"ruleId":"503","severity":1,"message":"504","line":30,"column":48,"nodeType":"490","messageId":"505","endLine":30,"endColumn":50},{"ruleId":"465","severity":1,"message":"506","line":18,"column":23,"nodeType":"467","messageId":"468","endLine":18,"endColumn":33},{"ruleId":"465","severity":1,"message":"507","line":58,"column":28,"nodeType":"467","messageId":"468","endLine":58,"endColumn":45},{"ruleId":"461","severity":1,"message":"508","line":103,"column":8,"nodeType":"463","endLine":103,"endColumn":17,"suggestions":"509"},{"ruleId":"461","severity":1,"message":"510","line":201,"column":8,"nodeType":"463","endLine":201,"endColumn":72,"suggestions":"511"},{"ruleId":"461","severity":1,"message":"512","line":237,"column":8,"nodeType":"463","endLine":237,"endColumn":30,"suggestions":"513"},{"ruleId":"461","severity":1,"message":"514","line":141,"column":8,"nodeType":"463","endLine":141,"endColumn":10,"suggestions":"515"},{"ruleId":"461","severity":1,"message":"516","line":178,"column":8,"nodeType":"463","endLine":178,"endColumn":14,"suggestions":"517"},{"ruleId":"461","severity":1,"message":"518","line":186,"column":8,"nodeType":"463","endLine":186,"endColumn":27,"suggestions":"519"},{"ruleId":"461","severity":1,"message":"472","line":199,"column":8,"nodeType":"463","endLine":199,"endColumn":16,"suggestions":"520"},{"ruleId":"461","severity":1,"message":"521","line":210,"column":8,"nodeType":"463","endLine":210,"endColumn":33,"suggestions":"522"},{"ruleId":"461","severity":1,"message":"523","line":280,"column":8,"nodeType":"463","endLine":280,"endColumn":83,"suggestions":"524"},{"ruleId":"461","severity":1,"message":"525","line":455,"column":8,"nodeType":"463","endLine":455,"endColumn":104,"suggestions":"526"},{"ruleId":"461","severity":1,"message":"527","line":593,"column":8,"nodeType":"463","endLine":593,"endColumn":30,"suggestions":"528"},{"ruleId":"461","severity":1,"message":"529","line":599,"column":8,"nodeType":"463","endLine":599,"endColumn":23,"suggestions":"530"},{"ruleId":"461","severity":1,"message":"531","line":40,"column":8,"nodeType":"463","endLine":40,"endColumn":29,"suggestions":"532"},{"ruleId":"461","severity":1,"message":"533","line":97,"column":8,"nodeType":"463","endLine":97,"endColumn":82,"suggestions":"534"},{"ruleId":"461","severity":1,"message":"535","line":55,"column":8,"nodeType":"463","endLine":55,"endColumn":10,"suggestions":"536"},{"ruleId":"461","severity":1,"message":"537","line":11,"column":8,"nodeType":"463","endLine":11,"endColumn":28,"suggestions":"538"},{"ruleId":"461","severity":1,"message":"539","line":48,"column":8,"nodeType":"463","endLine":48,"endColumn":10,"suggestions":"540"},{"ruleId":"461","severity":1,"message":"541","line":132,"column":8,"nodeType":"463","endLine":132,"endColumn":10,"suggestions":"542"},{"ruleId":"461","severity":1,"message":"543","line":157,"column":8,"nodeType":"463","endLine":157,"endColumn":26,"suggestions":"544"},{"ruleId":"461","severity":1,"message":"545","line":168,"column":8,"nodeType":"463","endLine":168,"endColumn":24,"suggestions":"546"},{"ruleId":"461","severity":1,"message":"547","line":176,"column":8,"nodeType":"463","endLine":176,"endColumn":14,"suggestions":"548"},{"ruleId":"465","severity":1,"message":"549","line":14,"column":11,"nodeType":"467","messageId":"468","endLine":14,"endColumn":18},{"ruleId":"461","severity":1,"message":"472","line":45,"column":8,"nodeType":"463","endLine":45,"endColumn":10,"suggestions":"550"},{"ruleId":"503","severity":1,"message":"551","line":42,"column":75,"nodeType":"490","messageId":"552","endLine":42,"endColumn":77},{"ruleId":"461","severity":1,"message":"553","line":55,"column":8,"nodeType":"463","endLine":55,"endColumn":10,"suggestions":"554"},{"ruleId":"555","severity":1,"message":"556","line":165,"column":45,"nodeType":"478","endLine":165,"endColumn":85},{"ruleId":"461","severity":1,"message":"557","line":41,"column":8,"nodeType":"463","endLine":41,"endColumn":10,"suggestions":"558"},{"ruleId":"461","severity":1,"message":"559","line":45,"column":8,"nodeType":"463","endLine":45,"endColumn":14,"suggestions":"560"},{"ruleId":"461","severity":1,"message":"561","line":43,"column":8,"nodeType":"463","endLine":43,"endColumn":10,"suggestions":"562"},{"ruleId":"555","severity":1,"message":"556","line":6,"column":9,"nodeType":"478","endLine":6,"endColumn":130},{"ruleId":"488","severity":1,"message":"489","line":21,"column":42,"nodeType":"490","messageId":"491","endLine":26,"endColumn":14},{"ruleId":"479","severity":1,"message":"480","line":8,"column":48,"nodeType":"481","messageId":"482","endLine":8,"endColumn":66},{"ruleId":"479","severity":1,"message":"483","line":9,"column":50,"nodeType":"481","messageId":"482","endLine":9,"endColumn":66},{"ruleId":"484","severity":1,"message":"485","line":9,"column":56,"nodeType":"481","messageId":"486","endLine":9,"endColumn":57,"suggestions":"563"},"no-native-reassign",["564"],"no-negated-in-lhs",["565"],"react-hooks/exhaustive-deps","React Hook useEffect has missing dependencies: 'errorCase', 'errorMessages', and 'history'. Either include them or remove the dependency array.","ArrayExpression",["566"],"no-unused-vars","'prepareStylesObject' is assigned a value but never used.","Identifier","unusedVar","'hidden' is assigned a value but never used.","'handleVisibility' is assigned a value but never used.","'useState' is defined but never used.","React Hook useEffect has a missing dependency: 'props'. Either include it or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.",["567"],"React Hook useEffect has a missing dependency: 'listPersons'. Either include it or remove the dependency array.",["568"],"jsx-a11y/alt-text","img elements must have an alt prop, either with meaningful text, or an empty string for decorative images.","JSXOpeningElement","no-control-regex","Unexpected control character(s) in regular expression: \\x00.","Literal","unexpected","Unexpected control character(s) in regular expression: \\x0a, \\x0d.","no-useless-escape","Unnecessary escape character: \\s.","unnecessaryEscape",["569","570"],"no-loop-func","Function declared in a loop contains unsafe references to variable(s) 'text', 'text'.","ArrowFunctionExpression","unsafeRefs",["564"],["565"],"React Hook useEffect has missing dependencies: 'goToChatByWaId', 'history', 'location', 'onDisplayError', and 'retrieveCurrentUser'. Either include them or remove the dependency array.",["571"],"React Hook useEffect has missing dependencies: 'getChatByWaId' and 'props'. Either include them or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.",["572"],"React Hook useEffect has a missing dependency: 'listUsers'. Either include it or remove the dependency array.",["573"],"'chat' is assigned a value but never used.","React Hook useEffect has a missing dependency: 'retrieveChat'. Either include it or remove the dependency array.",["574"],"array-callback-return","Array.prototype.filter() expects a value to be returned at the end of arrow function.","expectedAtEnd","'setLoading' is assigned a value but never used.","'setContactResults' is assigned a value but never used.","React Hook useEffect has missing dependencies: 'listChats' and 'searchMessages'. Either include them or remove the dependency array.",["575"],"React Hook useEffect has missing dependencies: 'props' and 'retrieveChat'. Either include them or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.",["576"],"React Hook useEffect has a missing dependency: 'listChats'. Either include it or remove the dependency array.",["577"],"React Hook useEffect has missing dependencies: 'props' and 'waId'. Either include them or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.",["578"],"React Hook useEffect has missing dependencies: 'props' and 'retrievePerson'. Either include them or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.",["579"],"React Hook useEffect has a missing dependency: 'alertUser'. Either include it or remove the dependency array.",["580"],["581"],"React Hook useEffect has missing dependencies: 'currentNewMessages' and 'getNewMessagesCount'. Either include them or remove the dependency array.",["582"],"React Hook useEffect has missing dependencies: 'listMessages' and 'markAsReceived'. Either include them or remove the dependency array.",["583"],"React Hook useEffect has a missing dependency: 'markAsReceived'. Either include it or remove the dependency array.",["584"],"React Hook useEffect has a missing dependency: 'goToMessageId'. Either include it or remove the dependency array.",["585"],"React Hook useEffect has a missing dependency: 'handleChosenFiles'. Either include it or remove the dependency array.",["586"],"React Hook useEffect has a missing dependency: 'props.chatData.waId'. Either include it or remove the dependency array. If 'setSelected' needs the current value of 'props.chatData.waId', you can also switch to useReducer instead of useState and read 'props.chatData.waId' in the reducer.",["587"],"React Hook useEffect has a missing dependency: 'props.chatData.lastReceivedMessageTimestamp'. Either include it or remove the dependency array.",["588"],"React Hook useEffect has missing dependencies: 'props' and 'retrieveBusinessProfile'. Either include them or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.",["589"],"React Hook useEffect has a missing dependency: 'props.data.id'. Either include it or remove the dependency array. If 'setSelected' needs the current value of 'props.data.id', you can also switch to useReducer instead of useState and read 'props.data.id' in the reducer.",["590"],"React Hook useEffect has a missing dependency: 'addTask'. Either include it or remove the dependency array.",["591"],"React Hook useEffect has missing dependencies: 'forceUpdate' and 'props'. Either include them or remove the dependency array. However, 'props' will change when *any* prop changes, so the preferred fix is to destructure the 'props' object outside of the useEffect call and refer to those specific props inside useEffect.",["592"],"React Hook useEffect has missing dependencies: 'changePreview' and 'hidePreview'. Either include them or remove the dependency array.",["593"],"React Hook useEffect has a missing dependency: 'chosenFile'. Either include it or remove the dependency array.",["594"],"React Hook useEffect has missing dependencies: 'changePreview' and 'chosenFile'. Either include them or remove the dependency array.",["595"],"'history' is assigned a value but never used.",["596"],"Array.prototype.map() expects a return value from arrow function.","expectedInside","React Hook useEffect has a missing dependency: 'template.components'. Either include it or remove the dependency array.",["597"],"react/jsx-no-target-blank","Using target=\"_blank\" without rel=\"noreferrer\" is a security risk: see https://html.spec.whatwg.org/multipage/links.html#link-type-noopener","React Hook useEffect has missing dependencies: 'cancelVoiceRecord' and 'requestMicrophonePermission'. Either include them or remove the dependency array.",["598"],"React Hook useEffect has a missing dependency: 'cancelVoiceRecord'. Either include it or remove the dependency array.",["599"],"React Hook useEffect has missing dependencies: 'data' and 'onChatMessageEvent'. Either include them or remove the dependency array.",["600"],["601","602"],"no-global-assign","no-unsafe-negation",{"desc":"603","fix":"604"},{"desc":"605","fix":"606"},{"desc":"607","fix":"608"},{"messageId":"609","fix":"610","desc":"611"},{"messageId":"612","fix":"613","desc":"614"},{"desc":"615","fix":"616"},{"desc":"617","fix":"618"},{"desc":"619","fix":"620"},{"desc":"621","fix":"622"},{"desc":"623","fix":"624"},{"desc":"625","fix":"626"},{"desc":"627","fix":"628"},{"desc":"629","fix":"630"},{"desc":"631","fix":"632"},{"desc":"633","fix":"634"},{"desc":"635","fix":"636"},{"desc":"637","fix":"638"},{"desc":"639","fix":"640"},{"desc":"641","fix":"642"},{"desc":"643","fix":"644"},{"desc":"645","fix":"646"},{"desc":"647","fix":"648"},{"desc":"649","fix":"650"},{"desc":"651","fix":"652"},{"desc":"653","fix":"654"},{"desc":"655","fix":"656"},{"desc":"657","fix":"658"},{"desc":"659","fix":"660"},{"desc":"661","fix":"662"},{"desc":"663","fix":"664"},{"desc":"605","fix":"665"},{"desc":"666","fix":"667"},{"desc":"668","fix":"669"},{"desc":"670","fix":"671"},{"desc":"672","fix":"673"},{"messageId":"609","fix":"674","desc":"611"},{"messageId":"612","fix":"675","desc":"614"},"Update the dependencies array to be: [errorCase, errorMessages, history]",{"range":"676","text":"677"},"Update the dependencies array to be: [props]",{"range":"678","text":"679"},"Update the dependencies array to be: [keyword, listPersons]",{"range":"680","text":"681"},"removeEscape",{"range":"682","text":"683"},"Remove the `\\`. This maintains the current functionality.","escapeBackslash",{"range":"684","text":"685"},"Replace the `\\` with `\\\\` to include the actual backslash character.","Update the dependencies array to be: [goToChatByWaId, history, location, onDisplayError, retrieveCurrentUser]",{"range":"686","text":"687"},"Update the dependencies array to be: [getChatByWaId, props]",{"range":"688","text":"689"},"Update the dependencies array to be: [listUsers]",{"range":"690","text":"691"},"Update the dependencies array to be: [retrieveChat]",{"range":"692","text":"693"},"Update the dependencies array to be: [keyword, listChats, searchMessages]",{"range":"694","text":"695"},"Update the dependencies array to be: [waId, props.isBlurred, props.chats, props.newMessages, keyword, props, retrieveChat]",{"range":"696","text":"697"},"Update the dependencies array to be: [props.chats, keyword, listChats]",{"range":"698","text":"699"},"Update the dependencies array to be: [props, waId]",{"range":"700","text":"701"},"Update the dependencies array to be: [props, retrievePerson, waId]",{"range":"702","text":"703"},"Update the dependencies array to be: [alertUser, hasFailedMessages]",{"range":"704","text":"705"},"Update the dependencies array to be: [person, props]",{"range":"706","text":"707"},"Update the dependencies array to be: [waId, props.newMessages, getNewMessagesCount, currentNewMessages]",{"range":"708","text":"709"},"Update the dependencies array to be: [messages, isLoaded, isLoadingMoreMessages, isAtBottom, currentNewMessages, markAsReceived, listMessages]",{"range":"710","text":"711"},"Update the dependencies array to be: [waId, messages, isLoaded, isExpired, isAtBottom, currentNewMessages, markAsReceived]",{"range":"712","text":"713"},"Update the dependencies array to be: [messages, isAtBottom, goToMessageId]",{"range":"714","text":"715"},"Update the dependencies array to be: [handleChosenFiles, selectedFiles]",{"range":"716","text":"717"},"Update the dependencies array to be: [props.chatData.waId, props.selectedChats]",{"range":"718","text":"719"},"Update the dependencies array to be: [isExpired, props.chatData.isExpired, props.chatData.lastMessageTimestamp, props.chatData.lastReceivedMessageTimestamp]",{"range":"720","text":"721"},"Update the dependencies array to be: [props, retrieveBusinessProfile]",{"range":"722","text":"723"},"Update the dependencies array to be: [props.data.id, props.selectedTags]",{"range":"724","text":"725"},"Update the dependencies array to be: [addTask]",{"range":"726","text":"727"},"Update the dependencies array to be: [forceUpdate, props]",{"range":"728","text":"729"},"Update the dependencies array to be: [changePreview, chosenFile, data, hidePreview]",{"range":"730","text":"731"},"Update the dependencies array to be: [chosenFile, currentCaption]",{"range":"732","text":"733"},"Update the dependencies array to be: [changePreview, chosenFile, data]",{"range":"734","text":"735"},{"range":"736","text":"679"},"Update the dependencies array to be: [template.components]",{"range":"737","text":"738"},"Update the dependencies array to be: [cancelVoiceRecord, requestMicrophonePermission]",{"range":"739","text":"740"},"Update the dependencies array to be: [cancelVoiceRecord, waId]",{"range":"741","text":"742"},"Update the dependencies array to be: [data, onChatMessageEvent]",{"range":"743","text":"744"},{"range":"745","text":"683"},{"range":"746","text":"685"},[2198,2200],"[errorCase, errorMessages, history]",[2097,2099],"[props]",[2557,2566],"[keyword, listPersons]",[2170,2171],"",[2170,2170],"\\",[19835,19837],"[goToChatByWaId, history, location, onDisplayError, retrieveCurrentUser]",[1174,1176],"[getChatByWaId, props]",[816,818],"[listUsers]",[783,785],"[retrieveChat]",[3879,3888],"[keyword, listChats, searchMessages]",[8217,8281],"[waId, props.isBlurred, props.chats, props.newMessages, keyword, props, retrieveChat]",[9382,9404],"[props.chats, keyword, listChats]",[5490,5492],"[props, waId]",[6507,6513],"[props, retrievePerson, waId]",[6744,6763],"[alertUser, hasFailedMessages]",[7068,7076],"[person, props]",[7397,7422],"[waId, props.newMessages, getNewMessagesCount, currentNewMessages]",[10404,10479],"[messages, isLoaded, isLoadingMoreMessages, isAtBottom, currentNewMessages, markAsReceived, listMessages]",[17830,17926],"[waId, messages, isLoaded, isExpired, isAtBottom, currentNewMessages, markAsReceived]",[22930,22952],"[messages, isAtBottom, goToMessageId]",[23063,23078],"[handleChosenFiles, selectedFiles]",[1495,1516],"[props.chatData.waId, props.selectedChats]",[3227,3301],"[isExpired, props.chatData.isExpired, props.chatData.lastMessageTimestamp, props.chatData.lastReceivedMessageTimestamp]",[1870,1872],"[props, retrieveBusinessProfile]",[399,419],"[props.data.id, props.selectedTags]",[1728,1730],"[addTask]",[4523,4525],"[forceUpdate, props]",[5401,5419],"[changePreview, chosenFile, data, hidePreview]",[5702,5718],"[chosenFile, currentCaption]",[5881,5887],"[changePreview, chosenFile, data]",[1870,1872],[2050,2052],"[template.components]",[1424,1426],"[cancelVoiceRecord, requestMicrophonePermission]",[1492,1498],"[cancelVoiceRecord, waId]",[1513,1515],"[data, onChatMessageEvent]",[388,389],[388,388]]